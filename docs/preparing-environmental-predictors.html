<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Preparing Environmental Predictors | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 4 Preparing Environmental Predictors | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Preparing Environmental Predictors | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="vjjan91/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Preparing Environmental Predictors | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  



<meta name="date" content="2022-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preparing-ebird-data.html"/>
<link rel="next" href="preparing-checklist-calibration-index.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.1</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html"><i class="fa fa-check"></i><b>2</b> Selecting species of interest</a><ul>
<li class="chapter" data-level="2.1" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-libraries"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#subset-species-by-geographical-confines-of-the-study-area"><i class="fa fa-check"></i><b>2.2</b> Subset species by geographical confines of the study area</a></li>
<li class="chapter" data-level="2.3" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#subset-an-initial-list-of-terrestrial-birds-based-on-a-minimum-of-1000-detections-between-2013-2021-and-b-remove-species-that-are-often-easily-confused-with-congeners"><i class="fa fa-check"></i><b>2.3</b> Subset an initial list of terrestrial birds based on a) minimum of 1000 detections between 2013-2021 and b) remove species that are often easily confused with congeners</a></li>
<li class="chapter" data-level="2.4" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#read-subset-of-species-following-filtering-and-removal-of-waterbirds-raptors-and-other-noctural-species"><i class="fa fa-check"></i><b>2.4</b> Read subset of species following filtering and removal of waterbirds, raptors, and other noctural species</a></li>
<li class="chapter" data-level="2.5" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#load-raw-data-for-locations"><i class="fa fa-check"></i><b>2.5</b> Load raw data for locations</a></li>
<li class="chapter" data-level="2.6" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#get-proportional-obs-counts-in-25km-cells"><i class="fa fa-check"></i><b>2.6</b> Get proportional obs counts in 25km cells</a></li>
<li class="chapter" data-level="2.7" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#which-species-are-reported-sufficiently-in-checklists"><i class="fa fa-check"></i><b>2.7</b> Which species are reported sufficiently in checklists?</a></li>
<li class="chapter" data-level="2.8" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#figure-checklist-distribution"><i class="fa fa-check"></i><b>2.8</b> Figure: Checklist distribution</a></li>
<li class="chapter" data-level="2.9" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-the-species-list"><i class="fa fa-check"></i><b>2.9</b> Prepare the species list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>3</b> Preparing eBird Data</a><ul>
<li class="chapter" data-level="3.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>3.2</b> Filter data</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>3.3</b> Process filtered data</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>3.4</b> Spatial filter</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>3.5</b> Handle presence data</a></li>
<li class="chapter" data-level="3.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>3.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>4</b> Preparing Environmental Predictors</a><ul>
<li class="chapter" data-level="4.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>4.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>4.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>4.4</b> Prepare CHELSA rasters</a><ul>
<li class="chapter" data-level="4.4.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-15"><i class="fa fa-check"></i><b>4.4.1</b> Prepare BIOCLIM 4a and 15</a></li>
<li class="chapter" data-level="4.4.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a"><i class="fa fa-check"></i><b>4.4.2</b> Prepare BIOCLIM 4a</a></li>
<li class="chapter" data-level="4.4.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-15"><i class="fa fa-check"></i><b>4.4.3</b> Prepare Bioclim 15</a></li>
<li class="chapter" data-level="4.4.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate"><i class="fa fa-check"></i><b>4.4.4</b> Stack terrain and climate</a></li>
<li class="chapter" data-level="4.4.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate-1"><i class="fa fa-check"></i><b>4.4.5</b> Stack terrain and climate</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>4.5</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>4.6</b> Resample other rasters to 1km</a><ul>
<li class="chapter" data-level="4.6.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>4.6.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="4.6.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>4.6.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-variables-in-relation-to-elevation"><i class="fa fa-check"></i><b>4.7</b> Climate variables in relation to elevation</a><ul>
<li class="chapter" data-level="4.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>4.7.1</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-across-land-cover-types"><i class="fa fa-check"></i><b>4.8</b> Climate across land cover types</a></li>
<li class="chapter" data-level="4.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>4.9</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="4.10" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>4.10</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html"><i class="fa fa-check"></i><b>5</b> Preparing Checklist Calibration Index</a><ul>
<li class="chapter" data-level="5.1" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-data"><i class="fa fa-check"></i><b>5.2</b> Prepare data</a></li>
<li class="chapter" data-level="5.3" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>5.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="5.4" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>5.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="5.5" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>5.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="5.6" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#get-landcover"><i class="fa fa-check"></i><b>5.6</b> Get landcover</a></li>
<li class="chapter" data-level="5.7" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#filter-checklist-data"><i class="fa fa-check"></i><b>5.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="5.8" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#model-observer-expertise"><i class="fa fa-check"></i><b>5.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>6</b> Examining Spatial Sampling Bias</a><ul>
<li class="chapter" data-level="6.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-3"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="6.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#read-checklist-data"><i class="fa fa-check"></i><b>6.2</b> Read checklist data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>6.2.1</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="6.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#get-background-land-for-plotting"><i class="fa fa-check"></i><b>6.2.2</b> Get background land for plotting</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-main-text-figure-3"><i class="fa fa-check"></i><b>6.3</b> Prepare Main Text Figure 3</a><ul>
<li class="chapter" data-level="6.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>6.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="6.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>6.3.2</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="6.3.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>6.3.3</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="6.3.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatial-distribution-of-distances-to-neighbours"><i class="fa fa-check"></i><b>6.3.4</b> Spatial distribution of distances to neighbours</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#figure-spatial-sampling-bias"><i class="fa fa-check"></i><b>6.4</b> Figure: Spatial sampling bias</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html"><i class="fa fa-check"></i><b>7</b> Checking Temporal Sampling Frequency</a><ul>
<li class="chapter" data-level="7.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-libraries"><i class="fa fa-check"></i><b>7.1</b> Load libraries</a></li>
<li class="chapter" data-level="7.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-checklist-data"><i class="fa fa-check"></i><b>7.2</b> Load checklist data</a></li>
<li class="chapter" data-level="7.3" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-time-differences-per-grid-cell"><i class="fa fa-check"></i><b>7.3</b> Get time differences per grid cell</a></li>
<li class="chapter" data-level="7.4" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#time-since-previous-checklist"><i class="fa fa-check"></i><b>7.4</b> Time Since Previous Checklist</a><ul>
<li class="chapter" data-level="7.4.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-aux-data"><i class="fa fa-check"></i><b>7.4.1</b> Get aux data</a></li>
<li class="chapter" data-level="7.4.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#histogram-of-lags"><i class="fa fa-check"></i><b>7.4.2</b> Histogram of lags</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#main-text-figure-3"><i class="fa fa-check"></i><b>7.5</b> Main Text Figure 3</a></li>
<li class="chapter" data-level="7.6" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#checklists-per-month"><i class="fa fa-check"></i><b>7.6</b> Checklists per Month</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>8</b> Adding Covariates to Checklist Data</a><ul>
<li class="chapter" data-level="8.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>8.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="8.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>8.2</b> Spatial subsampling</a><ul>
<li class="chapter" data-level="8.2.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#counting-presence-observation-proportion"><i class="fa fa-check"></i><b>8.2.1</b> Counting presence observation proportion</a></li>
<li class="chapter" data-level="8.2.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-spatial-thinning"><i class="fa fa-check"></i><b>8.2.2</b> Count absences after spatial thinning</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>8.3</b> Temporal subsampling</a><ul>
<li class="chapter" data-level="8.3.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-temporal-thinning"><i class="fa fa-check"></i><b>8.3.1</b> Count absences after temporal thinning</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>8.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="8.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>8.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="8.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>8.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="8.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>8.7</b> Spatial buffer-wide covariates</a><ul>
<li class="chapter" data-level="8.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>8.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="8.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>8.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="8.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>8.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>9</b> Modelling Species Occupancy</a><ul>
<li class="chapter" data-level="9.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>9.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="9.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-prepare-covariates"><i class="fa fa-check"></i><b>9.1</b> Load dataframe and prepare covariates</a><ul>
<li class="chapter" data-level="9.1.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-the-sampling-protocol"><i class="fa fa-check"></i><b>9.1.1</b> Handle the sampling protocol</a></li>
<li class="chapter" data-level="9.1.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-time-and-date"><i class="fa fa-check"></i><b>9.1.2</b> Handle time and date</a></li>
<li class="chapter" data-level="9.1.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#scaling-covariates"><i class="fa fa-check"></i><b>9.1.3</b> Scaling covariates</a></li>
<li class="chapter" data-level="9.1.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#correct-date-format"><i class="fa fa-check"></i><b>9.1.4</b> Correct date format</a></li>
<li class="chapter" data-level="9.1.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#check-for-correlated-covariates"><i class="fa fa-check"></i><b>9.1.5</b> Check for correlated covariates</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>9.2</b> Running a null model</a></li>
<li class="chapter" data-level="9.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>9.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="9.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>9.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="9.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>9.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>10</b> Visualizing Occupancy Predictor Effects</a><ul>
<li class="chapter" data-level="10.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-4"><i class="fa fa-check"></i><b>10.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="10.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>10.2</b> Load species list</a></li>
<li class="chapter" data-level="10.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>10.3</b> Show AIC weight importance</a><ul>
<li class="chapter" data-level="10.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>10.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="10.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>10.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>10.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="10.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>10.5</b> Get predictor effects</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><i class="fa fa-check"></i><b>11</b> Predicting species-specific occupancy as a function of significant predictors</a><ul>
<li class="chapter" data-level="11.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-libraries-5"><i class="fa fa-check"></i><b>11.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="11.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#read-data"><i class="fa fa-check"></i><b>11.2</b> Read data</a></li>
<li class="chapter" data-level="11.3" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-predictor-data"><i class="fa fa-check"></i><b>11.3</b> Prepare predictor data</a></li>
<li class="chapter" data-level="11.4" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#get-predictor-responses"><i class="fa fa-check"></i><b>11.4</b> Get predictor responses</a></li>
<li class="chapter" data-level="11.5" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#get-probability-of-occupancy"><i class="fa fa-check"></i><b>11.5</b> Get probability of occupancy</a></li>
<li class="chapter" data-level="11.6" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#add-scaling-for-predictors"><i class="fa fa-check"></i><b>11.6</b> Add scaling for predictors</a><ul>
<li class="chapter" data-level="11.6.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#figure-occupancy-predictors"><i class="fa fa-check"></i><b>11.6.1</b> Figure: Occupancy ~ predictors</a></li>
<li class="chapter" data-level="11.6.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#figures-occupancy-predictors-for-all-species"><i class="fa fa-check"></i><b>11.6.2</b> Figures: Occupancy ~ predictors for all species</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#mapping-species-occupancy"><i class="fa fa-check"></i><b>11.7</b> Mapping species occupancy</a><ul>
<li class="chapter" data-level="11.7.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#read-in-raster-layers"><i class="fa fa-check"></i><b>11.7.1</b> Read in raster layers</a></li>
<li class="chapter" data-level="11.7.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#split-landcover-into-proportions-per-1km"><i class="fa fa-check"></i><b>11.7.2</b> Split landcover into proportions per 1km</a></li>
<li class="chapter" data-level="11.7.3" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-climatic-layers"><i class="fa fa-check"></i><b>11.7.3</b> Prepare climatic layers</a></li>
<li class="chapter" data-level="11.7.4" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#mask-by-study-area"><i class="fa fa-check"></i><b>11.7.4</b> Mask by study area</a></li>
<li class="chapter" data-level="11.7.5" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#plot-full-bounds-of-landscape-variables"><i class="fa fa-check"></i><b>11.7.5</b> Plot full bounds of landscape variables</a></li>
<li class="chapter" data-level="11.7.6" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-soi-predictors"><i class="fa fa-check"></i><b>11.7.6</b> Prepare soi predictors</a></li>
<li class="chapter" data-level="11.7.7" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-species-occupancy-for-soi"><i class="fa fa-check"></i><b>11.7.7</b> Prepare species occupancy for SOI</a></li>
<li class="chapter" data-level="11.7.8" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-species-occupancy-for-all-species"><i class="fa fa-check"></i><b>11.7.8</b> Prepare species occupancy for all species</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code and supplementary material for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preparing-environmental-predictors" class="section level1">
<h1><span class="header-section-number">Section 4</span> Preparing Environmental Predictors</h1>
<p>In this script, we processed climatic and landscape predictors for occupancy modeling.</p>
<p>All climatic data was obtained from <a href="https://chelsa-climate.org/bioclim/" class="uri">https://chelsa-climate.org/bioclim/</a><br />
All landscape data was derived from a high resolution land cover map (Roy et al.Â 2015). This map provides sufficient classes to achieve a high land cover resolution and can be accessed here (<a href="https://daac.ornl.gov/VEGETATION/guides/Decadal_LULC_India.html" class="uri">https://daac.ornl.gov/VEGETATION/guides/Decadal_LULC_India.html</a>).</p>
<p>The goal here is to resample all rasters so that they have the same resolution of 1km cells.</p>
<div id="prepare-libraries-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Prepare libraries</h2>
<p>We load some common libraries for raster processing and define a custom mode function.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="preparing-environmental-predictors.html#cb23-1"></a><span class="co"># load libs</span></span>
<span id="cb23-2"><a href="preparing-environmental-predictors.html#cb23-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb23-3"><a href="preparing-environmental-predictors.html#cb23-3"></a><span class="kw">library</span>(stringi)</span>
<span id="cb23-4"><a href="preparing-environmental-predictors.html#cb23-4"></a><span class="kw">library</span>(glue)</span>
<span id="cb23-5"><a href="preparing-environmental-predictors.html#cb23-5"></a><span class="kw">library</span>(gdalUtils)</span>
<span id="cb23-6"><a href="preparing-environmental-predictors.html#cb23-6"></a><span class="kw">library</span>(purrr)</span>
<span id="cb23-7"><a href="preparing-environmental-predictors.html#cb23-7"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb23-8"><a href="preparing-environmental-predictors.html#cb23-8"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb23-9"><a href="preparing-environmental-predictors.html#cb23-9"></a><span class="kw">library</span>(tibble)</span>
<span id="cb23-10"><a href="preparing-environmental-predictors.html#cb23-10"></a></span>
<span id="cb23-11"><a href="preparing-environmental-predictors.html#cb23-11"></a><span class="co"># for plotting</span></span>
<span id="cb23-12"><a href="preparing-environmental-predictors.html#cb23-12"></a><span class="kw">library</span>(viridis)</span>
<span id="cb23-13"><a href="preparing-environmental-predictors.html#cb23-13"></a><span class="kw">library</span>(colorspace)</span>
<span id="cb23-14"><a href="preparing-environmental-predictors.html#cb23-14"></a><span class="kw">library</span>(tmap)</span>
<span id="cb23-15"><a href="preparing-environmental-predictors.html#cb23-15"></a><span class="kw">library</span>(scales)</span>
<span id="cb23-16"><a href="preparing-environmental-predictors.html#cb23-16"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb23-17"><a href="preparing-environmental-predictors.html#cb23-17"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb23-18"><a href="preparing-environmental-predictors.html#cb23-18"></a></span>
<span id="cb23-19"><a href="preparing-environmental-predictors.html#cb23-19"></a><span class="co"># prep mode function to aggregate</span></span>
<span id="cb23-20"><a href="preparing-environmental-predictors.html#cb23-20"></a>funcMode &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> T) {</span>
<span id="cb23-21"><a href="preparing-environmental-predictors.html#cb23-21"></a>  ux &lt;-<span class="st"> </span><span class="kw">unique</span>(x)</span>
<span id="cb23-22"><a href="preparing-environmental-predictors.html#cb23-22"></a>  ux[<span class="kw">which.max</span>(<span class="kw">tabulate</span>(<span class="kw">match</span>(x, ux)))]</span>
<span id="cb23-23"><a href="preparing-environmental-predictors.html#cb23-23"></a>}</span>
<span id="cb23-24"><a href="preparing-environmental-predictors.html#cb23-24"></a></span>
<span id="cb23-25"><a href="preparing-environmental-predictors.html#cb23-25"></a><span class="co"># a basic test</span></span>
<span id="cb23-26"><a href="preparing-environmental-predictors.html#cb23-26"></a>assertthat<span class="op">::</span><span class="kw">assert_that</span>(<span class="kw">funcMode</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)) <span class="op">==</span><span class="st"> </span><span class="kw">as.character</span>(<span class="dv">2</span>),</span>
<span id="cb23-27"><a href="preparing-environmental-predictors.html#cb23-27"></a>  <span class="dt">msg =</span> <span class="st">&quot;problem in the mode function&quot;</span></span>
<span id="cb23-28"><a href="preparing-environmental-predictors.html#cb23-28"></a>) <span class="co"># works</span></span>
<span id="cb23-29"><a href="preparing-environmental-predictors.html#cb23-29"></a></span>
<span id="cb23-30"><a href="preparing-environmental-predictors.html#cb23-30"></a><span class="co"># get ci func</span></span>
<span id="cb23-31"><a href="preparing-environmental-predictors.html#cb23-31"></a>ci &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb23-32"><a href="preparing-environmental-predictors.html#cb23-32"></a>  <span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> T) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</span>
<span id="cb23-33"><a href="preparing-environmental-predictors.html#cb23-33"></a>}</span></code></pre></div>
</div>
<div id="prepare-spatial-extent" class="section level2">
<h2><span class="header-section-number">4.2</span> Prepare spatial extent</h2>
<p>We prepare a 30km buffer around the boundary of the study area. This buffer will be used to mask the landscape rasters.The buffer procedure is done on data transformed to the UTM 43N CRS to avoid distortions.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="preparing-environmental-predictors.html#cb24-1"></a><span class="co"># load hills</span></span>
<span id="cb24-2"><a href="preparing-environmental-predictors.html#cb24-2"></a><span class="kw">library</span>(sf)</span>
<span id="cb24-3"><a href="preparing-environmental-predictors.html#cb24-3"></a>hills &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/spatial/hillsShapefile/Nil_Ana_Pal.shp&quot;</span>)</span>
<span id="cb24-4"><a href="preparing-environmental-predictors.html#cb24-4"></a>hills &lt;-<span class="st"> </span><span class="kw">st_transform</span>(hills, <span class="dv">32643</span>)</span>
<span id="cb24-5"><a href="preparing-environmental-predictors.html#cb24-5"></a>buffer &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(hills, <span class="fl">3e4</span>) <span class="op">%&gt;%</span></span>
<span id="cb24-6"><a href="preparing-environmental-predictors.html#cb24-6"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">4326</span>)</span></code></pre></div>
</div>
<div id="prepare-terrain-rasters" class="section level2">
<h2><span class="header-section-number">4.3</span> Prepare terrain rasters</h2>
<p>We prepare the elevation data which is an SRTM raster layer, and derive the slope and aspect from it after cropping it to the extent of the study site buffer. Please download the latest version of the SRTM raster layer from <a href="https://www.worldclim.org/data/worldclim21.html" class="uri">https://www.worldclim.org/data/worldclim21.html</a></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="preparing-environmental-predictors.html#cb25-1"></a><span class="co"># load elevation and crop to hills size, then mask by study area</span></span>
<span id="cb25-2"><a href="preparing-environmental-predictors.html#cb25-2"></a>alt &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/spatial/Elevation/alt&quot;</span>) <span class="co"># this layer is not added to github as a result of its large size and can be downloaded from the above link</span></span>
<span id="cb25-3"><a href="preparing-environmental-predictors.html#cb25-3"></a>alt.hills &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">crop</span>(alt, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb25-4"><a href="preparing-environmental-predictors.html#cb25-4"></a><span class="kw">rm</span>(alt)</span>
<span id="cb25-5"><a href="preparing-environmental-predictors.html#cb25-5"></a><span class="kw">gc</span>()</span>
<span id="cb25-6"><a href="preparing-environmental-predictors.html#cb25-6"></a></span>
<span id="cb25-7"><a href="preparing-environmental-predictors.html#cb25-7"></a><span class="co"># get slope and aspect</span></span>
<span id="cb25-8"><a href="preparing-environmental-predictors.html#cb25-8"></a>slopeData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">terrain</span>(<span class="dt">x =</span> alt.hills, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>))</span>
<span id="cb25-9"><a href="preparing-environmental-predictors.html#cb25-9"></a>elevData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(alt.hills, slopeData)</span>
<span id="cb25-10"><a href="preparing-environmental-predictors.html#cb25-10"></a><span class="kw">rm</span>(alt.hills)</span>
<span id="cb25-11"><a href="preparing-environmental-predictors.html#cb25-11"></a><span class="kw">gc</span>()</span></code></pre></div>
</div>
<div id="prepare-chelsa-rasters" class="section level2">
<h2><span class="header-section-number">4.4</span> Prepare CHELSA rasters</h2>
<p>CHELSA rasters can be downloaded using the <code>get_chelsa.sh</code> shell script, which is a <code>wget</code> command pointing to the <code>envidatS3.txt</code> file.</p>
<div id="prepare-bioclim-4a-and-15" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Prepare BIOCLIM 4a and 15</h3>
<p>We prepare the CHELSA rasters for seasonality in temperature (Bio 4a) and seasonality in precipitation (Bio 15) in the same way, reading them in, cropping them to the study site buffer extent, and handling the temperature layer values which we divide by 10. The CHELSA rasters can be downloaded from <a href="https://chelsa-climate.org/bioclim/" class="uri">https://chelsa-climate.org/bioclim/</a></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="preparing-environmental-predictors.html#cb26-1"></a><span class="co"># list chelsa files</span></span>
<span id="cb26-2"><a href="preparing-environmental-predictors.html#cb26-2"></a><span class="co"># the chelsa data can be downloaded from the aforementioned link. They haven&#39;t been uploaded to github as a result of its large size.</span></span>
<span id="cb26-3"><a href="preparing-environmental-predictors.html#cb26-3"></a>chelsaFiles &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data/chelsa/&quot;</span>,</span>
<span id="cb26-4"><a href="preparing-environmental-predictors.html#cb26-4"></a>  <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb26-5"><a href="preparing-environmental-predictors.html#cb26-5"></a>  <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb26-6"><a href="preparing-environmental-predictors.html#cb26-6"></a>  <span class="dt">pattern =</span> <span class="st">&quot;bio10&quot;</span></span>
<span id="cb26-7"><a href="preparing-environmental-predictors.html#cb26-7"></a>)</span>
<span id="cb26-8"><a href="preparing-environmental-predictors.html#cb26-8"></a></span>
<span id="cb26-9"><a href="preparing-environmental-predictors.html#cb26-9"></a><span class="co"># gather chelsa rasters</span></span>
<span id="cb26-10"><a href="preparing-environmental-predictors.html#cb26-10"></a>chelsaData &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(chelsaFiles, <span class="cf">function</span>(chr) {</span>
<span id="cb26-11"><a href="preparing-environmental-predictors.html#cb26-11"></a>  a &lt;-<span class="st"> </span><span class="kw">raster</span>(chr)</span>
<span id="cb26-12"><a href="preparing-environmental-predictors.html#cb26-12"></a>  <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb26-13"><a href="preparing-environmental-predictors.html#cb26-13"></a>  a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb26-14"><a href="preparing-environmental-predictors.html#cb26-14"></a>  <span class="kw">return</span>(a)</span>
<span id="cb26-15"><a href="preparing-environmental-predictors.html#cb26-15"></a>})</span>
<span id="cb26-16"><a href="preparing-environmental-predictors.html#cb26-16"></a></span>
<span id="cb26-17"><a href="preparing-environmental-predictors.html#cb26-17"></a><span class="co"># divide temperature by 10</span></span>
<span id="cb26-18"><a href="preparing-environmental-predictors.html#cb26-18"></a>chelsaData[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>chelsaData[[<span class="dv">1</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb26-19"><a href="preparing-environmental-predictors.html#cb26-19"></a></span>
<span id="cb26-20"><a href="preparing-environmental-predictors.html#cb26-20"></a><span class="co"># stack chelsa data</span></span>
<span id="cb26-21"><a href="preparing-environmental-predictors.html#cb26-21"></a>chelsaData &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">stack</span>(chelsaData)</span></code></pre></div>
</div>
<div id="prepare-bioclim-4a" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Prepare BIOCLIM 4a</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="preparing-environmental-predictors.html#cb27-1"></a><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_4a.tif&quot;</span>)) {</span>
<span id="cb27-2"><a href="preparing-environmental-predictors.html#cb27-2"></a>  <span class="kw">message</span>(<span class="st">&quot;Bio 4a already exists, will be overwritten&quot;</span>)</span>
<span id="cb27-3"><a href="preparing-environmental-predictors.html#cb27-3"></a>}</span></code></pre></div>
<p>Bioclim 4a, the coefficient of variation temperature seasonality is calculated as</p>
<p><span class="math display">\[Bio\ 4a = \frac{SD\{ Tkavg_1, \ldots Tkavg_{12} \}}{(Bio\ 1 + 273.15)} \times 100\]</span></p>
<p>where <span class="math inline">\(Tkavg_i = (Tkmin_i + Tkmax_i) / 2\)</span></p>
<p>Here, we use only the months of December and Jan â May for winter temperature variation.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="preparing-environmental-predictors.html#cb28-1"></a><span class="co"># list rasters by pattern</span></span>
<span id="cb28-2"><a href="preparing-environmental-predictors.html#cb28-2"></a>patterns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tmin&quot;</span>, <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb28-3"><a href="preparing-environmental-predictors.html#cb28-3"></a></span>
<span id="cb28-4"><a href="preparing-environmental-predictors.html#cb28-4"></a><span class="co"># list the filepaths</span></span>
<span id="cb28-5"><a href="preparing-environmental-predictors.html#cb28-5"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map</span>(patterns, <span class="cf">function</span>(pattern) {</span>
<span id="cb28-6"><a href="preparing-environmental-predictors.html#cb28-6"></a>  <span class="co"># list the paths</span></span>
<span id="cb28-7"><a href="preparing-environmental-predictors.html#cb28-7"></a>  files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</span>
<span id="cb28-8"><a href="preparing-environmental-predictors.html#cb28-8"></a>    <span class="dt">path =</span> <span class="st">&quot;data/chelsa&quot;</span>,</span>
<span id="cb28-9"><a href="preparing-environmental-predictors.html#cb28-9"></a>    <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb28-10"><a href="preparing-environmental-predictors.html#cb28-10"></a>    <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb28-11"><a href="preparing-environmental-predictors.html#cb28-11"></a>    <span class="dt">pattern =</span> pattern</span>
<span id="cb28-12"><a href="preparing-environmental-predictors.html#cb28-12"></a>  )</span>
<span id="cb28-13"><a href="preparing-environmental-predictors.html#cb28-13"></a>})</span>
<span id="cb28-14"><a href="preparing-environmental-predictors.html#cb28-14"></a></span>
<span id="cb28-15"><a href="preparing-environmental-predictors.html#cb28-15"></a><span class="co"># print crs elev data for sanity check --- basic WGS84</span></span>
<span id="cb28-16"><a href="preparing-environmental-predictors.html#cb28-16"></a><span class="kw">crs</span>(elevData)</span>
<span id="cb28-17"><a href="preparing-environmental-predictors.html#cb28-17"></a></span>
<span id="cb28-18"><a href="preparing-environmental-predictors.html#cb28-18"></a><span class="co"># now run over the paths and read as rasters and crop by buffer</span></span>
<span id="cb28-19"><a href="preparing-environmental-predictors.html#cb28-19"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map</span>(tkAvg, <span class="cf">function</span>(paths) {</span>
<span id="cb28-20"><a href="preparing-environmental-predictors.html#cb28-20"></a>  <span class="co"># going over the file paths, read them in as rasters, convert CRS and crop</span></span>
<span id="cb28-21"><a href="preparing-environmental-predictors.html#cb28-21"></a>  tempData &lt;-<span class="st"> </span><span class="kw">map</span>(paths, <span class="cf">function</span>(path) {</span>
<span id="cb28-22"><a href="preparing-environmental-predictors.html#cb28-22"></a>    <span class="co"># read in</span></span>
<span id="cb28-23"><a href="preparing-environmental-predictors.html#cb28-23"></a>    a &lt;-<span class="st"> </span><span class="kw">raster</span>(path)</span>
<span id="cb28-24"><a href="preparing-environmental-predictors.html#cb28-24"></a>    <span class="co"># assign crs</span></span>
<span id="cb28-25"><a href="preparing-environmental-predictors.html#cb28-25"></a>    <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb28-26"><a href="preparing-environmental-predictors.html#cb28-26"></a>    <span class="co"># crop by buffer, will throw error if CRS doesn&#39;t match</span></span>
<span id="cb28-27"><a href="preparing-environmental-predictors.html#cb28-27"></a>    a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb28-28"><a href="preparing-environmental-predictors.html#cb28-28"></a>    <span class="co"># return a</span></span>
<span id="cb28-29"><a href="preparing-environmental-predictors.html#cb28-29"></a>    a</span>
<span id="cb28-30"><a href="preparing-environmental-predictors.html#cb28-30"></a>  })</span>
<span id="cb28-31"><a href="preparing-environmental-predictors.html#cb28-31"></a>  <span class="co"># convert each to kelvin, first dividing by 10 to get celsius</span></span>
<span id="cb28-32"><a href="preparing-environmental-predictors.html#cb28-32"></a>  tempData &lt;-<span class="st"> </span><span class="kw">map</span>(tempData, <span class="cf">function</span>(tmpRaster) {</span>
<span id="cb28-33"><a href="preparing-environmental-predictors.html#cb28-33"></a>    tmpRaster &lt;-<span class="st"> </span>(tmpRaster <span class="op">/</span><span class="st"> </span><span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="fl">273.15</span></span>
<span id="cb28-34"><a href="preparing-environmental-predictors.html#cb28-34"></a>  })</span>
<span id="cb28-35"><a href="preparing-environmental-predictors.html#cb28-35"></a>})</span>
<span id="cb28-36"><a href="preparing-environmental-predictors.html#cb28-36"></a></span>
<span id="cb28-37"><a href="preparing-environmental-predictors.html#cb28-37"></a><span class="co"># assign names</span></span>
<span id="cb28-38"><a href="preparing-environmental-predictors.html#cb28-38"></a><span class="kw">names</span>(tkAvg) &lt;-<span class="st"> </span>patterns</span>
<span id="cb28-39"><a href="preparing-environmental-predictors.html#cb28-39"></a></span>
<span id="cb28-40"><a href="preparing-environmental-predictors.html#cb28-40"></a><span class="co"># go over the tmin and tmax and get the average monthly temp</span></span>
<span id="cb28-41"><a href="preparing-environmental-predictors.html#cb28-41"></a>tkAvg &lt;-<span class="st"> </span><span class="kw">map2</span>(tkAvg[[<span class="st">&quot;tmin&quot;</span>]], tkAvg[[<span class="st">&quot;tmax&quot;</span>]], <span class="cf">function</span>(tmin, tmax) {</span>
<span id="cb28-42"><a href="preparing-environmental-predictors.html#cb28-42"></a>  <span class="co"># return the mean of the corresponding tmin and tmax</span></span>
<span id="cb28-43"><a href="preparing-environmental-predictors.html#cb28-43"></a>  <span class="co"># still in kelvin</span></span>
<span id="cb28-44"><a href="preparing-environmental-predictors.html#cb28-44"></a>  <span class="kw">calc</span>(<span class="kw">stack</span>(tmin, tmax), <span class="dt">fun =</span> mean)</span>
<span id="cb28-45"><a href="preparing-environmental-predictors.html#cb28-45"></a>})</span>
<span id="cb28-46"><a href="preparing-environmental-predictors.html#cb28-46"></a></span>
<span id="cb28-47"><a href="preparing-environmental-predictors.html#cb28-47"></a><span class="co"># calculate Bio 4a</span></span>
<span id="cb28-48"><a href="preparing-environmental-predictors.html#cb28-48"></a>bio_4a &lt;-<span class="st"> </span>(<span class="kw">calc</span>(<span class="kw">stack</span>(tkAvg), <span class="dt">fun =</span> sd) <span class="op">/</span><span class="st"> </span>(chelsaData[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span><span class="fl">273.15</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb28-49"><a href="preparing-environmental-predictors.html#cb28-49"></a><span class="kw">names</span>(bio_4a) &lt;-<span class="st"> &quot;CHELSA_bio10_4a&quot;</span></span>
<span id="cb28-50"><a href="preparing-environmental-predictors.html#cb28-50"></a><span class="co"># save bio_4a</span></span>
<span id="cb28-51"><a href="preparing-environmental-predictors.html#cb28-51"></a><span class="kw">writeRaster</span>(bio_4a, <span class="dt">filename =</span> <span class="st">&quot;data/chelsa/CHELSA_bio10_4a.tif&quot;</span>, <span class="dt">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="prepare-bioclim-15" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Prepare Bioclim 15</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="preparing-environmental-predictors.html#cb29-1"></a><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_15.tif&quot;</span>)) {</span>
<span id="cb29-2"><a href="preparing-environmental-predictors.html#cb29-2"></a>  <span class="kw">message</span>(<span class="st">&quot;Bio 15 already exists, will be overwritten&quot;</span>)</span>
<span id="cb29-3"><a href="preparing-environmental-predictors.html#cb29-3"></a>}</span></code></pre></div>
<p>Bioclim 15, the coefficient of variation precipitation (in our area, rainfall) seasonality is calculated as</p>
<p><span class="math display">\[Bio\ 15 = \frac{SD\{ PPT_1, \ldots PPT_{12} \}}{1 + (Bio\ 12 / 12)} \times 100\]</span></p>
<p>where <span class="math inline">\(PPT_i\)</span> is the monthly precipitation.</p>
<p>Here, we use only the months of December and Jan â May for winter rainfall variation.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="preparing-environmental-predictors.html#cb30-1"></a><span class="co"># list rasters by pattern</span></span>
<span id="cb30-2"><a href="preparing-environmental-predictors.html#cb30-2"></a>pattern &lt;-<span class="st"> &quot;prec&quot;</span></span>
<span id="cb30-3"><a href="preparing-environmental-predictors.html#cb30-3"></a></span>
<span id="cb30-4"><a href="preparing-environmental-predictors.html#cb30-4"></a><span class="co"># list the filepaths</span></span>
<span id="cb30-5"><a href="preparing-environmental-predictors.html#cb30-5"></a>pptTotal &lt;-<span class="st"> </span><span class="kw">list.files</span>(</span>
<span id="cb30-6"><a href="preparing-environmental-predictors.html#cb30-6"></a>  <span class="dt">path =</span> <span class="st">&quot;data/chelsa&quot;</span>,</span>
<span id="cb30-7"><a href="preparing-environmental-predictors.html#cb30-7"></a>  <span class="dt">full.names =</span> <span class="ot">TRUE</span>,</span>
<span id="cb30-8"><a href="preparing-environmental-predictors.html#cb30-8"></a>  <span class="dt">recursive =</span> <span class="ot">TRUE</span>,</span>
<span id="cb30-9"><a href="preparing-environmental-predictors.html#cb30-9"></a>  <span class="dt">pattern =</span> pattern</span>
<span id="cb30-10"><a href="preparing-environmental-predictors.html#cb30-10"></a>)</span>
<span id="cb30-11"><a href="preparing-environmental-predictors.html#cb30-11"></a></span>
<span id="cb30-12"><a href="preparing-environmental-predictors.html#cb30-12"></a><span class="co"># print crs elev data for sanity check --- basic WGS84</span></span>
<span id="cb30-13"><a href="preparing-environmental-predictors.html#cb30-13"></a><span class="kw">crs</span>(elevData)</span>
<span id="cb30-14"><a href="preparing-environmental-predictors.html#cb30-14"></a></span>
<span id="cb30-15"><a href="preparing-environmental-predictors.html#cb30-15"></a><span class="co"># now run over the paths and read as rasters and crop by buffer</span></span>
<span id="cb30-16"><a href="preparing-environmental-predictors.html#cb30-16"></a>pptTotal &lt;-<span class="st"> </span><span class="kw">map</span>(pptTotal, <span class="cf">function</span>(path) {</span>
<span id="cb30-17"><a href="preparing-environmental-predictors.html#cb30-17"></a>  a &lt;-<span class="st"> </span><span class="kw">raster</span>(path)</span>
<span id="cb30-18"><a href="preparing-environmental-predictors.html#cb30-18"></a>  <span class="co"># assign crs</span></span>
<span id="cb30-19"><a href="preparing-environmental-predictors.html#cb30-19"></a>  <span class="kw">crs</span>(a) &lt;-<span class="st"> </span><span class="kw">crs</span>(elevData)</span>
<span id="cb30-20"><a href="preparing-environmental-predictors.html#cb30-20"></a>  <span class="co"># crop by buffer, will throw error if CRS doesn&#39;t match</span></span>
<span id="cb30-21"><a href="preparing-environmental-predictors.html#cb30-21"></a>  a &lt;-<span class="st"> </span><span class="kw">crop</span>(a, <span class="kw">as</span>(buffer, <span class="st">&quot;Spatial&quot;</span>))</span>
<span id="cb30-22"><a href="preparing-environmental-predictors.html#cb30-22"></a>  <span class="co"># return a</span></span>
<span id="cb30-23"><a href="preparing-environmental-predictors.html#cb30-23"></a>  a</span>
<span id="cb30-24"><a href="preparing-environmental-predictors.html#cb30-24"></a>})</span>
<span id="cb30-25"><a href="preparing-environmental-predictors.html#cb30-25"></a></span>
<span id="cb30-26"><a href="preparing-environmental-predictors.html#cb30-26"></a><span class="co"># calculate Bio 4a</span></span>
<span id="cb30-27"><a href="preparing-environmental-predictors.html#cb30-27"></a>bio_<span class="dv">15</span> &lt;-<span class="st"> </span>(<span class="kw">calc</span>(<span class="kw">stack</span>(pptTotal), <span class="dt">fun =</span> sd) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(chelsaData[[<span class="dv">2</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">12</span>))) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb30-28"><a href="preparing-environmental-predictors.html#cb30-28"></a><span class="kw">names</span>(bio_<span class="dv">15</span>) &lt;-<span class="st"> &quot;CHELSA_bio10_15&quot;</span></span>
<span id="cb30-29"><a href="preparing-environmental-predictors.html#cb30-29"></a><span class="co"># save bio_4a</span></span>
<span id="cb30-30"><a href="preparing-environmental-predictors.html#cb30-30"></a><span class="kw">writeRaster</span>(bio_<span class="dv">15</span>, <span class="dt">filename =</span> <span class="st">&quot;data/chelsa/CHELSA_bio10_15.tif&quot;</span>, <span class="dt">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="stack-terrain-and-climate" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Stack terrain and climate</h3>
<p>We stack the terrain and climatic rasters.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="preparing-environmental-predictors.html#cb31-1"></a><span class="co"># If bio4a and bio15 have already been prepared from previous runs/analysis - load them directly</span></span>
<span id="cb31-2"><a href="preparing-environmental-predictors.html#cb31-2"></a>bio_4a &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_4a.tif&quot;</span>)</span>
<span id="cb31-3"><a href="preparing-environmental-predictors.html#cb31-3"></a>bio_<span class="dv">15</span> &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/chelsa/CHELSA_bio10_15.tif&quot;</span>)</span></code></pre></div>
</div>
<div id="stack-terrain-and-climate-1" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Stack terrain and climate</h3>
<p>We stack the terrain and climatic rasters.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="preparing-environmental-predictors.html#cb32-1"></a><span class="co"># stack rasters for efficient reprojection later</span></span>
<span id="cb32-2"><a href="preparing-environmental-predictors.html#cb32-2"></a>env_data &lt;-<span class="st"> </span><span class="kw">stack</span>(elevData, bio_4a, bio_<span class="dv">15</span>)</span></code></pre></div>
</div>
</div>
<div id="resample-landcover-from-10m-to-1km" class="section level2">
<h2><span class="header-section-number">4.5</span> Resample landcover from 10m to 1km</h2>
<p>We read in a land cover classified image and resample that using the mode function to a 1km resolution. Please note that the resampling process need not be carried out as it has been done already and the resampled raster can be loaded with the subsequent code chunk.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="preparing-environmental-predictors.html#cb33-1"></a><span class="co"># read in landcover raster location</span></span>
<span id="cb33-2"><a href="preparing-environmental-predictors.html#cb33-2"></a><span class="co"># To access the land cover data, please visit: https://daac.ornl.gov/VEGETATION/guides/Decadal_LULC_India.html</span></span>
<span id="cb33-3"><a href="preparing-environmental-predictors.html#cb33-3"></a></span>
<span id="cb33-4"><a href="preparing-environmental-predictors.html#cb33-4"></a>landcover &lt;-<span class="st"> &quot;data/landUseClassification/landcover_roy_2015/&quot;</span></span>
<span id="cb33-5"><a href="preparing-environmental-predictors.html#cb33-5"></a></span>
<span id="cb33-6"><a href="preparing-environmental-predictors.html#cb33-6"></a><span class="co"># read in and crop</span></span>
<span id="cb33-7"><a href="preparing-environmental-predictors.html#cb33-7"></a>landcover &lt;-<span class="st"> </span><span class="kw">raster</span>(landcover)</span>
<span id="cb33-8"><a href="preparing-environmental-predictors.html#cb33-8"></a>buffer_utm &lt;-<span class="st"> </span><span class="kw">st_transform</span>(buffer, <span class="dv">32643</span>)</span>
<span id="cb33-9"><a href="preparing-environmental-predictors.html#cb33-9"></a>landcover &lt;-<span class="st"> </span><span class="kw">crop</span>(</span>
<span id="cb33-10"><a href="preparing-environmental-predictors.html#cb33-10"></a>  landcover,</span>
<span id="cb33-11"><a href="preparing-environmental-predictors.html#cb33-11"></a>  <span class="kw">as</span>(</span>
<span id="cb33-12"><a href="preparing-environmental-predictors.html#cb33-12"></a>    buffer_utm,</span>
<span id="cb33-13"><a href="preparing-environmental-predictors.html#cb33-13"></a>    <span class="st">&quot;Spatial&quot;</span></span>
<span id="cb33-14"><a href="preparing-environmental-predictors.html#cb33-14"></a>  )</span>
<span id="cb33-15"><a href="preparing-environmental-predictors.html#cb33-15"></a>)</span>
<span id="cb33-16"><a href="preparing-environmental-predictors.html#cb33-16"></a></span>
<span id="cb33-17"><a href="preparing-environmental-predictors.html#cb33-17"></a><span class="co"># read reclassification matrix</span></span>
<span id="cb33-18"><a href="preparing-environmental-predictors.html#cb33-18"></a>reclassification_matrix &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/landUseClassification/reclassification-matrix-landCover-2015.csv&quot;</span>)</span>
<span id="cb33-19"><a href="preparing-environmental-predictors.html#cb33-19"></a>reclassification_matrix &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(reclassification_matrix[, <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;To&quot;</span>)])</span>
<span id="cb33-20"><a href="preparing-environmental-predictors.html#cb33-20"></a></span>
<span id="cb33-21"><a href="preparing-environmental-predictors.html#cb33-21"></a><span class="co"># reclassify</span></span>
<span id="cb33-22"><a href="preparing-environmental-predictors.html#cb33-22"></a>landcover_reclassified &lt;-<span class="st"> </span><span class="kw">reclassify</span>(</span>
<span id="cb33-23"><a href="preparing-environmental-predictors.html#cb33-23"></a>  <span class="dt">x =</span> landcover,</span>
<span id="cb33-24"><a href="preparing-environmental-predictors.html#cb33-24"></a>  <span class="dt">rcl =</span> reclassification_matrix</span>
<span id="cb33-25"><a href="preparing-environmental-predictors.html#cb33-25"></a>)</span>
<span id="cb33-26"><a href="preparing-environmental-predictors.html#cb33-26"></a></span>
<span id="cb33-27"><a href="preparing-environmental-predictors.html#cb33-27"></a><span class="co"># write to file</span></span>
<span id="cb33-28"><a href="preparing-environmental-predictors.html#cb33-28"></a><span class="kw">writeRaster</span>(landcover_reclassified,</span>
<span id="cb33-29"><a href="preparing-environmental-predictors.html#cb33-29"></a>  <span class="dt">filename =</span> <span class="st">&quot;data/landUseClassification/landcover_roy_2015_reclassified.tif&quot;</span>,</span>
<span id="cb33-30"><a href="preparing-environmental-predictors.html#cb33-30"></a>  <span class="dt">overwrite =</span> <span class="ot">TRUE</span></span>
<span id="cb33-31"><a href="preparing-environmental-predictors.html#cb33-31"></a>)</span>
<span id="cb33-32"><a href="preparing-environmental-predictors.html#cb33-32"></a></span>
<span id="cb33-33"><a href="preparing-environmental-predictors.html#cb33-33"></a><span class="co"># check reclassification</span></span>
<span id="cb33-34"><a href="preparing-environmental-predictors.html#cb33-34"></a><span class="kw">plot</span>(landcover_reclassified)</span>
<span id="cb33-35"><a href="preparing-environmental-predictors.html#cb33-35"></a></span>
<span id="cb33-36"><a href="preparing-environmental-predictors.html#cb33-36"></a><span class="co"># get extent</span></span>
<span id="cb33-37"><a href="preparing-environmental-predictors.html#cb33-37"></a>e &lt;-<span class="st"> </span><span class="kw">bbox</span>(<span class="kw">raster</span>(landcover))</span>
<span id="cb33-38"><a href="preparing-environmental-predictors.html#cb33-38"></a></span>
<span id="cb33-39"><a href="preparing-environmental-predictors.html#cb33-39"></a><span class="co"># init resolution</span></span>
<span id="cb33-40"><a href="preparing-environmental-predictors.html#cb33-40"></a>res_init &lt;-<span class="st"> </span><span class="kw">res</span>(<span class="kw">raster</span>(landcover))</span>
<span id="cb33-41"><a href="preparing-environmental-predictors.html#cb33-41"></a></span>
<span id="cb33-42"><a href="preparing-environmental-predictors.html#cb33-42"></a><span class="co"># res to transform to 1000m</span></span>
<span id="cb33-43"><a href="preparing-environmental-predictors.html#cb33-43"></a>res_final &lt;-<span class="st"> </span>res_init <span class="op">*</span><span class="st"> </span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>res_init)</span>
<span id="cb33-44"><a href="preparing-environmental-predictors.html#cb33-44"></a></span>
<span id="cb33-45"><a href="preparing-environmental-predictors.html#cb33-45"></a><span class="co"># use gdalutils gdalwarp for resampling transform</span></span>
<span id="cb33-46"><a href="preparing-environmental-predictors.html#cb33-46"></a><span class="co"># to 1km from 10m</span></span>
<span id="cb33-47"><a href="preparing-environmental-predictors.html#cb33-47"></a>gdalUtils<span class="op">::</span><span class="kw">gdalwarp</span>(</span>
<span id="cb33-48"><a href="preparing-environmental-predictors.html#cb33-48"></a>  <span class="dt">srcfile =</span> <span class="st">&quot;data/landUseClassification/landcover_roy_2015_reclassified.tif&quot;</span>,</span>
<span id="cb33-49"><a href="preparing-environmental-predictors.html#cb33-49"></a>  <span class="dt">dstfile =</span> <span class="st">&quot;data/landUseClassification/lc_01000m.tif&quot;</span>,</span>
<span id="cb33-50"><a href="preparing-environmental-predictors.html#cb33-50"></a>  <span class="dt">tr =</span> <span class="kw">c</span>(res_final), <span class="dt">r =</span> <span class="st">&quot;mode&quot;</span>, <span class="dt">te =</span> <span class="kw">c</span>(e)</span>
<span id="cb33-51"><a href="preparing-environmental-predictors.html#cb33-51"></a>)</span></code></pre></div>
<p>We compare the frequency of landcover classes between the original raster and the resampled 1km raster to be certain that the resampling has not resulted in drastic misrepresentation of the frequency of any landcover type. This comparison is made using the figure below.</p>
<div class="figure">
<img src="figs/fig_landcover_resample.png" alt="" />
<p class="caption">Resampling the Roy et al.Â (2015) landcover raster, reclassified into 7 main classes, to a resolution of 1km, preserves the important features of landcover over the study area.</p>
</div>
</div>
<div id="resample-other-rasters-to-1km" class="section level2">
<h2><span class="header-section-number">4.6</span> Resample other rasters to 1km</h2>
<p>We now resample all other rasters to a resolution of 1km.</p>
<div id="read-in-resampled-landcover" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Read in resampled landcover</h3>
<p>Here, we read in the 1km landcover raster and set 0 to NA.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="preparing-environmental-predictors.html#cb34-1"></a>lc_data &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/landUseClassification/lc_01000m.tif&quot;</span>)</span>
<span id="cb34-2"><a href="preparing-environmental-predictors.html#cb34-2"></a>lc_data[lc_data <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
</div>
<div id="reproject-environmental-data-using-landcover-as-a-template" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Reproject environmental data using landcover as a template</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="preparing-environmental-predictors.html#cb35-1"></a><span class="co"># resample to the corresponding landcover data</span></span>
<span id="cb35-2"><a href="preparing-environmental-predictors.html#cb35-2"></a>env_data_resamp &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(</span>
<span id="cb35-3"><a href="preparing-environmental-predictors.html#cb35-3"></a>  <span class="dt">from =</span> env_data, <span class="dt">to =</span> lc_data,</span>
<span id="cb35-4"><a href="preparing-environmental-predictors.html#cb35-4"></a>  <span class="dt">crs =</span> <span class="kw">crs</span>(lc_data), <span class="dt">res =</span> <span class="kw">res</span>(lc_data)</span>
<span id="cb35-5"><a href="preparing-environmental-predictors.html#cb35-5"></a>)</span>
<span id="cb35-6"><a href="preparing-environmental-predictors.html#cb35-6"></a></span>
<span id="cb35-7"><a href="preparing-environmental-predictors.html#cb35-7"></a><span class="co"># export as raster stack</span></span>
<span id="cb35-8"><a href="preparing-environmental-predictors.html#cb35-8"></a>land_stack &lt;-<span class="st"> </span><span class="kw">stack</span>(env_data_resamp, lc_data)</span>
<span id="cb35-9"><a href="preparing-environmental-predictors.html#cb35-9"></a></span>
<span id="cb35-10"><a href="preparing-environmental-predictors.html#cb35-10"></a><span class="co"># get names</span></span>
<span id="cb35-11"><a href="preparing-environmental-predictors.html#cb35-11"></a>land_names &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;data/spatial/landscape_resamp{c(&quot;01&quot;)}_km.tif&#39;</span>)</span>
<span id="cb35-12"><a href="preparing-environmental-predictors.html#cb35-12"></a></span>
<span id="cb35-13"><a href="preparing-environmental-predictors.html#cb35-13"></a><span class="co"># write to file</span></span>
<span id="cb35-14"><a href="preparing-environmental-predictors.html#cb35-14"></a>raster<span class="op">::</span><span class="kw">writeRaster</span>(</span>
<span id="cb35-15"><a href="preparing-environmental-predictors.html#cb35-15"></a>  land_stack, <span class="dt">filename =</span> <span class="kw">as.character</span>(land_names), </span>
<span id="cb35-16"><a href="preparing-environmental-predictors.html#cb35-16"></a>  <span class="dt">overwrite =</span> <span class="ot">TRUE</span></span>
<span id="cb35-17"><a href="preparing-environmental-predictors.html#cb35-17"></a>)</span></code></pre></div>
</div>
</div>
<div id="climate-variables-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">4.7</span> Climate variables in relation to elevation</h2>
<div id="load-resampled-environmental-rasters" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Load resampled environmental rasters</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="preparing-environmental-predictors.html#cb36-1"></a><span class="co"># read landscape prepare for plotting</span></span>
<span id="cb36-2"><a href="preparing-environmental-predictors.html#cb36-2"></a>landscape &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&quot;data/spatial/landscape_resamp01_km.tif&quot;</span>)</span>
<span id="cb36-3"><a href="preparing-environmental-predictors.html#cb36-3"></a></span>
<span id="cb36-4"><a href="preparing-environmental-predictors.html#cb36-4"></a><span class="co"># get proper names</span></span>
<span id="cb36-5"><a href="preparing-environmental-predictors.html#cb36-5"></a>elev_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>)</span>
<span id="cb36-6"><a href="preparing-environmental-predictors.html#cb36-6"></a>chelsa_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bio_4a&quot;</span>, <span class="st">&quot;bio_15&quot;</span>)</span>
<span id="cb36-7"><a href="preparing-environmental-predictors.html#cb36-7"></a></span>
<span id="cb36-8"><a href="preparing-environmental-predictors.html#cb36-8"></a><span class="kw">names</span>(landscape) &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;{c(elev_names, chelsa_names, &quot;landcover&quot;)}&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="preparing-environmental-predictors.html#cb37-1"></a><span class="co"># make duplicate stack</span></span>
<span id="cb37-2"><a href="preparing-environmental-predictors.html#cb37-2"></a>land_data &lt;-<span class="st"> </span>landscape[[<span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)]]</span>
<span id="cb37-3"><a href="preparing-environmental-predictors.html#cb37-3"></a></span>
<span id="cb37-4"><a href="preparing-environmental-predictors.html#cb37-4"></a><span class="co"># convert to list</span></span>
<span id="cb37-5"><a href="preparing-environmental-predictors.html#cb37-5"></a>land_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(land_data)</span>
<span id="cb37-6"><a href="preparing-environmental-predictors.html#cb37-6"></a></span>
<span id="cb37-7"><a href="preparing-environmental-predictors.html#cb37-7"></a><span class="co"># map get values over the stack</span></span>
<span id="cb37-8"><a href="preparing-environmental-predictors.html#cb37-8"></a>land_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(land_data, getValues)</span>
<span id="cb37-9"><a href="preparing-environmental-predictors.html#cb37-9"></a><span class="kw">names</span>(land_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, chelsa_names)</span>
<span id="cb37-10"><a href="preparing-environmental-predictors.html#cb37-10"></a></span>
<span id="cb37-11"><a href="preparing-environmental-predictors.html#cb37-11"></a><span class="co"># conver to dataframe and round to 200m</span></span>
<span id="cb37-12"><a href="preparing-environmental-predictors.html#cb37-12"></a>land_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(land_data)</span>
<span id="cb37-13"><a href="preparing-environmental-predictors.html#cb37-13"></a>land_data &lt;-<span class="st"> </span><span class="kw">drop_na</span>(land_data) <span class="op">%&gt;%</span></span>
<span id="cb37-14"><a href="preparing-environmental-predictors.html#cb37-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev_round =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">200</span>)) <span class="op">%&gt;%</span></span>
<span id="cb37-15"><a href="preparing-environmental-predictors.html#cb37-15"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>elev) <span class="op">%&gt;%</span></span>
<span id="cb37-16"><a href="preparing-environmental-predictors.html#cb37-16"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb37-17"><a href="preparing-environmental-predictors.html#cb37-17"></a>    <span class="dt">cols =</span> <span class="kw">contains</span>(<span class="st">&quot;bio&quot;</span>),</span>
<span id="cb37-18"><a href="preparing-environmental-predictors.html#cb37-18"></a>    <span class="dt">names_to =</span> <span class="st">&quot;clim_var&quot;</span></span>
<span id="cb37-19"><a href="preparing-environmental-predictors.html#cb37-19"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb37-20"><a href="preparing-environmental-predictors.html#cb37-20"></a><span class="st">  </span><span class="kw">group_by</span>(elev_round, clim_var) <span class="op">%&gt;%</span></span>
<span id="cb37-21"><a href="preparing-environmental-predictors.html#cb37-21"></a><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">list</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.), <span class="op">~</span><span class="st"> </span><span class="kw">ci</span>(.)))</span></code></pre></div>
<p>Figure code is hidden in versions rendered as HTML or PDF.</p>
</div>
</div>
<div id="climate-across-land-cover-types" class="section level2">
<h2><span class="header-section-number">4.8</span> Climate across land cover types</h2>
<p>Get climate values per (re-classified) landcover type from the 1km resampled raster.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="preparing-environmental-predictors.html#cb38-1"></a><span class="co"># make duplicate stack again</span></span>
<span id="cb38-2"><a href="preparing-environmental-predictors.html#cb38-2"></a>lc_clim_data &lt;-<span class="st"> </span>landscape[[<span class="kw">c</span>(<span class="st">&quot;landcover&quot;</span>, chelsa_names)]]</span>
<span id="cb38-3"><a href="preparing-environmental-predictors.html#cb38-3"></a></span>
<span id="cb38-4"><a href="preparing-environmental-predictors.html#cb38-4"></a><span class="co"># convert to list</span></span>
<span id="cb38-5"><a href="preparing-environmental-predictors.html#cb38-5"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">as.list</span>(lc_clim_data)</span>
<span id="cb38-6"><a href="preparing-environmental-predictors.html#cb38-6"></a></span>
<span id="cb38-7"><a href="preparing-environmental-predictors.html#cb38-7"></a><span class="co"># map get values over the stack</span></span>
<span id="cb38-8"><a href="preparing-environmental-predictors.html#cb38-8"></a>lc_clim_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(lc_clim_data, getValues)</span>
<span id="cb38-9"><a href="preparing-environmental-predictors.html#cb38-9"></a><span class="kw">names</span>(lc_clim_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;landcover&quot;</span>, chelsa_names)</span>
<span id="cb38-10"><a href="preparing-environmental-predictors.html#cb38-10"></a></span>
<span id="cb38-11"><a href="preparing-environmental-predictors.html#cb38-11"></a><span class="co"># conver to dataframe for histogram</span></span>
<span id="cb38-12"><a href="preparing-environmental-predictors.html#cb38-12"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(lc_clim_data)</span>
<span id="cb38-13"><a href="preparing-environmental-predictors.html#cb38-13"></a></span>
<span id="cb38-14"><a href="preparing-environmental-predictors.html#cb38-14"></a><span class="co"># pivot long</span></span>
<span id="cb38-15"><a href="preparing-environmental-predictors.html#cb38-15"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(</span>
<span id="cb38-16"><a href="preparing-environmental-predictors.html#cb38-16"></a>  lc_clim_data,</span>
<span id="cb38-17"><a href="preparing-environmental-predictors.html#cb38-17"></a>  <span class="dt">cols =</span> <span class="kw">contains</span>(<span class="st">&quot;bio&quot;</span>),</span>
<span id="cb38-18"><a href="preparing-environmental-predictors.html#cb38-18"></a>  <span class="dt">names_to =</span> <span class="st">&quot;climvar&quot;</span></span>
<span id="cb38-19"><a href="preparing-environmental-predictors.html#cb38-19"></a>)</span>
<span id="cb38-20"><a href="preparing-environmental-predictors.html#cb38-20"></a></span>
<span id="cb38-21"><a href="preparing-environmental-predictors.html#cb38-21"></a><span class="co"># make landcover factor</span></span>
<span id="cb38-22"><a href="preparing-environmental-predictors.html#cb38-22"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb38-23"><a href="preparing-environmental-predictors.html#cb38-23"></a>  lc_clim_data,</span>
<span id="cb38-24"><a href="preparing-environmental-predictors.html#cb38-24"></a>  <span class="dt">landcover =</span> <span class="kw">factor</span>(landcover)</span>
<span id="cb38-25"><a href="preparing-environmental-predictors.html#cb38-25"></a>)</span>
<span id="cb38-26"><a href="preparing-environmental-predictors.html#cb38-26"></a></span>
<span id="cb38-27"><a href="preparing-environmental-predictors.html#cb38-27"></a><span class="co"># filter bio </span></span>
<span id="cb38-28"><a href="preparing-environmental-predictors.html#cb38-28"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">filter</span>(</span>
<span id="cb38-29"><a href="preparing-environmental-predictors.html#cb38-29"></a>  lc_clim_data,</span>
<span id="cb38-30"><a href="preparing-environmental-predictors.html#cb38-30"></a>  <span class="op">!</span><span class="kw">is.na</span>(landcover)</span>
<span id="cb38-31"><a href="preparing-environmental-predictors.html#cb38-31"></a>)</span>
<span id="cb38-32"><a href="preparing-environmental-predictors.html#cb38-32"></a></span>
<span id="cb38-33"><a href="preparing-environmental-predictors.html#cb38-33"></a><span class="co"># split by variable</span></span>
<span id="cb38-34"><a href="preparing-environmental-predictors.html#cb38-34"></a>lc_clim_data &lt;-<span class="st"> </span><span class="kw">nest</span>(lc_clim_data, <span class="dt">data =</span> <span class="kw">c</span>(<span class="st">&quot;landcover&quot;</span>, <span class="st">&quot;value&quot;</span>))</span>
<span id="cb38-35"><a href="preparing-environmental-predictors.html#cb38-35"></a></span>
<span id="cb38-36"><a href="preparing-environmental-predictors.html#cb38-36"></a><span class="co"># assign names</span></span>
<span id="cb38-37"><a href="preparing-environmental-predictors.html#cb38-37"></a>lc_clim_data<span class="op">$</span>climvar_name &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb38-38"><a href="preparing-environmental-predictors.html#cb38-38"></a>  <span class="st">&quot;Temperature seasonality&quot;</span>,</span>
<span id="cb38-39"><a href="preparing-environmental-predictors.html#cb38-39"></a>  <span class="st">&quot;Precipitation seasonality&quot;</span></span>
<span id="cb38-40"><a href="preparing-environmental-predictors.html#cb38-40"></a>)</span></code></pre></div>
<p>Plot density plots of climate seasonality per LC type.</p>
</div>
<div id="land-cover-type-in-relation-to-elevation" class="section level2">
<h2><span class="header-section-number">4.9</span> Land cover type in relation to elevation</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="preparing-environmental-predictors.html#cb39-1"></a><span class="co"># get data from landscape rasters</span></span>
<span id="cb39-2"><a href="preparing-environmental-predictors.html#cb39-2"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb39-3"><a href="preparing-environmental-predictors.html#cb39-3"></a>  <span class="dt">elev =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;elev&quot;</span>]]),</span>
<span id="cb39-4"><a href="preparing-environmental-predictors.html#cb39-4"></a>  <span class="dt">landcover =</span> <span class="kw">getValues</span>(landscape[[<span class="st">&quot;landcover&quot;</span>]])</span>
<span id="cb39-5"><a href="preparing-environmental-predictors.html#cb39-5"></a>)</span>
<span id="cb39-6"><a href="preparing-environmental-predictors.html#cb39-6"></a></span>
<span id="cb39-7"><a href="preparing-environmental-predictors.html#cb39-7"></a><span class="co"># process data for proportions</span></span>
<span id="cb39-8"><a href="preparing-environmental-predictors.html#cb39-8"></a>lc_elev &lt;-<span class="st"> </span>lc_elev <span class="op">%&gt;%</span></span>
<span id="cb39-9"><a href="preparing-environmental-predictors.html#cb39-9"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(landcover), <span class="op">!</span><span class="kw">is.na</span>(elev)) <span class="op">%&gt;%</span></span>
<span id="cb39-10"><a href="preparing-environmental-predictors.html#cb39-10"></a><span class="st">  </span><span class="co"># round elev to 100m</span></span>
<span id="cb39-11"><a href="preparing-environmental-predictors.html#cb39-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elev =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(elev, <span class="dv">100</span>)) <span class="op">%&gt;%</span></span>
<span id="cb39-12"><a href="preparing-environmental-predictors.html#cb39-12"></a><span class="st">  </span><span class="kw">count</span>(elev, landcover) <span class="op">%&gt;%</span></span>
<span id="cb39-13"><a href="preparing-environmental-predictors.html#cb39-13"></a><span class="st">  </span><span class="kw">group_by</span>(elev) <span class="op">%&gt;%</span></span>
<span id="cb39-14"><a href="preparing-environmental-predictors.html#cb39-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</span>
<span id="cb39-15"><a href="preparing-environmental-predictors.html#cb39-15"></a></span>
<span id="cb39-16"><a href="preparing-environmental-predictors.html#cb39-16"></a><span class="co"># fill out lc elev</span></span>
<span id="cb39-17"><a href="preparing-environmental-predictors.html#cb39-17"></a>lc_elev_canon &lt;-<span class="st"> </span><span class="kw">crossing</span>(</span>
<span id="cb39-18"><a href="preparing-environmental-predictors.html#cb39-18"></a>  <span class="dt">elev =</span> <span class="kw">unique</span>(lc_elev<span class="op">$</span>elev),</span>
<span id="cb39-19"><a href="preparing-environmental-predictors.html#cb39-19"></a>  <span class="dt">landcover =</span> <span class="kw">unique</span>(lc_elev<span class="op">$</span>landcover)</span>
<span id="cb39-20"><a href="preparing-environmental-predictors.html#cb39-20"></a>)</span>
<span id="cb39-21"><a href="preparing-environmental-predictors.html#cb39-21"></a></span>
<span id="cb39-22"><a href="preparing-environmental-predictors.html#cb39-22"></a><span class="co"># bind with lcelev</span></span>
<span id="cb39-23"><a href="preparing-environmental-predictors.html#cb39-23"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">full_join</span>(lc_elev, lc_elev_canon)</span>
<span id="cb39-24"><a href="preparing-environmental-predictors.html#cb39-24"></a></span>
<span id="cb39-25"><a href="preparing-environmental-predictors.html#cb39-25"></a><span class="co"># convert NA to zero</span></span>
<span id="cb39-26"><a href="preparing-environmental-predictors.html#cb39-26"></a>lc_elev &lt;-<span class="st"> </span><span class="kw">replace_na</span>(lc_elev, <span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">0</span>, <span class="dt">prop =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Figure code is hidden in versions rendered as HTML and PDF.</p>
</div>
<div id="main-text-figure-2" class="section level2">
<h2><span class="header-section-number">4.10</span> Main Text Figure 2</h2>
<div class="figure">
<img src="figs/fig_02.png" alt="" />
<p class="caption"><strong>Climate and land cover vary strongly along the elevation gradient in the Nilgiri and Anamalai Hills.</strong>
Both (a) temperature seasonality and (b) precipitation seasonality, between the months of December and May, declines with increasing elevation across the Nilgiri and Anamalai Hills. Climatic variation is not very strongly associated with land cover type, as both natural habitats such as forests, and human-associated habitat types such as plantations show low seasonality in (c) temperature, and (d) precipitation. (e) Most elevations host a range of land cover types: while human-associated habitats such as agriculture are concentrated at lower elevations, and more natural types such as grasslands and forests are associated with higher elevations, each of these types is also found outside their characteristic elevational bands. We calculated climate seasonalities (BIOCLIM 4a and 15: temperature and precipitation, respectively) using CHELSA data over 1979 â 2013, from December to May (Karger et al.Â 2017), and present mean seasonality values (vertical bars show standard deviation) for every 200 m elevational band. Land cover types were taken from a reclassification of Roy et al.Â (2015; see main text) at 100 m elevational bands. Land cover types covering &lt; 1% of an elevational band are shaded grey. All landscape layers were first resampled to 1 km resolution.</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preparing-ebird-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="preparing-checklist-calibration-index.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/03_prep-environmental-predictors.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
