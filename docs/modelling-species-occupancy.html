<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 9 Modelling Species Occupancy | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 9 Modelling Species Occupancy | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 9 Modelling Species Occupancy | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="vjjan91/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 9 Modelling Species Occupancy | Source code and supplementary material for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  



<meta name="date" content="2022-04-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-covariates-to-checklist-data.html"/>
<link rel="next" href="visualizing-occupancy-predictor-effects.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.1</b> Data access</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.2</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html"><i class="fa fa-check"></i><b>2</b> Selecting species of interest</a><ul>
<li class="chapter" data-level="2.1" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-libraries"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#subset-species-by-geographical-confines-of-the-study-area"><i class="fa fa-check"></i><b>2.2</b> Subset species by geographical confines of the study area</a></li>
<li class="chapter" data-level="2.3" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#subset-an-initial-list-of-terrestrial-birds-based-on-a-minimum-of-1000-detections-between-2013-2021-and-b-remove-species-that-are-often-easily-confused-with-congeners"><i class="fa fa-check"></i><b>2.3</b> Subset an initial list of terrestrial birds based on a) minimum of 1000 detections between 2013-2021 and b) remove species that are often easily confused with congeners</a></li>
<li class="chapter" data-level="2.4" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#read-subset-of-species-following-filtering-and-removal-of-waterbirds-raptors-and-other-noctural-species"><i class="fa fa-check"></i><b>2.4</b> Read subset of species following filtering and removal of waterbirds, raptors, and other noctural species</a></li>
<li class="chapter" data-level="2.5" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#load-raw-data-for-locations"><i class="fa fa-check"></i><b>2.5</b> Load raw data for locations</a></li>
<li class="chapter" data-level="2.6" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#get-proportional-obs-counts-in-25km-cells"><i class="fa fa-check"></i><b>2.6</b> Get proportional obs counts in 25km cells</a></li>
<li class="chapter" data-level="2.7" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#which-species-are-reported-sufficiently-in-checklists"><i class="fa fa-check"></i><b>2.7</b> Which species are reported sufficiently in checklists?</a></li>
<li class="chapter" data-level="2.8" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#figure-checklist-distribution"><i class="fa fa-check"></i><b>2.8</b> Figure: Checklist distribution</a></li>
<li class="chapter" data-level="2.9" data-path="selecting-species-of-interest.html"><a href="selecting-species-of-interest.html#prepare-the-species-list"><i class="fa fa-check"></i><b>2.9</b> Prepare the species list</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>3</b> Preparing eBird Data</a><ul>
<li class="chapter" data-level="3.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>3.2</b> Filter data</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>3.3</b> Process filtered data</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>3.4</b> Spatial filter</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>3.5</b> Handle presence data</a></li>
<li class="chapter" data-level="3.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>3.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>4</b> Preparing Environmental Predictors</a><ul>
<li class="chapter" data-level="4.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>4.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>4.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>4.4</b> Prepare CHELSA rasters</a><ul>
<li class="chapter" data-level="4.4.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-15"><i class="fa fa-check"></i><b>4.4.1</b> Prepare BIOCLIM 4a and 15</a></li>
<li class="chapter" data-level="4.4.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a"><i class="fa fa-check"></i><b>4.4.2</b> Prepare BIOCLIM 4a</a></li>
<li class="chapter" data-level="4.4.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-15"><i class="fa fa-check"></i><b>4.4.3</b> Prepare Bioclim 15</a></li>
<li class="chapter" data-level="4.4.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate"><i class="fa fa-check"></i><b>4.4.4</b> Stack terrain and climate</a></li>
<li class="chapter" data-level="4.4.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate-1"><i class="fa fa-check"></i><b>4.4.5</b> Stack terrain and climate</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>4.5</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>4.6</b> Resample other rasters to 1km</a><ul>
<li class="chapter" data-level="4.6.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>4.6.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="4.6.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>4.6.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-variables-in-relation-to-elevation"><i class="fa fa-check"></i><b>4.7</b> Climate variables in relation to elevation</a><ul>
<li class="chapter" data-level="4.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>4.7.1</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-across-land-cover-types"><i class="fa fa-check"></i><b>4.8</b> Climate across land cover types</a></li>
<li class="chapter" data-level="4.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>4.9</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="4.10" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>4.10</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html"><i class="fa fa-check"></i><b>5</b> Preparing Checklist Calibration Index</a><ul>
<li class="chapter" data-level="5.1" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-data"><i class="fa fa-check"></i><b>5.2</b> Prepare data</a></li>
<li class="chapter" data-level="5.3" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>5.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="5.4" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>5.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="5.5" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>5.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="5.6" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#get-landcover"><i class="fa fa-check"></i><b>5.6</b> Get landcover</a></li>
<li class="chapter" data-level="5.7" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#filter-checklist-data"><i class="fa fa-check"></i><b>5.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="5.8" data-path="preparing-checklist-calibration-index.html"><a href="preparing-checklist-calibration-index.html#model-observer-expertise"><i class="fa fa-check"></i><b>5.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>6</b> Examining Spatial Sampling Bias</a><ul>
<li class="chapter" data-level="6.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-3"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="6.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#read-checklist-data"><i class="fa fa-check"></i><b>6.2</b> Read checklist data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>6.2.1</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="6.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#get-background-land-for-plotting"><i class="fa fa-check"></i><b>6.2.2</b> Get background land for plotting</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-main-text-figure-3"><i class="fa fa-check"></i><b>6.3</b> Prepare Main Text Figure 3</a><ul>
<li class="chapter" data-level="6.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>6.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="6.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>6.3.2</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="6.3.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>6.3.3</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="6.3.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatial-distribution-of-distances-to-neighbours"><i class="fa fa-check"></i><b>6.3.4</b> Spatial distribution of distances to neighbours</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#figure-spatial-sampling-bias"><i class="fa fa-check"></i><b>6.4</b> Figure: Spatial sampling bias</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html"><i class="fa fa-check"></i><b>7</b> Checking Temporal Sampling Frequency</a><ul>
<li class="chapter" data-level="7.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-libraries"><i class="fa fa-check"></i><b>7.1</b> Load libraries</a></li>
<li class="chapter" data-level="7.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-checklist-data"><i class="fa fa-check"></i><b>7.2</b> Load checklist data</a></li>
<li class="chapter" data-level="7.3" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-time-differences-per-grid-cell"><i class="fa fa-check"></i><b>7.3</b> Get time differences per grid cell</a></li>
<li class="chapter" data-level="7.4" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#time-since-previous-checklist"><i class="fa fa-check"></i><b>7.4</b> Time Since Previous Checklist</a><ul>
<li class="chapter" data-level="7.4.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-aux-data"><i class="fa fa-check"></i><b>7.4.1</b> Get aux data</a></li>
<li class="chapter" data-level="7.4.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#histogram-of-lags"><i class="fa fa-check"></i><b>7.4.2</b> Histogram of lags</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#main-text-figure-3"><i class="fa fa-check"></i><b>7.5</b> Main Text Figure 3</a></li>
<li class="chapter" data-level="7.6" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#checklists-per-month"><i class="fa fa-check"></i><b>7.6</b> Checklists per Month</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>8</b> Adding Covariates to Checklist Data</a><ul>
<li class="chapter" data-level="8.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>8.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="8.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>8.2</b> Spatial subsampling</a><ul>
<li class="chapter" data-level="8.2.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#counting-presence-observation-proportion"><i class="fa fa-check"></i><b>8.2.1</b> Counting presence observation proportion</a></li>
<li class="chapter" data-level="8.2.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-spatial-thinning"><i class="fa fa-check"></i><b>8.2.2</b> Count absences after spatial thinning</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>8.3</b> Temporal subsampling</a><ul>
<li class="chapter" data-level="8.3.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-temporal-thinning"><i class="fa fa-check"></i><b>8.3.1</b> Count absences after temporal thinning</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>8.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="8.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>8.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="8.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>8.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="8.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>8.7</b> Spatial buffer-wide covariates</a><ul>
<li class="chapter" data-level="8.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>8.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="8.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>8.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="8.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>8.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>9</b> Modelling Species Occupancy</a><ul>
<li class="chapter" data-level="9.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>9.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="9.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-prepare-covariates"><i class="fa fa-check"></i><b>9.1</b> Load dataframe and prepare covariates</a><ul>
<li class="chapter" data-level="9.1.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-the-sampling-protocol"><i class="fa fa-check"></i><b>9.1.1</b> Handle the sampling protocol</a></li>
<li class="chapter" data-level="9.1.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-time-and-date"><i class="fa fa-check"></i><b>9.1.2</b> Handle time and date</a></li>
<li class="chapter" data-level="9.1.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#scaling-covariates"><i class="fa fa-check"></i><b>9.1.3</b> Scaling covariates</a></li>
<li class="chapter" data-level="9.1.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#correct-date-format"><i class="fa fa-check"></i><b>9.1.4</b> Correct date format</a></li>
<li class="chapter" data-level="9.1.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#check-for-correlated-covariates"><i class="fa fa-check"></i><b>9.1.5</b> Check for correlated covariates</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>9.2</b> Running a null model</a></li>
<li class="chapter" data-level="9.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>9.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="9.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>9.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="9.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>9.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>10</b> Visualizing Occupancy Predictor Effects</a><ul>
<li class="chapter" data-level="10.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-4"><i class="fa fa-check"></i><b>10.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="10.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>10.2</b> Load species list</a></li>
<li class="chapter" data-level="10.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>10.3</b> Show AIC weight importance</a><ul>
<li class="chapter" data-level="10.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>10.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="10.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>10.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>10.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="10.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>10.5</b> Get predictor effects</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><i class="fa fa-check"></i><b>11</b> Predicting species-specific occupancy as a function of significant predictors</a><ul>
<li class="chapter" data-level="11.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-libraries-5"><i class="fa fa-check"></i><b>11.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="11.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#read-data"><i class="fa fa-check"></i><b>11.2</b> Read data</a></li>
<li class="chapter" data-level="11.3" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-predictor-data"><i class="fa fa-check"></i><b>11.3</b> Prepare predictor data</a></li>
<li class="chapter" data-level="11.4" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#get-predictor-responses"><i class="fa fa-check"></i><b>11.4</b> Get predictor responses</a></li>
<li class="chapter" data-level="11.5" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#get-probability-of-occupancy"><i class="fa fa-check"></i><b>11.5</b> Get probability of occupancy</a></li>
<li class="chapter" data-level="11.6" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#add-scaling-for-predictors"><i class="fa fa-check"></i><b>11.6</b> Add scaling for predictors</a><ul>
<li class="chapter" data-level="11.6.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#figure-occupancy-predictors"><i class="fa fa-check"></i><b>11.6.1</b> Figure: Occupancy ~ predictors</a></li>
<li class="chapter" data-level="11.6.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#figures-occupancy-predictors-for-all-species"><i class="fa fa-check"></i><b>11.6.2</b> Figures: Occupancy ~ predictors for all species</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#mapping-species-occupancy"><i class="fa fa-check"></i><b>11.7</b> Mapping species occupancy</a><ul>
<li class="chapter" data-level="11.7.1" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#read-in-raster-layers"><i class="fa fa-check"></i><b>11.7.1</b> Read in raster layers</a></li>
<li class="chapter" data-level="11.7.2" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#split-landcover-into-proportions-per-1km"><i class="fa fa-check"></i><b>11.7.2</b> Split landcover into proportions per 1km</a></li>
<li class="chapter" data-level="11.7.3" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-climatic-layers"><i class="fa fa-check"></i><b>11.7.3</b> Prepare climatic layers</a></li>
<li class="chapter" data-level="11.7.4" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#mask-by-study-area"><i class="fa fa-check"></i><b>11.7.4</b> Mask by study area</a></li>
<li class="chapter" data-level="11.7.5" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#plot-full-bounds-of-landscape-variables"><i class="fa fa-check"></i><b>11.7.5</b> Plot full bounds of landscape variables</a></li>
<li class="chapter" data-level="11.7.6" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-soi-predictors"><i class="fa fa-check"></i><b>11.7.6</b> Prepare soi predictors</a></li>
<li class="chapter" data-level="11.7.7" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-species-occupancy-for-soi"><i class="fa fa-check"></i><b>11.7.7</b> Prepare species occupancy for SOI</a></li>
<li class="chapter" data-level="11.7.8" data-path="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html"><a href="predicting-species-specific-occupancy-as-a-function-of-significant-predictors.html#prepare-species-occupancy-for-all-species"><i class="fa fa-check"></i><b>11.7.8</b> Prepare species occupancy for all species</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code and supplementary material for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-species-occupancy" class="section level1">
<h1><span class="header-section-number">Section 9</span> Modelling Species Occupancy</h1>
<div id="load-necessary-libraries" class="section level3">
<h3><span class="header-section-number">9.0.1</span> Load necessary libraries</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="modelling-species-occupancy.html#cb84-1"></a><span class="co"># Load libraries</span></span>
<span id="cb84-2"><a href="modelling-species-occupancy.html#cb84-2"></a><span class="co"># for ebird data</span></span>
<span id="cb84-3"><a href="modelling-species-occupancy.html#cb84-3"></a><span class="kw">library</span>(auk)</span>
<span id="cb84-4"><a href="modelling-species-occupancy.html#cb84-4"></a><span class="kw">library</span>(ebirdst)</span>
<span id="cb84-5"><a href="modelling-species-occupancy.html#cb84-5"></a></span>
<span id="cb84-6"><a href="modelling-species-occupancy.html#cb84-6"></a><span class="co"># general data</span></span>
<span id="cb84-7"><a href="modelling-species-occupancy.html#cb84-7"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb84-8"><a href="modelling-species-occupancy.html#cb84-8"></a><span class="kw">library</span>(data.table)</span>
<span id="cb84-9"><a href="modelling-species-occupancy.html#cb84-9"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb84-10"><a href="modelling-species-occupancy.html#cb84-10"></a><span class="kw">library</span>(openxlsx)</span>
<span id="cb84-11"><a href="modelling-species-occupancy.html#cb84-11"></a><span class="kw">library</span>(raster) <span class="co"># probably unnecessary</span></span>
<span id="cb84-12"><a href="modelling-species-occupancy.html#cb84-12"></a></span>
<span id="cb84-13"><a href="modelling-species-occupancy.html#cb84-13"></a><span class="co"># for models</span></span>
<span id="cb84-14"><a href="modelling-species-occupancy.html#cb84-14"></a><span class="kw">library</span>(unmarked)</span>
<span id="cb84-15"><a href="modelling-species-occupancy.html#cb84-15"></a><span class="kw">library</span>(MuMIn)</span>
<span id="cb84-16"><a href="modelling-species-occupancy.html#cb84-16"></a><span class="kw">library</span>(AICcmodavg)</span>
<span id="cb84-17"><a href="modelling-species-occupancy.html#cb84-17"></a><span class="kw">library</span>(fields)</span>
<span id="cb84-18"><a href="modelling-species-occupancy.html#cb84-18"></a></span>
<span id="cb84-19"><a href="modelling-species-occupancy.html#cb84-19"></a><span class="co"># for computation</span></span>
<span id="cb84-20"><a href="modelling-species-occupancy.html#cb84-20"></a><span class="kw">library</span>(doParallel)</span>
<span id="cb84-21"><a href="modelling-species-occupancy.html#cb84-21"></a><span class="kw">library</span>(snow)</span>
<span id="cb84-22"><a href="modelling-species-occupancy.html#cb84-22"></a><span class="kw">library</span>(ecodist)</span>
<span id="cb84-23"><a href="modelling-species-occupancy.html#cb84-23"></a></span>
<span id="cb84-24"><a href="modelling-species-occupancy.html#cb84-24"></a><span class="co"># Source necessary functions</span></span>
<span id="cb84-25"><a href="modelling-species-occupancy.html#cb84-25"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</span>
<span id="cb84-26"><a href="modelling-species-occupancy.html#cb84-26"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_model_estimate_collection.r&quot;</span>)</span></code></pre></div>
</div>
<div id="load-dataframe-and-prepare-covariates" class="section level2">
<h2><span class="header-section-number">9.1</span> Load dataframe and prepare covariates</h2>
<p>Here, we load the required dataframe that contains 10 random visits to a site and environmental covariates that were prepared at a spatial scale of 2.5 sq.km. We also scaled all covariates (mean around 0 and standard deviation of 1). Next, we ensured that only Traveling and Stationary checklists were considered. Even though stationary counts have no distance traveled, we defaulted all stationary accounts to an effective distance of 100m, which we consider the average maximum detection radius for most bird species in our area.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="modelling-species-occupancy.html#cb85-1"></a><span class="co"># Load in the prepared dataframe</span></span>
<span id="cb85-2"><a href="modelling-species-occupancy.html#cb85-2"></a>dat &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/04_data-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb85-3"><a href="modelling-species-occupancy.html#cb85-3"></a>dat &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(dat)</span>
<span id="cb85-4"><a href="modelling-species-occupancy.html#cb85-4"></a><span class="kw">head</span>(dat)</span></code></pre></div>
<div id="handle-the-sampling-protocol" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Handle the sampling protocol</h3>
<p>Select protocol and add 0.1 km to stationary checklists.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="modelling-species-occupancy.html#cb86-1"></a><span class="co"># Some more pre-processing to get the right data structures</span></span>
<span id="cb86-2"><a href="modelling-species-occupancy.html#cb86-2"></a></span>
<span id="cb86-3"><a href="modelling-species-occupancy.html#cb86-3"></a><span class="co"># Ensuring that only Traveling and Stationary checklists were considered</span></span>
<span id="cb86-4"><a href="modelling-species-occupancy.html#cb86-4"></a><span class="kw">names</span>(dat)</span>
<span id="cb86-5"><a href="modelling-species-occupancy.html#cb86-5"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(protocol_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Traveling&quot;</span>, <span class="st">&quot;Stationary&quot;</span>))</span>
<span id="cb86-6"><a href="modelling-species-occupancy.html#cb86-6"></a></span>
<span id="cb86-7"><a href="modelling-species-occupancy.html#cb86-7"></a><span class="co"># We take all stationary counts and give them a distance of 100 m (so 0.1 km),</span></span>
<span id="cb86-8"><a href="modelling-species-occupancy.html#cb86-8"></a><span class="co"># as that&#39;s approximately the max normal hearing distance for people doing point</span></span>
<span id="cb86-9"><a href="modelling-species-occupancy.html#cb86-9"></a><span class="co"># counts.</span></span>
<span id="cb86-10"><a href="modelling-species-occupancy.html#cb86-10"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb86-11"><a href="modelling-species-occupancy.html#cb86-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">effort_distance_km =</span> <span class="kw">if_else</span>(</span>
<span id="cb86-12"><a href="modelling-species-occupancy.html#cb86-12"></a>    effort_distance_km <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span></span>
<span id="cb86-13"><a href="modelling-species-occupancy.html#cb86-13"></a><span class="st">      </span>protocol_type <span class="op">==</span><span class="st"> &quot;Stationary&quot;</span>,</span>
<span id="cb86-14"><a href="modelling-species-occupancy.html#cb86-14"></a>    <span class="fl">0.1</span>, effort_distance_km</span>
<span id="cb86-15"><a href="modelling-species-occupancy.html#cb86-15"></a>  ))</span></code></pre></div>
</div>
<div id="handle-time-and-date" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Handle time and date</h3>
<p>Convert time and date to julian date and minutes since day.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="modelling-species-occupancy.html#cb87-1"></a><span class="co"># Converting time observations started to numeric and adding it as a new column</span></span>
<span id="cb87-2"><a href="modelling-species-occupancy.html#cb87-2"></a><span class="co"># This new column will be minute_observations_started</span></span>
<span id="cb87-3"><a href="modelling-species-occupancy.html#cb87-3"></a>dat &lt;-</span>
<span id="cb87-4"><a href="modelling-species-occupancy.html#cb87-4"></a><span class="st">  </span>dat <span class="op">%&gt;%</span></span>
<span id="cb87-5"><a href="modelling-species-occupancy.html#cb87-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb87-6"><a href="modelling-species-occupancy.html#cb87-6"></a>    <span class="dt">min_obs_started =</span> <span class="kw">as.integer</span>(</span>
<span id="cb87-7"><a href="modelling-species-occupancy.html#cb87-7"></a>      <span class="kw">as.difftime</span>(</span>
<span id="cb87-8"><a href="modelling-species-occupancy.html#cb87-8"></a>        time_observations_started,</span>
<span id="cb87-9"><a href="modelling-species-occupancy.html#cb87-9"></a>        <span class="dt">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>, <span class="dt">units =</span> <span class="st">&quot;mins&quot;</span></span>
<span id="cb87-10"><a href="modelling-species-occupancy.html#cb87-10"></a>      )</span>
<span id="cb87-11"><a href="modelling-species-occupancy.html#cb87-11"></a>    )</span>
<span id="cb87-12"><a href="modelling-species-occupancy.html#cb87-12"></a>  )</span>
<span id="cb87-13"><a href="modelling-species-occupancy.html#cb87-13"></a></span>
<span id="cb87-14"><a href="modelling-species-occupancy.html#cb87-14"></a><span class="co"># Adding the julian date to the dataframe</span></span>
<span id="cb87-15"><a href="modelling-species-occupancy.html#cb87-15"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb87-16"><a href="modelling-species-occupancy.html#cb87-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">julian_date =</span> lubridate<span class="op">::</span><span class="kw">yday</span>(observation_date))</span>
<span id="cb87-17"><a href="modelling-species-occupancy.html#cb87-17"></a></span>
<span id="cb87-18"><a href="modelling-species-occupancy.html#cb87-18"></a><span class="co"># recode julian date to model it as a linear predictor</span></span>
<span id="cb87-19"><a href="modelling-species-occupancy.html#cb87-19"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb87-20"><a href="modelling-species-occupancy.html#cb87-20"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb87-21"><a href="modelling-species-occupancy.html#cb87-21"></a>    <span class="dt">newjulianDate =</span></span>
<span id="cb87-22"><a href="modelling-species-occupancy.html#cb87-22"></a>      <span class="kw">case_when</span>(</span>
<span id="cb87-23"><a href="modelling-species-occupancy.html#cb87-23"></a>        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">334</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">365</span> <span class="op">~</span></span>
<span id="cb87-24"><a href="modelling-species-occupancy.html#cb87-24"></a><span class="st">        </span>(julian_date <span class="op">-</span><span class="st"> </span><span class="dv">333</span>),</span>
<span id="cb87-25"><a href="modelling-species-occupancy.html#cb87-25"></a>        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">152</span> <span class="op">~</span></span>
<span id="cb87-26"><a href="modelling-species-occupancy.html#cb87-26"></a><span class="st">        </span>(julian_date <span class="op">+</span><span class="st"> </span><span class="dv">31</span>)</span>
<span id="cb87-27"><a href="modelling-species-occupancy.html#cb87-27"></a>      )</span>
<span id="cb87-28"><a href="modelling-species-occupancy.html#cb87-28"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb87-29"><a href="modelling-species-occupancy.html#cb87-29"></a><span class="st">  </span><span class="kw">drop_na</span>(newjulianDate)</span>
<span id="cb87-30"><a href="modelling-species-occupancy.html#cb87-30"></a></span>
<span id="cb87-31"><a href="modelling-species-occupancy.html#cb87-31"></a><span class="co"># recode time observations started to model it as a linear predictor</span></span>
<span id="cb87-32"><a href="modelling-species-occupancy.html#cb87-32"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb87-33"><a href="modelling-species-occupancy.html#cb87-33"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb87-34"><a href="modelling-species-occupancy.html#cb87-34"></a>    <span class="dt">newmin_obs_started =</span> <span class="kw">case_when</span>(</span>
<span id="cb87-35"><a href="modelling-species-occupancy.html#cb87-35"></a>      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">300</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">~</span></span>
<span id="cb87-36"><a href="modelling-species-occupancy.html#cb87-36"></a><span class="st">      </span><span class="kw">abs</span>(min_obs_started <span class="op">-</span><span class="st"> </span><span class="dv">720</span>),</span>
<span id="cb87-37"><a href="modelling-species-occupancy.html#cb87-37"></a>      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1140</span> <span class="op">~</span></span>
<span id="cb87-38"><a href="modelling-species-occupancy.html#cb87-38"></a><span class="st">      </span><span class="kw">abs</span>(<span class="dv">720</span> <span class="op">-</span><span class="st"> </span>min_obs_started)</span>
<span id="cb87-39"><a href="modelling-species-occupancy.html#cb87-39"></a>    )</span>
<span id="cb87-40"><a href="modelling-species-occupancy.html#cb87-40"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb87-41"><a href="modelling-species-occupancy.html#cb87-41"></a><span class="st">  </span><span class="kw">drop_na</span>(newmin_obs_started)</span></code></pre></div>
</div>
<div id="scaling-covariates" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Scaling covariates</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="modelling-species-occupancy.html#cb88-1"></a><span class="co"># Removing other unnecessary columns from the dataframe and creating a clean one without the rest</span></span>
<span id="cb88-2"><a href="modelling-species-occupancy.html#cb88-2"></a><span class="kw">names</span>(dat)</span>
<span id="cb88-3"><a href="modelling-species-occupancy.html#cb88-3"></a><span class="co"># select relevant columns BY NAME</span></span>
<span id="cb88-4"><a href="modelling-species-occupancy.html#cb88-4"></a>dat &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(</span>
<span id="cb88-5"><a href="modelling-species-occupancy.html#cb88-5"></a>  dat,</span>
<span id="cb88-6"><a href="modelling-species-occupancy.html#cb88-6"></a>  <span class="kw">c</span>(</span>
<span id="cb88-7"><a href="modelling-species-occupancy.html#cb88-7"></a>    <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>, <span class="st">&quot;locality&quot;</span>,</span>
<span id="cb88-8"><a href="modelling-species-occupancy.html#cb88-8"></a>    <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;observer_id&quot;</span>,</span>
<span id="cb88-9"><a href="modelling-species-occupancy.html#cb88-9"></a>    <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>,</span>
<span id="cb88-10"><a href="modelling-species-occupancy.html#cb88-10"></a>    <span class="st">&quot;protocol_type&quot;</span>, <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;pres_abs&quot;</span></span>
<span id="cb88-11"><a href="modelling-species-occupancy.html#cb88-11"></a>  ),</span>
<span id="cb88-12"><a href="modelling-species-occupancy.html#cb88-12"></a></span>
<span id="cb88-13"><a href="modelling-species-occupancy.html#cb88-13"></a>  <span class="co"># rename X-Y but </span><span class="al">NOTE</span><span class="co"> THEY ARE IN UTM COORDINATES</span></span>
<span id="cb88-14"><a href="modelling-species-occupancy.html#cb88-14"></a>  <span class="dt">longitude =</span> <span class="st">&quot;X&quot;</span>, <span class="dt">latitude =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb88-15"><a href="modelling-species-occupancy.html#cb88-15"></a>  expertise,</span>
<span id="cb88-16"><a href="modelling-species-occupancy.html#cb88-16"></a></span>
<span id="cb88-17"><a href="modelling-species-occupancy.html#cb88-17"></a>  <span class="co"># elevation and climate layers</span></span>
<span id="cb88-18"><a href="modelling-species-occupancy.html#cb88-18"></a>  elev, bio4, bio15,</span>
<span id="cb88-19"><a href="modelling-species-occupancy.html#cb88-19"></a></span>
<span id="cb88-20"><a href="modelling-species-occupancy.html#cb88-20"></a>  <span class="co"># all LANDCOVER COLUMNS</span></span>
<span id="cb88-21"><a href="modelling-species-occupancy.html#cb88-21"></a>  <span class="kw">matches</span>(<span class="st">&quot;lc&quot;</span>),</span>
<span id="cb88-22"><a href="modelling-species-occupancy.html#cb88-22"></a></span>
<span id="cb88-23"><a href="modelling-species-occupancy.html#cb88-23"></a>  <span class="co"># set new columns to old column names</span></span>
<span id="cb88-24"><a href="modelling-species-occupancy.html#cb88-24"></a>  <span class="dt">julian_date =</span> <span class="st">&quot;newjulianDate&quot;</span>,</span>
<span id="cb88-25"><a href="modelling-species-occupancy.html#cb88-25"></a>  <span class="dt">min_obs_started =</span> <span class="st">&quot;newmin_obs_started&quot;</span></span>
<span id="cb88-26"><a href="modelling-species-occupancy.html#cb88-26"></a>)</span>
<span id="cb88-27"><a href="modelling-species-occupancy.html#cb88-27"></a></span>
<span id="cb88-28"><a href="modelling-species-occupancy.html#cb88-28"></a><span class="co"># add year and convert presence-absence to integer</span></span>
<span id="cb88-29"><a href="modelling-species-occupancy.html#cb88-29"></a>dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb88-30"><a href="modelling-species-occupancy.html#cb88-30"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb88-31"><a href="modelling-species-occupancy.html#cb88-31"></a>    <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</span>
<span id="cb88-32"><a href="modelling-species-occupancy.html#cb88-32"></a>    <span class="dt">pres_abs =</span> <span class="kw">as.integer</span>(pres_abs)</span>
<span id="cb88-33"><a href="modelling-species-occupancy.html#cb88-33"></a>  ) <span class="co"># occupancy modeling requires an integer response</span></span>
<span id="cb88-34"><a href="modelling-species-occupancy.html#cb88-34"></a></span>
<span id="cb88-35"><a href="modelling-species-occupancy.html#cb88-35"></a><span class="co"># Scaling detection and occupancy covariates</span></span>
<span id="cb88-36"><a href="modelling-species-occupancy.html#cb88-36"></a>dat.scaled &lt;-<span class="st"> </span>dat<span class="fl">.1</span></span>
<span id="cb88-37"><a href="modelling-species-occupancy.html#cb88-37"></a></span>
<span id="cb88-38"><a href="modelling-species-occupancy.html#cb88-38"></a><span class="co"># Note: Never refer to columns by numbers, numbers change, names remain</span></span>
<span id="cb88-39"><a href="modelling-species-occupancy.html#cb88-39"></a>cols_to_scale &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb88-40"><a href="modelling-species-occupancy.html#cb88-40"></a>  <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb88-41"><a href="modelling-species-occupancy.html#cb88-41"></a>  <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;elev&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_05&quot;</span>, <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;julian_date&quot;</span>, <span class="st">&quot;min_obs_started&quot;</span></span>
<span id="cb88-42"><a href="modelling-species-occupancy.html#cb88-42"></a>)</span>
<span id="cb88-43"><a href="modelling-species-occupancy.html#cb88-43"></a></span>
<span id="cb88-44"><a href="modelling-species-occupancy.html#cb88-44"></a><span class="co"># this scales the relevant columns between 0 and 1</span></span>
<span id="cb88-45"><a href="modelling-species-occupancy.html#cb88-45"></a>dat.scaled &lt;-<span class="st"> </span><span class="kw">mutate</span>(</span>
<span id="cb88-46"><a href="modelling-species-occupancy.html#cb88-46"></a>  dat.scaled,</span>
<span id="cb88-47"><a href="modelling-species-occupancy.html#cb88-47"></a>  <span class="kw">across</span>(</span>
<span id="cb88-48"><a href="modelling-species-occupancy.html#cb88-48"></a>    <span class="dt">.cols =</span> <span class="kw">all_of</span>(cols_to_scale), <span class="co"># referring to the columns</span></span>
<span id="cb88-49"><a href="modelling-species-occupancy.html#cb88-49"></a>    <span class="dt">.fns =</span> scales<span class="op">::</span>rescale <span class="co"># the rescale function</span></span>
<span id="cb88-50"><a href="modelling-species-occupancy.html#cb88-50"></a>  )</span>
<span id="cb88-51"><a href="modelling-species-occupancy.html#cb88-51"></a>)</span>
<span id="cb88-52"><a href="modelling-species-occupancy.html#cb88-52"></a></span>
<span id="cb88-53"><a href="modelling-species-occupancy.html#cb88-53"></a><span class="co"># save data to file</span></span>
<span id="cb88-54"><a href="modelling-species-occupancy.html#cb88-54"></a><span class="kw">fwrite</span>(dat.scaled, <span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="correct-date-format" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Correct date format</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="modelling-species-occupancy.html#cb89-1"></a><span class="co"># Reload the scaled covariate data</span></span>
<span id="cb89-2"><a href="modelling-species-occupancy.html#cb89-2"></a>dat.scaled &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb89-3"><a href="modelling-species-occupancy.html#cb89-3"></a>dat.scaled &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(dat.scaled)</span>
<span id="cb89-4"><a href="modelling-species-occupancy.html#cb89-4"></a><span class="kw">head</span>(dat.scaled)</span>
<span id="cb89-5"><a href="modelling-species-occupancy.html#cb89-5"></a></span>
<span id="cb89-6"><a href="modelling-species-occupancy.html#cb89-6"></a><span class="co"># Ensure observation_date column is in the right format</span></span>
<span id="cb89-7"><a href="modelling-species-occupancy.html#cb89-7"></a>dat.scaled<span class="op">$</span>observation_date &lt;-<span class="st"> </span><span class="kw">format</span>(</span>
<span id="cb89-8"><a href="modelling-species-occupancy.html#cb89-8"></a>  <span class="kw">as.Date</span>(</span>
<span id="cb89-9"><a href="modelling-species-occupancy.html#cb89-9"></a>    dat.scaled<span class="op">$</span>observation_date,</span>
<span id="cb89-10"><a href="modelling-species-occupancy.html#cb89-10"></a>    <span class="st">&quot;%m/%d/%Y&quot;</span></span>
<span id="cb89-11"><a href="modelling-species-occupancy.html#cb89-11"></a>  ),</span>
<span id="cb89-12"><a href="modelling-species-occupancy.html#cb89-12"></a>  <span class="st">&quot;%Y-%m-%d&quot;</span></span>
<span id="cb89-13"><a href="modelling-species-occupancy.html#cb89-13"></a>)</span></code></pre></div>
</div>
<div id="check-for-correlated-covariates" class="section level3">
<h3><span class="header-section-number">9.1.5</span> Check for correlated covariates</h3>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="modelling-species-occupancy.html#cb90-1"></a><span class="co"># Testing for correlations before running further analyses</span></span>
<span id="cb90-2"><a href="modelling-species-occupancy.html#cb90-2"></a><span class="co"># Majority are uncorrelated since we decided to keep climatic and land cover predictors and removed elevation.</span></span>
<span id="cb90-3"><a href="modelling-species-occupancy.html#cb90-3"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</span>
<span id="cb90-4"><a href="modelling-species-occupancy.html#cb90-4"></a></span>
<span id="cb90-5"><a href="modelling-species-occupancy.html#cb90-5"></a><span class="co"># SELECT COLUMNS to check BY NAME</span></span>
<span id="cb90-6"><a href="modelling-species-occupancy.html#cb90-6"></a>cols_to_check &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb90-7"><a href="modelling-species-occupancy.html#cb90-7"></a>  <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;lc_02&quot;</span>,</span>
<span id="cb90-8"><a href="modelling-species-occupancy.html#cb90-8"></a>  <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_01&quot;</span>,</span>
<span id="cb90-9"><a href="modelling-species-occupancy.html#cb90-9"></a>  <span class="st">&quot;lc_05&quot;</span>, <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span></span>
<span id="cb90-10"><a href="modelling-species-occupancy.html#cb90-10"></a>)</span>
<span id="cb90-11"><a href="modelling-species-occupancy.html#cb90-11"></a></span>
<span id="cb90-12"><a href="modelling-species-occupancy.html#cb90-12"></a><span class="co"># screen covariates for correlation</span></span>
<span id="cb90-13"><a href="modelling-species-occupancy.html#cb90-13"></a><span class="kw">screen.cor</span>(dat.scaled[, cols_to_check], <span class="dt">threshold =</span> <span class="fl">0.3</span>)</span>
<span id="cb90-14"><a href="modelling-species-occupancy.html#cb90-14"></a></span>
<span id="cb90-15"><a href="modelling-species-occupancy.html#cb90-15"></a><span class="co"># total number of presences by species</span></span>
<span id="cb90-16"><a href="modelling-species-occupancy.html#cb90-16"></a><span class="co"># min no. presences = 224 to max = 7725</span></span>
<span id="cb90-17"><a href="modelling-species-occupancy.html#cb90-17"></a>presSpecies &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></span>
<span id="cb90-18"><a href="modelling-species-occupancy.html#cb90-18"></a><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span></span>
<span id="cb90-19"><a href="modelling-species-occupancy.html#cb90-19"></a><span class="st">  </span><span class="kw">filter</span>(pres_abs <span class="op">==</span><span class="st"> &quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb90-20"><a href="modelling-species-occupancy.html#cb90-20"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</span>
<span id="cb90-21"><a href="modelling-species-occupancy.html#cb90-21"></a></span>
<span id="cb90-22"><a href="modelling-species-occupancy.html#cb90-22"></a><span class="co"># convert locality_id to factors</span></span>
<span id="cb90-23"><a href="modelling-species-occupancy.html#cb90-23"></a>dat.scaled<span class="op">$</span>locality_id &lt;-<span class="st"> </span><span class="kw">as.factor</span>(dat.scaled<span class="op">$</span>locality_id)</span></code></pre></div>
</div>
</div>
<div id="running-a-null-model" class="section level2">
<h2><span class="header-section-number">9.2</span> Running a null model</h2>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="modelling-species-occupancy.html#cb91-1"></a><span class="co"># All null models are stored in lists below</span></span>
<span id="cb91-2"><a href="modelling-species-occupancy.html#cb91-2"></a>all_null &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb91-3"><a href="modelling-species-occupancy.html#cb91-3"></a></span>
<span id="cb91-4"><a href="modelling-species-occupancy.html#cb91-4"></a><span class="co"># define species and a counter</span></span>
<span id="cb91-5"><a href="modelling-species-occupancy.html#cb91-5"></a>species &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)</span>
<span id="cb91-6"><a href="modelling-species-occupancy.html#cb91-6"></a>counter &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb91-7"><a href="modelling-species-occupancy.html#cb91-7"></a></span>
<span id="cb91-8"><a href="modelling-species-occupancy.html#cb91-8"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb91-9"><a href="modelling-species-occupancy.html#cb91-9"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</span>
<span id="cb91-10"><a href="modelling-species-occupancy.html#cb91-10"></a>  <span class="dt">min =</span> <span class="dv">0</span>,</span>
<span id="cb91-11"><a href="modelling-species-occupancy.html#cb91-11"></a>  <span class="dt">max =</span> <span class="kw">length</span>(species),</span>
<span id="cb91-12"><a href="modelling-species-occupancy.html#cb91-12"></a>  <span class="dt">style =</span> <span class="dv">3</span></span>
<span id="cb91-13"><a href="modelling-species-occupancy.html#cb91-13"></a>) <span class="co"># text based bar</span></span>
<span id="cb91-14"><a href="modelling-species-occupancy.html#cb91-14"></a></span>
<span id="cb91-15"><a href="modelling-species-occupancy.html#cb91-15"></a><span class="co"># loop over species</span></span>
<span id="cb91-16"><a href="modelling-species-occupancy.html#cb91-16"></a><span class="cf">for</span> (i <span class="cf">in</span> species) {</span>
<span id="cb91-17"><a href="modelling-species-occupancy.html#cb91-17"></a></span>
<span id="cb91-18"><a href="modelling-species-occupancy.html#cb91-18"></a>  <span class="co"># filter data by species</span></span>
<span id="cb91-19"><a href="modelling-species-occupancy.html#cb91-19"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></span>
<span id="cb91-20"><a href="modelling-species-occupancy.html#cb91-20"></a><span class="st">    </span><span class="kw">filter</span>(scientific_name <span class="op">==</span><span class="st"> </span>i)</span>
<span id="cb91-21"><a href="modelling-species-occupancy.html#cb91-21"></a></span>
<span id="cb91-22"><a href="modelling-species-occupancy.html#cb91-22"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb91-23"><a href="modelling-species-occupancy.html#cb91-23"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb91-24"><a href="modelling-species-occupancy.html#cb91-24"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb91-25"><a href="modelling-species-occupancy.html#cb91-25"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb91-26"><a href="modelling-species-occupancy.html#cb91-26"></a>    <span class="dt">n_days =</span> <span class="dv">1488</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb91-27"><a href="modelling-species-occupancy.html#cb91-27"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb91-28"><a href="modelling-species-occupancy.html#cb91-28"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb91-29"><a href="modelling-species-occupancy.html#cb91-29"></a>  )</span>
<span id="cb91-30"><a href="modelling-species-occupancy.html#cb91-30"></a></span>
<span id="cb91-31"><a href="modelling-species-occupancy.html#cb91-31"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb91-32"><a href="modelling-species-occupancy.html#cb91-32"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb91-33"><a href="modelling-species-occupancy.html#cb91-33"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb91-34"><a href="modelling-species-occupancy.html#cb91-34"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb91-35"><a href="modelling-species-occupancy.html#cb91-35"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb91-36"><a href="modelling-species-occupancy.html#cb91-36"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb91-37"><a href="modelling-species-occupancy.html#cb91-37"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb91-38"><a href="modelling-species-occupancy.html#cb91-38"></a>  )</span>
<span id="cb91-39"><a href="modelling-species-occupancy.html#cb91-39"></a></span>
<span id="cb91-40"><a href="modelling-species-occupancy.html#cb91-40"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb91-41"><a href="modelling-species-occupancy.html#cb91-41"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb91-42"><a href="modelling-species-occupancy.html#cb91-42"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb91-43"><a href="modelling-species-occupancy.html#cb91-43"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb91-44"><a href="modelling-species-occupancy.html#cb91-44"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb91-45"><a href="modelling-species-occupancy.html#cb91-45"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</span>
<span id="cb91-46"><a href="modelling-species-occupancy.html#cb91-46"></a>      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span></span>
<span id="cb91-47"><a href="modelling-species-occupancy.html#cb91-47"></a>    ),</span>
<span id="cb91-48"><a href="modelling-species-occupancy.html#cb91-48"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb91-49"><a href="modelling-species-occupancy.html#cb91-49"></a>  )</span>
<span id="cb91-50"><a href="modelling-species-occupancy.html#cb91-50"></a></span>
<span id="cb91-51"><a href="modelling-species-occupancy.html#cb91-51"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb91-52"><a href="modelling-species-occupancy.html#cb91-52"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb91-53"><a href="modelling-species-occupancy.html#cb91-53"></a></span>
<span id="cb91-54"><a href="modelling-species-occupancy.html#cb91-54"></a>  <span class="co"># Set up the model</span></span>
<span id="cb91-55"><a href="modelling-species-occupancy.html#cb91-55"></a>  <span class="co"># the list is now automatically named</span></span>
<span id="cb91-56"><a href="modelling-species-occupancy.html#cb91-56"></a>  all_null[[i]] &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</span>
<span id="cb91-57"><a href="modelling-species-occupancy.html#cb91-57"></a></span>
<span id="cb91-58"><a href="modelling-species-occupancy.html#cb91-58"></a>  <span class="co"># increase counter</span></span>
<span id="cb91-59"><a href="modelling-species-occupancy.html#cb91-59"></a>  counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb91-60"><a href="modelling-species-occupancy.html#cb91-60"></a></span>
<span id="cb91-61"><a href="modelling-species-occupancy.html#cb91-61"></a>  <span class="kw">setTxtProgressBar</span>(pb, counter)</span>
<span id="cb91-62"><a href="modelling-species-occupancy.html#cb91-62"></a>}</span>
<span id="cb91-63"><a href="modelling-species-occupancy.html#cb91-63"></a><span class="kw">close</span>(pb)</span>
<span id="cb91-64"><a href="modelling-species-occupancy.html#cb91-64"></a></span>
<span id="cb91-65"><a href="modelling-species-occupancy.html#cb91-65"></a><span class="co"># Store all the  model outputs for each species</span></span>
<span id="cb91-66"><a href="modelling-species-occupancy.html#cb91-66"></a><span class="kw">capture.output</span>(all_null, <span class="dt">file =</span> <span class="st">&quot;data/results/null_models.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="identifying-covariates-necessary-to-model-the-detection-process" class="section level2">
<h2><span class="header-section-number">9.3</span> Identifying covariates necessary to model the detection process</h2>
<p>Here, we use the <code>unmarked</code> package in R (Fiske and Chandler 2011) to identify detection level covariates that are important for each species. We use AIC criteria to select top models (Burnham et al.2002; 2011).</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="modelling-species-occupancy.html#cb92-1"></a><span class="co"># All models are stored in lists below</span></span>
<span id="cb92-2"><a href="modelling-species-occupancy.html#cb92-2"></a>det_dred &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb92-3"><a href="modelling-species-occupancy.html#cb92-3"></a></span>
<span id="cb92-4"><a href="modelling-species-occupancy.html#cb92-4"></a><span class="co"># Subsetting those models whose deltaAIC&lt;4 (Burnham et al. 2011)</span></span>
<span id="cb92-5"><a href="modelling-species-occupancy.html#cb92-5"></a>top_det &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb92-6"><a href="modelling-species-occupancy.html#cb92-6"></a></span>
<span id="cb92-7"><a href="modelling-species-occupancy.html#cb92-7"></a><span class="co"># Getting model averaged coefficients and relative importance scores</span></span>
<span id="cb92-8"><a href="modelling-species-occupancy.html#cb92-8"></a>det_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb92-9"><a href="modelling-species-occupancy.html#cb92-9"></a>det_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb92-10"><a href="modelling-species-occupancy.html#cb92-10"></a></span>
<span id="cb92-11"><a href="modelling-species-occupancy.html#cb92-11"></a><span class="co"># Getting model estimates</span></span>
<span id="cb92-12"><a href="modelling-species-occupancy.html#cb92-12"></a>det_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb92-13"><a href="modelling-species-occupancy.html#cb92-13"></a></span>
<span id="cb92-14"><a href="modelling-species-occupancy.html#cb92-14"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb92-15"><a href="modelling-species-occupancy.html#cb92-15"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</span>
<span id="cb92-16"><a href="modelling-species-occupancy.html#cb92-16"></a>  <span class="dt">min =</span> <span class="dv">0</span>,</span>
<span id="cb92-17"><a href="modelling-species-occupancy.html#cb92-17"></a>  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span></span>
<span id="cb92-18"><a href="modelling-species-occupancy.html#cb92-18"></a>) <span class="co"># text based bar</span></span>
<span id="cb92-19"><a href="modelling-species-occupancy.html#cb92-19"></a></span>
<span id="cb92-20"><a href="modelling-species-occupancy.html#cb92-20"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb92-21"><a href="modelling-species-occupancy.html#cb92-21"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></span>
<span id="cb92-22"><a href="modelling-species-occupancy.html#cb92-22"></a><span class="st">    </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb92-23"><a href="modelling-species-occupancy.html#cb92-23"></a></span>
<span id="cb92-24"><a href="modelling-species-occupancy.html#cb92-24"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb92-25"><a href="modelling-species-occupancy.html#cb92-25"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb92-26"><a href="modelling-species-occupancy.html#cb92-26"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb92-27"><a href="modelling-species-occupancy.html#cb92-27"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb92-28"><a href="modelling-species-occupancy.html#cb92-28"></a>    <span class="dt">n_days =</span> <span class="dv">1488</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb92-29"><a href="modelling-species-occupancy.html#cb92-29"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb92-30"><a href="modelling-species-occupancy.html#cb92-30"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb92-31"><a href="modelling-species-occupancy.html#cb92-31"></a>  )</span>
<span id="cb92-32"><a href="modelling-species-occupancy.html#cb92-32"></a></span>
<span id="cb92-33"><a href="modelling-species-occupancy.html#cb92-33"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb92-34"><a href="modelling-species-occupancy.html#cb92-34"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb92-35"><a href="modelling-species-occupancy.html#cb92-35"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb92-36"><a href="modelling-species-occupancy.html#cb92-36"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb92-37"><a href="modelling-species-occupancy.html#cb92-37"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb92-38"><a href="modelling-species-occupancy.html#cb92-38"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb92-39"><a href="modelling-species-occupancy.html#cb92-39"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb92-40"><a href="modelling-species-occupancy.html#cb92-40"></a>  )</span>
<span id="cb92-41"><a href="modelling-species-occupancy.html#cb92-41"></a></span>
<span id="cb92-42"><a href="modelling-species-occupancy.html#cb92-42"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb92-43"><a href="modelling-species-occupancy.html#cb92-43"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb92-44"><a href="modelling-species-occupancy.html#cb92-44"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb92-45"><a href="modelling-species-occupancy.html#cb92-45"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb92-46"><a href="modelling-species-occupancy.html#cb92-46"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb92-47"><a href="modelling-species-occupancy.html#cb92-47"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</span>
<span id="cb92-48"><a href="modelling-species-occupancy.html#cb92-48"></a>      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span></span>
<span id="cb92-49"><a href="modelling-species-occupancy.html#cb92-49"></a>    ),</span>
<span id="cb92-50"><a href="modelling-species-occupancy.html#cb92-50"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb92-51"><a href="modelling-species-occupancy.html#cb92-51"></a>  )</span>
<span id="cb92-52"><a href="modelling-species-occupancy.html#cb92-52"></a></span>
<span id="cb92-53"><a href="modelling-species-occupancy.html#cb92-53"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb92-54"><a href="modelling-species-occupancy.html#cb92-54"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb92-55"><a href="modelling-species-occupancy.html#cb92-55"></a></span>
<span id="cb92-56"><a href="modelling-species-occupancy.html#cb92-56"></a>  <span class="co"># Fit a global model with all detection level covariates</span></span>
<span id="cb92-57"><a href="modelling-species-occupancy.html#cb92-57"></a>  global_mod &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb92-58"><a href="modelling-species-occupancy.html#cb92-58"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb92-59"><a href="modelling-species-occupancy.html#cb92-59"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb92-60"><a href="modelling-species-occupancy.html#cb92-60"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb92-61"><a href="modelling-species-occupancy.html#cb92-61"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb92-62"><a href="modelling-species-occupancy.html#cb92-62"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</span>
<span id="cb92-63"><a href="modelling-species-occupancy.html#cb92-63"></a></span>
<span id="cb92-64"><a href="modelling-species-occupancy.html#cb92-64"></a>  <span class="co"># Set up the cluster</span></span>
<span id="cb92-65"><a href="modelling-species-occupancy.html#cb92-65"></a>  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></span>
<span id="cb92-66"><a href="modelling-species-occupancy.html#cb92-66"></a>  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">5</span>), <span class="dt">type =</span> clusterType))</span>
<span id="cb92-67"><a href="modelling-species-occupancy.html#cb92-67"></a></span>
<span id="cb92-68"><a href="modelling-species-occupancy.html#cb92-68"></a>  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</span>
<span id="cb92-69"><a href="modelling-species-occupancy.html#cb92-69"></a>  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</span>
<span id="cb92-70"><a href="modelling-species-occupancy.html#cb92-70"></a></span>
<span id="cb92-71"><a href="modelling-species-occupancy.html#cb92-71"></a>  det_dred[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(global_mod, clust)</span>
<span id="cb92-72"><a href="modelling-species-occupancy.html#cb92-72"></a>  <span class="kw">names</span>(det_dred)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-73"><a href="modelling-species-occupancy.html#cb92-73"></a></span>
<span id="cb92-74"><a href="modelling-species-occupancy.html#cb92-74"></a>  <span class="co"># Get the top models, which we&#39;ll define as those with deltaAICc &lt; 4</span></span>
<span id="cb92-75"><a href="modelling-species-occupancy.html#cb92-75"></a>  top_det[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(det_dred[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">cluster =</span> clust)</span>
<span id="cb92-76"><a href="modelling-species-occupancy.html#cb92-76"></a>  <span class="kw">names</span>(top_det)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-77"><a href="modelling-species-occupancy.html#cb92-77"></a></span>
<span id="cb92-78"><a href="modelling-species-occupancy.html#cb92-78"></a>  <span class="co"># Obtaining model averaged coefficients</span></span>
<span id="cb92-79"><a href="modelling-species-occupancy.html#cb92-79"></a>  <span class="cf">if</span> (<span class="kw">length</span>(top_det[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb92-80"><a href="modelling-species-occupancy.html#cb92-80"></a>    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_det[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb92-81"><a href="modelling-species-occupancy.html#cb92-81"></a>    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</span>
<span id="cb92-82"><a href="modelling-species-occupancy.html#cb92-82"></a>    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-83"><a href="modelling-species-occupancy.html#cb92-83"></a></span>
<span id="cb92-84"><a href="modelling-species-occupancy.html#cb92-84"></a>    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb92-85"><a href="modelling-species-occupancy.html#cb92-85"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</span>
<span id="cb92-86"><a href="modelling-species-occupancy.html#cb92-86"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</span>
<span id="cb92-87"><a href="modelling-species-occupancy.html#cb92-87"></a>      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</span>
<span id="cb92-88"><a href="modelling-species-occupancy.html#cb92-88"></a>      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</span>
<span id="cb92-89"><a href="modelling-species-occupancy.html#cb92-89"></a>      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</span>
<span id="cb92-90"><a href="modelling-species-occupancy.html#cb92-90"></a>      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</span>
<span id="cb92-91"><a href="modelling-species-occupancy.html#cb92-91"></a>    )</span>
<span id="cb92-92"><a href="modelling-species-occupancy.html#cb92-92"></a></span>
<span id="cb92-93"><a href="modelling-species-occupancy.html#cb92-93"></a>    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-94"><a href="modelling-species-occupancy.html#cb92-94"></a></span>
<span id="cb92-95"><a href="modelling-species-occupancy.html#cb92-95"></a>    det_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</span>
<span id="cb92-96"><a href="modelling-species-occupancy.html#cb92-96"></a>    <span class="kw">names</span>(det_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-97"><a href="modelling-species-occupancy.html#cb92-97"></a>  } <span class="cf">else</span> {</span>
<span id="cb92-98"><a href="modelling-species-occupancy.html#cb92-98"></a>    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_det[[i]][[<span class="dv">1</span>]]))</span>
<span id="cb92-99"><a href="modelling-species-occupancy.html#cb92-99"></a>    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-100"><a href="modelling-species-occupancy.html#cb92-100"></a></span>
<span id="cb92-101"><a href="modelling-species-occupancy.html#cb92-101"></a>    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb92-102"><a href="modelling-species-occupancy.html#cb92-102"></a>    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb92-103"><a href="modelling-species-occupancy.html#cb92-103"></a>    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</span>
<span id="cb92-104"><a href="modelling-species-occupancy.html#cb92-104"></a>    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</span>
<span id="cb92-105"><a href="modelling-species-occupancy.html#cb92-105"></a></span>
<span id="cb92-106"><a href="modelling-species-occupancy.html#cb92-106"></a>    Coefficient &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>]</span>
<span id="cb92-107"><a href="modelling-species-occupancy.html#cb92-107"></a>    SE &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>]</span>
<span id="cb92-108"><a href="modelling-species-occupancy.html#cb92-108"></a></span>
<span id="cb92-109"><a href="modelling-species-occupancy.html#cb92-109"></a>    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb92-110"><a href="modelling-species-occupancy.html#cb92-110"></a>      <span class="dt">Coefficient =</span> Coefficient[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(Coefficient)],</span>
<span id="cb92-111"><a href="modelling-species-occupancy.html#cb92-111"></a>      <span class="dt">SE =</span> SE[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(SE)],</span>
<span id="cb92-112"><a href="modelling-species-occupancy.html#cb92-112"></a>      <span class="dt">lowerCI =</span> lowDet,</span>
<span id="cb92-113"><a href="modelling-species-occupancy.html#cb92-113"></a>      <span class="dt">upperCI =</span> upDet,</span>
<span id="cb92-114"><a href="modelling-species-occupancy.html#cb92-114"></a>      <span class="dt">z_value =</span> zDet,</span>
<span id="cb92-115"><a href="modelling-species-occupancy.html#cb92-115"></a>      <span class="dt">Pr_z =</span> Pr_zDet</span>
<span id="cb92-116"><a href="modelling-species-occupancy.html#cb92-116"></a>    )</span>
<span id="cb92-117"><a href="modelling-species-occupancy.html#cb92-117"></a></span>
<span id="cb92-118"><a href="modelling-species-occupancy.html#cb92-118"></a>    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb92-119"><a href="modelling-species-occupancy.html#cb92-119"></a>  }</span>
<span id="cb92-120"><a href="modelling-species-occupancy.html#cb92-120"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb92-121"><a href="modelling-species-occupancy.html#cb92-121"></a>  <span class="kw">stopCluster</span>(clust)</span>
<span id="cb92-122"><a href="modelling-species-occupancy.html#cb92-122"></a>}</span>
<span id="cb92-123"><a href="modelling-species-occupancy.html#cb92-123"></a><span class="kw">close</span>(pb)</span>
<span id="cb92-124"><a href="modelling-species-occupancy.html#cb92-124"></a></span>
<span id="cb92-125"><a href="modelling-species-occupancy.html#cb92-125"></a><span class="co">## Storing output from the above models in excel sheets</span></span>
<span id="cb92-126"><a href="modelling-species-occupancy.html#cb92-126"></a></span>
<span id="cb92-127"><a href="modelling-species-occupancy.html#cb92-127"></a><span class="co"># 1. Store all the model outputs for each species (variable: det_dred() - see above)</span></span>
<span id="cb92-128"><a href="modelling-species-occupancy.html#cb92-128"></a><span class="kw">write.xlsx</span>(det_dred, <span class="dt">file =</span> <span class="st">&quot;data/results/det-dred.xlsx&quot;</span>)</span>
<span id="cb92-129"><a href="modelling-species-occupancy.html#cb92-129"></a></span>
<span id="cb92-130"><a href="modelling-species-occupancy.html#cb92-130"></a><span class="co"># 2. Store all the model averaged outputs for each species and the relative importance score</span></span>
<span id="cb92-131"><a href="modelling-species-occupancy.html#cb92-131"></a><span class="kw">write.xlsx</span>(det_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/det-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb92-132"><a href="modelling-species-occupancy.html#cb92-132"></a><span class="kw">write.xlsx</span>(det_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/det-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb92-133"><a href="modelling-species-occupancy.html#cb92-133"></a></span>
<span id="cb92-134"><a href="modelling-species-occupancy.html#cb92-134"></a><span class="kw">write.xlsx</span>(det_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/det-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb92-135"><a href="modelling-species-occupancy.html#cb92-135"></a></span>
<span id="cb92-136"><a href="modelling-species-occupancy.html#cb92-136"></a><span class="co"># Note if you are unable to write to a file, use (for example)</span></span>
<span id="cb92-137"><a href="modelling-species-occupancy.html#cb92-137"></a>a &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(det_imp, <span class="op">~</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">compact</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(.) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="land-cover-and-climate" class="section level2">
<h2><span class="header-section-number">9.4</span> Land Cover and Climate</h2>
<p>Occupancy models estimate the probability of occurrence of a given species while controlling for the probability of detection and allow us to model the factors affecting occurrence and detection independently. The flexible eBird observation process contributes to the largest source of variation in the likelihood of detecting a particular species; hence, we included seven covariates that influence the probability of detection for each checklist: ordinal day of year, duration of observation, distance traveled, protocol type, time observations started, number of observers and the checklist calibration index (CCI).</p>
<p>Using a multi-model information-theoretic approach, we tested how strongly our occurrence data fit our candidate set of environmental covariates (Burnham et al.2002). We fitted single-species occupancy models for each species, to simultaneously estimate a probability of detection (<span class="math inline">\(\p\)</span>) and a probability of occupancy (<span class="math inline">\(\psi\)</span>). For each species, we fit models, each with a unique combination of the climate and land cover occupancy covariates and all seven detection covariates.</p>
<p>Across the models tested for each species, the model with highest support was determined using AICc scores. However, across the majority of the species, no single model had overwhelming support. Hence, for each species, we examined those models which had <span class="math inline">\(\Delta\)</span>AICc &lt; 4, as these top models were considered to explain a large proportion of the association between the species-specific probability of occupancy and environmental drivers (Burnham et al.2011; Elsen et al.2017). Using these restricted model sets for each species; we created a model-averaged coefficient estimate for each predictor and assessed its direction and significance. We considered a predictor to be significantly associated with occupancy if the range of the 95% confidence interval around the model-averaged coefficient did not contain zero.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="modelling-species-occupancy.html#cb93-1"></a><span class="co"># All models are stored in lists below</span></span>
<span id="cb93-2"><a href="modelling-species-occupancy.html#cb93-2"></a>lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb93-3"><a href="modelling-species-occupancy.html#cb93-3"></a></span>
<span id="cb93-4"><a href="modelling-species-occupancy.html#cb93-4"></a><span class="co"># Subsetting those models whose deltaAIC&lt;4 (Burnham et al. 2011)</span></span>
<span id="cb93-5"><a href="modelling-species-occupancy.html#cb93-5"></a>top_lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb93-6"><a href="modelling-species-occupancy.html#cb93-6"></a></span>
<span id="cb93-7"><a href="modelling-species-occupancy.html#cb93-7"></a><span class="co"># Getting model averaged coefficients and relative importance scores</span></span>
<span id="cb93-8"><a href="modelling-species-occupancy.html#cb93-8"></a>lc_clim_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb93-9"><a href="modelling-species-occupancy.html#cb93-9"></a>lc_clim_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb93-10"><a href="modelling-species-occupancy.html#cb93-10"></a></span>
<span id="cb93-11"><a href="modelling-species-occupancy.html#cb93-11"></a><span class="co"># Storing Model estimates</span></span>
<span id="cb93-12"><a href="modelling-species-occupancy.html#cb93-12"></a>lc_clim_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb93-13"><a href="modelling-species-occupancy.html#cb93-13"></a></span>
<span id="cb93-14"><a href="modelling-species-occupancy.html#cb93-14"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb93-15"><a href="modelling-species-occupancy.html#cb93-15"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></span>
<span id="cb93-16"><a href="modelling-species-occupancy.html#cb93-16"></a></span>
<span id="cb93-17"><a href="modelling-species-occupancy.html#cb93-17"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb93-18"><a href="modelling-species-occupancy.html#cb93-18"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb93-19"><a href="modelling-species-occupancy.html#cb93-19"></a></span>
<span id="cb93-20"><a href="modelling-species-occupancy.html#cb93-20"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb93-21"><a href="modelling-species-occupancy.html#cb93-21"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb93-22"><a href="modelling-species-occupancy.html#cb93-22"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb93-23"><a href="modelling-species-occupancy.html#cb93-23"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb93-24"><a href="modelling-species-occupancy.html#cb93-24"></a>    <span class="dt">n_days =</span> <span class="dv">1488</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb93-25"><a href="modelling-species-occupancy.html#cb93-25"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb93-26"><a href="modelling-species-occupancy.html#cb93-26"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb93-27"><a href="modelling-species-occupancy.html#cb93-27"></a>  )</span>
<span id="cb93-28"><a href="modelling-species-occupancy.html#cb93-28"></a></span>
<span id="cb93-29"><a href="modelling-species-occupancy.html#cb93-29"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb93-30"><a href="modelling-species-occupancy.html#cb93-30"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb93-31"><a href="modelling-species-occupancy.html#cb93-31"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb93-32"><a href="modelling-species-occupancy.html#cb93-32"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb93-33"><a href="modelling-species-occupancy.html#cb93-33"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb93-34"><a href="modelling-species-occupancy.html#cb93-34"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb93-35"><a href="modelling-species-occupancy.html#cb93-35"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb93-36"><a href="modelling-species-occupancy.html#cb93-36"></a>  )</span>
<span id="cb93-37"><a href="modelling-species-occupancy.html#cb93-37"></a></span>
<span id="cb93-38"><a href="modelling-species-occupancy.html#cb93-38"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb93-39"><a href="modelling-species-occupancy.html#cb93-39"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb93-40"><a href="modelling-species-occupancy.html#cb93-40"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb93-41"><a href="modelling-species-occupancy.html#cb93-41"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb93-42"><a href="modelling-species-occupancy.html#cb93-42"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb93-43"><a href="modelling-species-occupancy.html#cb93-43"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</span>
<span id="cb93-44"><a href="modelling-species-occupancy.html#cb93-44"></a>      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span></span>
<span id="cb93-45"><a href="modelling-species-occupancy.html#cb93-45"></a>    ),</span>
<span id="cb93-46"><a href="modelling-species-occupancy.html#cb93-46"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb93-47"><a href="modelling-species-occupancy.html#cb93-47"></a>  )</span>
<span id="cb93-48"><a href="modelling-species-occupancy.html#cb93-48"></a></span>
<span id="cb93-49"><a href="modelling-species-occupancy.html#cb93-49"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb93-50"><a href="modelling-species-occupancy.html#cb93-50"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb93-51"><a href="modelling-species-occupancy.html#cb93-51"></a></span>
<span id="cb93-52"><a href="modelling-species-occupancy.html#cb93-52"></a>  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb93-53"><a href="modelling-species-occupancy.html#cb93-53"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb93-54"><a href="modelling-species-occupancy.html#cb93-54"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb93-55"><a href="modelling-species-occupancy.html#cb93-55"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb93-56"><a href="modelling-species-occupancy.html#cb93-56"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb93-57"><a href="modelling-species-occupancy.html#cb93-57"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="dv">01</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">02</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">05</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">04</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">09</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">07</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">03</span> <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-58"><a href="modelling-species-occupancy.html#cb93-58"></a><span class="st">      </span>bio4a <span class="op">+</span><span class="st"> </span>bio15a, <span class="dt">data =</span> occ_um)</span>
<span id="cb93-59"><a href="modelling-species-occupancy.html#cb93-59"></a></span>
<span id="cb93-60"><a href="modelling-species-occupancy.html#cb93-60"></a>  <span class="co"># Set up the cluster</span></span>
<span id="cb93-61"><a href="modelling-species-occupancy.html#cb93-61"></a>  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></span>
<span id="cb93-62"><a href="modelling-species-occupancy.html#cb93-62"></a>  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">5</span>), <span class="dt">type =</span> clusterType))</span>
<span id="cb93-63"><a href="modelling-species-occupancy.html#cb93-63"></a></span>
<span id="cb93-64"><a href="modelling-species-occupancy.html#cb93-64"></a>  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</span>
<span id="cb93-65"><a href="modelling-species-occupancy.html#cb93-65"></a>  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</span>
<span id="cb93-66"><a href="modelling-species-occupancy.html#cb93-66"></a></span>
<span id="cb93-67"><a href="modelling-species-occupancy.html#cb93-67"></a>  <span class="co"># Detection terms are fixed</span></span>
<span id="cb93-68"><a href="modelling-species-occupancy.html#cb93-68"></a>  det_terms &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb93-69"><a href="modelling-species-occupancy.html#cb93-69"></a>    <span class="st">&quot;p(duration_minutes)&quot;</span>, <span class="st">&quot;p(effort_distance_km)&quot;</span>, <span class="st">&quot;p(expertise)&quot;</span>,</span>
<span id="cb93-70"><a href="modelling-species-occupancy.html#cb93-70"></a>    <span class="st">&quot;p(julian_date)&quot;</span>, <span class="st">&quot;p(min_obs_started)&quot;</span>,</span>
<span id="cb93-71"><a href="modelling-species-occupancy.html#cb93-71"></a>    <span class="st">&quot;p(number_observers)&quot;</span></span>
<span id="cb93-72"><a href="modelling-species-occupancy.html#cb93-72"></a>  )</span>
<span id="cb93-73"><a href="modelling-species-occupancy.html#cb93-73"></a></span>
<span id="cb93-74"><a href="modelling-species-occupancy.html#cb93-74"></a>  lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(model_lc_clim, clust, <span class="dt">fixed =</span> det_terms)</span>
<span id="cb93-75"><a href="modelling-species-occupancy.html#cb93-75"></a>  <span class="kw">names</span>(lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-76"><a href="modelling-species-occupancy.html#cb93-76"></a></span>
<span id="cb93-77"><a href="modelling-species-occupancy.html#cb93-77"></a>  <span class="co"># Identiying top subset of models based on deltaAIC scores being less than 4 (Burnham et al., 2011)</span></span>
<span id="cb93-78"><a href="modelling-species-occupancy.html#cb93-78"></a>  top_lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(lc_clim[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">cluster =</span> clust)</span>
<span id="cb93-79"><a href="modelling-species-occupancy.html#cb93-79"></a></span>
<span id="cb93-80"><a href="modelling-species-occupancy.html#cb93-80"></a>  <span class="kw">names</span>(top_lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-81"><a href="modelling-species-occupancy.html#cb93-81"></a></span>
<span id="cb93-82"><a href="modelling-species-occupancy.html#cb93-82"></a>  <span class="co"># Obtaining model averaged coefficients for both candidate model subsets</span></span>
<span id="cb93-83"><a href="modelling-species-occupancy.html#cb93-83"></a>  <span class="cf">if</span> (<span class="kw">length</span>(top_lc_clim[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb93-84"><a href="modelling-species-occupancy.html#cb93-84"></a>    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_lc_clim[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb93-85"><a href="modelling-species-occupancy.html#cb93-85"></a>    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</span>
<span id="cb93-86"><a href="modelling-species-occupancy.html#cb93-86"></a>    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-87"><a href="modelling-species-occupancy.html#cb93-87"></a></span>
<span id="cb93-88"><a href="modelling-species-occupancy.html#cb93-88"></a>    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb93-89"><a href="modelling-species-occupancy.html#cb93-89"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</span>
<span id="cb93-90"><a href="modelling-species-occupancy.html#cb93-90"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</span>
<span id="cb93-91"><a href="modelling-species-occupancy.html#cb93-91"></a>      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</span>
<span id="cb93-92"><a href="modelling-species-occupancy.html#cb93-92"></a>      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</span>
<span id="cb93-93"><a href="modelling-species-occupancy.html#cb93-93"></a>      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</span>
<span id="cb93-94"><a href="modelling-species-occupancy.html#cb93-94"></a>      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</span>
<span id="cb93-95"><a href="modelling-species-occupancy.html#cb93-95"></a>    )</span>
<span id="cb93-96"><a href="modelling-species-occupancy.html#cb93-96"></a></span>
<span id="cb93-97"><a href="modelling-species-occupancy.html#cb93-97"></a>    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-98"><a href="modelling-species-occupancy.html#cb93-98"></a></span>
<span id="cb93-99"><a href="modelling-species-occupancy.html#cb93-99"></a>    lc_clim_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</span>
<span id="cb93-100"><a href="modelling-species-occupancy.html#cb93-100"></a>    <span class="kw">names</span>(lc_clim_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-101"><a href="modelling-species-occupancy.html#cb93-101"></a>  } <span class="cf">else</span> {</span>
<span id="cb93-102"><a href="modelling-species-occupancy.html#cb93-102"></a>    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_lc_clim[[i]][[<span class="dv">1</span>]]))</span>
<span id="cb93-103"><a href="modelling-species-occupancy.html#cb93-103"></a>    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-104"><a href="modelling-species-occupancy.html#cb93-104"></a></span>
<span id="cb93-105"><a href="modelling-species-occupancy.html#cb93-105"></a>    lowSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb93-106"><a href="modelling-species-occupancy.html#cb93-106"></a>    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb93-107"><a href="modelling-species-occupancy.html#cb93-107"></a>    upSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb93-108"><a href="modelling-species-occupancy.html#cb93-108"></a>    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb93-109"><a href="modelling-species-occupancy.html#cb93-109"></a>    zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">3</span>])</span>
<span id="cb93-110"><a href="modelling-species-occupancy.html#cb93-110"></a>    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</span>
<span id="cb93-111"><a href="modelling-species-occupancy.html#cb93-111"></a>    Pr_zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">4</span>])</span>
<span id="cb93-112"><a href="modelling-species-occupancy.html#cb93-112"></a>    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</span>
<span id="cb93-113"><a href="modelling-species-occupancy.html#cb93-113"></a></span>
<span id="cb93-114"><a href="modelling-species-occupancy.html#cb93-114"></a>    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb93-115"><a href="modelling-species-occupancy.html#cb93-115"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>],</span>
<span id="cb93-116"><a href="modelling-species-occupancy.html#cb93-116"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>],</span>
<span id="cb93-117"><a href="modelling-species-occupancy.html#cb93-117"></a>      <span class="dt">lowerCI =</span> <span class="kw">rbind</span>(lowSt, lowDet),</span>
<span id="cb93-118"><a href="modelling-species-occupancy.html#cb93-118"></a>      <span class="dt">upperCI =</span> <span class="kw">rbind</span>(upSt, upDet),</span>
<span id="cb93-119"><a href="modelling-species-occupancy.html#cb93-119"></a>      <span class="dt">z_value =</span> <span class="kw">rbind</span>(zSt, zDet),</span>
<span id="cb93-120"><a href="modelling-species-occupancy.html#cb93-120"></a>      <span class="dt">Pr_z =</span> <span class="kw">rbind</span>(Pr_zSt, Pr_zDet)</span>
<span id="cb93-121"><a href="modelling-species-occupancy.html#cb93-121"></a>    )</span>
<span id="cb93-122"><a href="modelling-species-occupancy.html#cb93-122"></a></span>
<span id="cb93-123"><a href="modelling-species-occupancy.html#cb93-123"></a>    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb93-124"><a href="modelling-species-occupancy.html#cb93-124"></a>  }</span>
<span id="cb93-125"><a href="modelling-species-occupancy.html#cb93-125"></a>  <span class="kw">gc</span>()</span>
<span id="cb93-126"><a href="modelling-species-occupancy.html#cb93-126"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb93-127"><a href="modelling-species-occupancy.html#cb93-127"></a>  <span class="kw">stopCluster</span>(clust)</span>
<span id="cb93-128"><a href="modelling-species-occupancy.html#cb93-128"></a>}</span>
<span id="cb93-129"><a href="modelling-species-occupancy.html#cb93-129"></a><span class="kw">close</span>(pb)</span>
<span id="cb93-130"><a href="modelling-species-occupancy.html#cb93-130"></a></span>
<span id="cb93-131"><a href="modelling-species-occupancy.html#cb93-131"></a><span class="co"># 1. Store all the model outputs for each species (for both landcover and climate)</span></span>
<span id="cb93-132"><a href="modelling-species-occupancy.html#cb93-132"></a><span class="kw">write.xlsx</span>(lc_clim, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim.xlsx&quot;</span>)</span>
<span id="cb93-133"><a href="modelling-species-occupancy.html#cb93-133"></a></span>
<span id="cb93-134"><a href="modelling-species-occupancy.html#cb93-134"></a><span class="co"># 2. Store all the model averaged outputs for each species and relative importance scores</span></span>
<span id="cb93-135"><a href="modelling-species-occupancy.html#cb93-135"></a><span class="kw">write.xlsx</span>(lc_clim_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb93-136"><a href="modelling-species-occupancy.html#cb93-136"></a><span class="kw">write.xlsx</span>(lc_clim_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb93-137"><a href="modelling-species-occupancy.html#cb93-137"></a></span>
<span id="cb93-138"><a href="modelling-species-occupancy.html#cb93-138"></a><span class="co"># 3. Store all model estimates</span></span>
<span id="cb93-139"><a href="modelling-species-occupancy.html#cb93-139"></a><span class="kw">write.xlsx</span>(lc_clim_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb93-140"><a href="modelling-species-occupancy.html#cb93-140"></a></span>
<span id="cb93-141"><a href="modelling-species-occupancy.html#cb93-141"></a><span class="co"># Note if you are unable to write to a file, use (for example)</span></span>
<span id="cb93-142"><a href="modelling-species-occupancy.html#cb93-142"></a>a &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(lc_clim_modelEst, <span class="op">~</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">compact</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(.) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="goodness-of-fit-tests" class="section level2">
<h2><span class="header-section-number">9.5</span> Goodness-of-fit tests</h2>
<p>Adequate model fit was assessed using a chi-square goodness-of-fit test using 1,000 parametric bootstrap simulations on a global model that included all occupancy and detection covariates (MacKenzie &amp; Bailey, 2004).</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="modelling-species-occupancy.html#cb94-1"></a>goodness_of_fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb94-2"><a href="modelling-species-occupancy.html#cb94-2"></a></span>
<span id="cb94-3"><a href="modelling-species-occupancy.html#cb94-3"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb94-4"><a href="modelling-species-occupancy.html#cb94-4"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></span>
<span id="cb94-5"><a href="modelling-species-occupancy.html#cb94-5"></a></span>
<span id="cb94-6"><a href="modelling-species-occupancy.html#cb94-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb94-7"><a href="modelling-species-occupancy.html#cb94-7"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb94-8"><a href="modelling-species-occupancy.html#cb94-8"></a></span>
<span id="cb94-9"><a href="modelling-species-occupancy.html#cb94-9"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb94-10"><a href="modelling-species-occupancy.html#cb94-10"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb94-11"><a href="modelling-species-occupancy.html#cb94-11"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb94-12"><a href="modelling-species-occupancy.html#cb94-12"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb94-13"><a href="modelling-species-occupancy.html#cb94-13"></a>    <span class="dt">n_days =</span> <span class="dv">1488</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb94-14"><a href="modelling-species-occupancy.html#cb94-14"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb94-15"><a href="modelling-species-occupancy.html#cb94-15"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb94-16"><a href="modelling-species-occupancy.html#cb94-16"></a>  )</span>
<span id="cb94-17"><a href="modelling-species-occupancy.html#cb94-17"></a></span>
<span id="cb94-18"><a href="modelling-species-occupancy.html#cb94-18"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb94-19"><a href="modelling-species-occupancy.html#cb94-19"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb94-20"><a href="modelling-species-occupancy.html#cb94-20"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb94-21"><a href="modelling-species-occupancy.html#cb94-21"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb94-22"><a href="modelling-species-occupancy.html#cb94-22"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb94-23"><a href="modelling-species-occupancy.html#cb94-23"></a>    <span class="st">&quot;protocol_type&quot;</span>,</span>
<span id="cb94-24"><a href="modelling-species-occupancy.html#cb94-24"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb94-25"><a href="modelling-species-occupancy.html#cb94-25"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb94-26"><a href="modelling-species-occupancy.html#cb94-26"></a>  )</span>
<span id="cb94-27"><a href="modelling-species-occupancy.html#cb94-27"></a></span>
<span id="cb94-28"><a href="modelling-species-occupancy.html#cb94-28"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb94-29"><a href="modelling-species-occupancy.html#cb94-29"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb94-30"><a href="modelling-species-occupancy.html#cb94-30"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb94-31"><a href="modelling-species-occupancy.html#cb94-31"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb94-32"><a href="modelling-species-occupancy.html#cb94-32"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb94-33"><a href="modelling-species-occupancy.html#cb94-33"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</span>
<span id="cb94-34"><a href="modelling-species-occupancy.html#cb94-34"></a>      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;bio15a&quot;</span></span>
<span id="cb94-35"><a href="modelling-species-occupancy.html#cb94-35"></a>    ),</span>
<span id="cb94-36"><a href="modelling-species-occupancy.html#cb94-36"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb94-37"><a href="modelling-species-occupancy.html#cb94-37"></a>  )</span>
<span id="cb94-38"><a href="modelling-species-occupancy.html#cb94-38"></a></span>
<span id="cb94-39"><a href="modelling-species-occupancy.html#cb94-39"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb94-40"><a href="modelling-species-occupancy.html#cb94-40"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb94-41"><a href="modelling-species-occupancy.html#cb94-41"></a></span>
<span id="cb94-42"><a href="modelling-species-occupancy.html#cb94-42"></a>  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb94-43"><a href="modelling-species-occupancy.html#cb94-43"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb94-44"><a href="modelling-species-occupancy.html#cb94-44"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb94-45"><a href="modelling-species-occupancy.html#cb94-45"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb94-46"><a href="modelling-species-occupancy.html#cb94-46"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb94-47"><a href="modelling-species-occupancy.html#cb94-47"></a><span class="st">    </span>protocol_type <span class="op">+</span></span>
<span id="cb94-48"><a href="modelling-species-occupancy.html#cb94-48"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="dv">01</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">02</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">05</span> <span class="op">+</span></span>
<span id="cb94-49"><a href="modelling-species-occupancy.html#cb94-49"></a><span class="st">    </span>lc_<span class="dv">04</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">09</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">07</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">03</span> <span class="op">+</span><span class="st"> </span>bio4a <span class="op">+</span><span class="st"> </span>bio15a, <span class="dt">data =</span> occ_um)</span>
<span id="cb94-50"><a href="modelling-species-occupancy.html#cb94-50"></a></span>
<span id="cb94-51"><a href="modelling-species-occupancy.html#cb94-51"></a>  <span class="co"># note: reduce nsim as this takes a very long time even with parallelization</span></span>
<span id="cb94-52"><a href="modelling-species-occupancy.html#cb94-52"></a>  occ_gof &lt;-<span class="st"> </span><span class="kw">mb.gof.test</span>(model_lc_clim,</span>
<span id="cb94-53"><a href="modelling-species-occupancy.html#cb94-53"></a>    <span class="dt">nsim =</span> <span class="dv">1000</span>, <span class="dt">parallel =</span> T, <span class="dt">ncores =</span> <span class="dv">5</span>,</span>
<span id="cb94-54"><a href="modelling-species-occupancy.html#cb94-54"></a>    <span class="dt">plot.hist =</span> <span class="ot">FALSE</span></span>
<span id="cb94-55"><a href="modelling-species-occupancy.html#cb94-55"></a>  )</span>
<span id="cb94-56"><a href="modelling-species-occupancy.html#cb94-56"></a></span>
<span id="cb94-57"><a href="modelling-species-occupancy.html#cb94-57"></a>  p.value &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>p.value</span>
<span id="cb94-58"><a href="modelling-species-occupancy.html#cb94-58"></a>  c.hat &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>c.hat.est</span>
<span id="cb94-59"><a href="modelling-species-occupancy.html#cb94-59"></a>  scientific_name &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>scientific_name)</span>
<span id="cb94-60"><a href="modelling-species-occupancy.html#cb94-60"></a></span>
<span id="cb94-61"><a href="modelling-species-occupancy.html#cb94-61"></a>  a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(scientific_name, p.value, c.hat)</span>
<span id="cb94-62"><a href="modelling-species-occupancy.html#cb94-62"></a></span>
<span id="cb94-63"><a href="modelling-species-occupancy.html#cb94-63"></a>  goodness_of_fit &lt;-<span class="st"> </span><span class="kw">rbind</span>(a, goodness_of_fit)</span>
<span id="cb94-64"><a href="modelling-species-occupancy.html#cb94-64"></a></span>
<span id="cb94-65"><a href="modelling-species-occupancy.html#cb94-65"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb94-66"><a href="modelling-species-occupancy.html#cb94-66"></a>}</span>
<span id="cb94-67"><a href="modelling-species-occupancy.html#cb94-67"></a><span class="kw">close</span>(pb)</span>
<span id="cb94-68"><a href="modelling-species-occupancy.html#cb94-68"></a></span>
<span id="cb94-69"><a href="modelling-species-occupancy.html#cb94-69"></a><span class="kw">write.csv</span>(goodness_of_fit, <span class="st">&quot;data/results/goodness-of-fit-2.5km.csv&quot;</span>, <span class="dt">row.names =</span> F)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-covariates-to-checklist-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-occupancy-predictor-effects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/09_occupancy-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
