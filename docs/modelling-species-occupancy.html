<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pratikunterwegs/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Morgan W. Tingley" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2021-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-covariates-to-checklist-data.html"/>
<link rel="next" href="visualizing-occupancy-predictor-effects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#main-text-figure-1"><i class="fa fa-check"></i><b>1.4</b> Main Text Figure 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>2</b> Preparing eBird Data</a><ul>
<li class="chapter" data-level="2.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>2.2</b> Filter data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>2.3</b> Process filtered data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>2.4</b> Spatial filter</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>2.5</b> Handle presence data</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>2.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>3</b> Preparing Environmental Predictors</a><ul>
<li class="chapter" data-level="3.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>3.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>3.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-bioclim-15"><i class="fa fa-check"></i><b>3.4</b> Prepare Bioclim 4a and Bioclim 15</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>3.5</b> Prepare CHELSA rasters</a><ul>
<li class="chapter" data-level="3.5.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-15"><i class="fa fa-check"></i><b>3.5.1</b> Prepare BIOCLIM 4a and 15</a></li>
<li class="chapter" data-level="3.5.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a"><i class="fa fa-check"></i><b>3.5.2</b> Prepare BIOCLIM 4a</a></li>
<li class="chapter" data-level="3.5.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-15"><i class="fa fa-check"></i><b>3.5.3</b> Prepare Bioclim 15</a></li>
<li class="chapter" data-level="3.5.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate"><i class="fa fa-check"></i><b>3.5.4</b> Stack terrain and climate</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>3.6</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="3.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>3.7</b> Resample other rasters to 1km</a><ul>
<li class="chapter" data-level="3.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>3.7.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="3.7.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>3.7.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-seasonality-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.8</b> Climate seasonality in relation to elevation</a><ul>
<li class="chapter" data-level="3.8.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>3.8.1</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#climate-seasonality-across-land-cover-types"><i class="fa fa-check"></i><b>3.9</b> Climate seasonality across land cover types</a></li>
<li class="chapter" data-level="3.10" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.10</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="3.11" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>3.11</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html"><i class="fa fa-check"></i><b>4</b> Preparing Observer Expertise Scores</a><ul>
<li class="chapter" data-level="4.1" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>4.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>4.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="4.5" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>4.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#get-landcover"><i class="fa fa-check"></i><b>4.6</b> Get landcover</a></li>
<li class="chapter" data-level="4.7" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#filter-checklist-data"><i class="fa fa-check"></i><b>4.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="4.8" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#model-observer-expertise"><i class="fa fa-check"></i><b>4.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>5</b> Examining Spatial Sampling Bias</a><ul>
<li class="chapter" data-level="5.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#read-checklist-data"><i class="fa fa-check"></i><b>5.2</b> Read checklist data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>5.2.1</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="5.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#get-background-land-for-plotting"><i class="fa fa-check"></i><b>5.2.2</b> Get background land for plotting</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-main-text-figure-3"><i class="fa fa-check"></i><b>5.3</b> Prepare Main Text Figure 3</a><ul>
<li class="chapter" data-level="5.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>5.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="5.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>5.3.2</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="5.3.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>5.3.3</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="5.3.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatial-distribution-of-distances-to-neighbours"><i class="fa fa-check"></i><b>5.3.4</b> Spatial distribution of distances to neighbours</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#figure-spatial-sampling-bias"><i class="fa fa-check"></i><b>5.4</b> Figure: Spatial sampling bias</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html"><i class="fa fa-check"></i><b>6</b> Checking Temporal Sampling Frequency</a><ul>
<li class="chapter" data-level="6.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-libraries"><i class="fa fa-check"></i><b>6.1</b> Load libraries</a></li>
<li class="chapter" data-level="6.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-checklist-data"><i class="fa fa-check"></i><b>6.2</b> Load checklist data</a></li>
<li class="chapter" data-level="6.3" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-time-differences-per-grid-cell"><i class="fa fa-check"></i><b>6.3</b> Get time differences per grid cell</a></li>
<li class="chapter" data-level="6.4" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#time-since-previous-checklist"><i class="fa fa-check"></i><b>6.4</b> Time Since Previous Checklist</a><ul>
<li class="chapter" data-level="6.4.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-aux-data"><i class="fa fa-check"></i><b>6.4.1</b> Get aux data</a></li>
<li class="chapter" data-level="6.4.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#histogram-of-lags"><i class="fa fa-check"></i><b>6.4.2</b> Histogram of lags</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#main-text-figure-3"><i class="fa fa-check"></i><b>6.5</b> Main Text Figure 3</a></li>
<li class="chapter" data-level="6.6" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#checklists-per-month"><i class="fa fa-check"></i><b>6.6</b> Checklists per Month</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>7</b> Adding Covariates to Checklist Data</a><ul>
<li class="chapter" data-level="7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>7.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>7.2</b> Spatial subsampling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#counting-presence-observation-proportion"><i class="fa fa-check"></i><b>7.2.1</b> Counting presence observation proportion</a></li>
<li class="chapter" data-level="7.2.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-spatial-thinning"><i class="fa fa-check"></i><b>7.2.2</b> Count absences after spatial thinning</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>7.3</b> Temporal subsampling</a><ul>
<li class="chapter" data-level="7.3.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#count-absences-after-temporal-thinning"><i class="fa fa-check"></i><b>7.3.1</b> Count absences after temporal thinning</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>7.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="7.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>7.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="7.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>7.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="7.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>7.7</b> Spatial buffer-wide covariates</a><ul>
<li class="chapter" data-level="7.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>7.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="7.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>7.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="7.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>7.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>8</b> Modelling Species Occupancy</a><ul>
<li class="chapter" data-level="8.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>8.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="8.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-prepare-covariates"><i class="fa fa-check"></i><b>8.1</b> Load dataframe and prepare covariates</a><ul>
<li class="chapter" data-level="8.1.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-the-sampling-protocol"><i class="fa fa-check"></i><b>8.1.1</b> Handle the sampling protocol</a></li>
<li class="chapter" data-level="8.1.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#handle-time-and-date"><i class="fa fa-check"></i><b>8.1.2</b> Handle time and date</a></li>
<li class="chapter" data-level="8.1.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#scaling-covariates"><i class="fa fa-check"></i><b>8.1.3</b> Scaling covariates</a></li>
<li class="chapter" data-level="8.1.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#correct-date-format"><i class="fa fa-check"></i><b>8.1.4</b> Correct date format</a></li>
<li class="chapter" data-level="8.1.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#check-for-correlated-covariates"><i class="fa fa-check"></i><b>8.1.5</b> Check for correlated covariates</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>8.2</b> Running a null model</a></li>
<li class="chapter" data-level="8.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>8.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="8.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>8.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="8.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>8.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>9</b> Visualizing Occupancy Predictor Effects</a><ul>
<li class="chapter" data-level="9.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-3"><i class="fa fa-check"></i><b>9.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>9.2</b> Load species list</a></li>
<li class="chapter" data-level="9.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>9.3</b> Show AIC weight importance</a><ul>
<li class="chapter" data-level="9.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>9.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="9.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>9.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>9.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="9.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>9.5</b> Get predictor effects</a></li>
<li class="chapter" data-level="9.6" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#main-text-figure-4"><i class="fa fa-check"></i><b>9.6</b> Main Text Figure 4</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-species-occupancy" class="section level1">
<h1><span class="header-section-number">Section 8</span> Modelling Species Occupancy</h1>
<div id="load-necessary-libraries" class="section level3">
<h3><span class="header-section-number">8.0.1</span> Load necessary libraries</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="co"># Load libraries</span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="co"># for ebird data</span></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="kw">library</span>(auk)</a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="kw">library</span>(ebirdst)</a>
<a class="sourceLine" id="cb76-5" data-line-number="5"></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="co"># general data</span></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="kw">library</span>(openxlsx)</a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="kw">library</span>(raster) <span class="co"># prolly unnecessary</span></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"></a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="co"># for models</span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"><span class="kw">library</span>(unmarked)</a>
<a class="sourceLine" id="cb76-15" data-line-number="15"><span class="kw">library</span>(MuMIn)</a>
<a class="sourceLine" id="cb76-16" data-line-number="16"><span class="kw">library</span>(AICcmodavg)</a>
<a class="sourceLine" id="cb76-17" data-line-number="17"><span class="kw">library</span>(fields)</a>
<a class="sourceLine" id="cb76-18" data-line-number="18"></a>
<a class="sourceLine" id="cb76-19" data-line-number="19"><span class="co"># for computation</span></a>
<a class="sourceLine" id="cb76-20" data-line-number="20"><span class="kw">library</span>(doParallel)</a>
<a class="sourceLine" id="cb76-21" data-line-number="21"><span class="kw">library</span>(snow)</a>
<a class="sourceLine" id="cb76-22" data-line-number="22"><span class="kw">library</span>(ecodist)</a>
<a class="sourceLine" id="cb76-23" data-line-number="23"></a>
<a class="sourceLine" id="cb76-24" data-line-number="24"><span class="co"># Source necessary functions</span></a>
<a class="sourceLine" id="cb76-25" data-line-number="25"><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</a>
<a class="sourceLine" id="cb76-26" data-line-number="26"><span class="kw">source</span>(<span class="st">&quot;R/fun_model_estimate_collection.r&quot;</span>)</a></code></pre></div>
</div>
<div id="load-dataframe-and-prepare-covariates" class="section level2">
<h2><span class="header-section-number">8.1</span> Load dataframe and prepare covariates</h2>
<p>Here, we load the required dataframe that contains 10 random visits to a site and environmental covariates that were prepared at a spatial scale of 2.5 sq.km. We also scaled all covariates (mean around 0 and standard deviation of 1). Next, we ensured that only Traveling and Stationary checklists were considered. Even though stationary counts have no distance traveled, we defaulted all stationary accounts to an effective distance of 100m, which we consider the average maximum detection radius for most bird species in our area.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="co"># Load in the prepared dataframe that contains 10 random visits to each site</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2">dat &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/04_data-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb77-3" data-line-number="3">dat &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(dat)</a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw">head</span>(dat)</a></code></pre></div>
<div id="handle-the-sampling-protocol" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Handle the sampling protocol</h3>
<p>Select protocol and add 0.1 km to stationary checklists.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># Some more pre-processing to get the right data structures</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="co"># Ensuring that only Traveling and Stationary checklists were considered</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="kw">names</span>(dat)</a>
<a class="sourceLine" id="cb78-5" data-line-number="5">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(protocol_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Traveling&quot;</span>, <span class="st">&quot;Stationary&quot;</span>))</a>
<a class="sourceLine" id="cb78-6" data-line-number="6"></a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="co"># We take all stationary counts and give them a distance of 100 m (so 0.1 km),</span></a>
<a class="sourceLine" id="cb78-8" data-line-number="8"><span class="co"># as that&#39;s approximately the max normal hearing distance for people doing point</span></a>
<a class="sourceLine" id="cb78-9" data-line-number="9"><span class="co"># counts.</span></a>
<a class="sourceLine" id="cb78-10" data-line-number="10">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">effort_distance_km =</span> <span class="kw">if_else</span>(</a>
<a class="sourceLine" id="cb78-12" data-line-number="12">    effort_distance_km <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb78-13" data-line-number="13"><span class="st">      </span>protocol_type <span class="op">==</span><span class="st"> &quot;Stationary&quot;</span>,</a>
<a class="sourceLine" id="cb78-14" data-line-number="14">    <span class="fl">0.1</span>, effort_distance_km</a>
<a class="sourceLine" id="cb78-15" data-line-number="15">  ))</a></code></pre></div>
</div>
<div id="handle-time-and-date" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Handle time and date</h3>
<p>Convert time and date to julian date and minutes since day.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="co"># Converting time observations started to numeric and adding it as a new column</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="co"># This new column will be minute_observations_started</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3">dat &lt;-</a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="st">  </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb79-6" data-line-number="6">    <span class="dt">min_obs_started =</span> <span class="kw">as.integer</span>(</a>
<a class="sourceLine" id="cb79-7" data-line-number="7">      <span class="kw">as.difftime</span>(</a>
<a class="sourceLine" id="cb79-8" data-line-number="8">        time_observations_started,</a>
<a class="sourceLine" id="cb79-9" data-line-number="9">        <span class="dt">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>, <span class="dt">units =</span> <span class="st">&quot;mins&quot;</span></a>
<a class="sourceLine" id="cb79-10" data-line-number="10">      )</a>
<a class="sourceLine" id="cb79-11" data-line-number="11">    )</a>
<a class="sourceLine" id="cb79-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb79-13" data-line-number="13"></a>
<a class="sourceLine" id="cb79-14" data-line-number="14"><span class="co"># Adding the julian date to the dataframe</span></a>
<a class="sourceLine" id="cb79-15" data-line-number="15">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">julian_date =</span> lubridate<span class="op">::</span><span class="kw">yday</span>(observation_date))</a>
<a class="sourceLine" id="cb79-17" data-line-number="17"></a>
<a class="sourceLine" id="cb79-18" data-line-number="18"><span class="co"># recode julian date to model it as a linear predictor</span></a>
<a class="sourceLine" id="cb79-19" data-line-number="19">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb79-21" data-line-number="21">    <span class="dt">newjulianDate =</span></a>
<a class="sourceLine" id="cb79-22" data-line-number="22">      <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb79-23" data-line-number="23">        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">334</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">365</span> <span class="op">~</span></a>
<a class="sourceLine" id="cb79-24" data-line-number="24"><span class="st">        </span>(julian_date <span class="op">-</span><span class="st"> </span><span class="dv">333</span>),</a>
<a class="sourceLine" id="cb79-25" data-line-number="25">        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">152</span> <span class="op">~</span></a>
<a class="sourceLine" id="cb79-26" data-line-number="26"><span class="st">        </span>(julian_date <span class="op">+</span><span class="st"> </span><span class="dv">31</span>)</a>
<a class="sourceLine" id="cb79-27" data-line-number="27">      )</a>
<a class="sourceLine" id="cb79-28" data-line-number="28">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-29" data-line-number="29"><span class="st">  </span><span class="kw">drop_na</span>(newjulianDate)</a>
<a class="sourceLine" id="cb79-30" data-line-number="30"></a>
<a class="sourceLine" id="cb79-31" data-line-number="31"><span class="co"># recode time observations started to model it as a linear predictor</span></a>
<a class="sourceLine" id="cb79-32" data-line-number="32">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-33" data-line-number="33"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb79-34" data-line-number="34">    <span class="dt">newmin_obs_started =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb79-35" data-line-number="35">      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">300</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">~</span></a>
<a class="sourceLine" id="cb79-36" data-line-number="36"><span class="st">      </span><span class="kw">abs</span>(min_obs_started <span class="op">-</span><span class="st"> </span><span class="dv">720</span>),</a>
<a class="sourceLine" id="cb79-37" data-line-number="37">      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1140</span> <span class="op">~</span></a>
<a class="sourceLine" id="cb79-38" data-line-number="38"><span class="st">      </span><span class="kw">abs</span>(<span class="dv">720</span> <span class="op">-</span><span class="st"> </span>min_obs_started)</a>
<a class="sourceLine" id="cb79-39" data-line-number="39">    )</a>
<a class="sourceLine" id="cb79-40" data-line-number="40">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-41" data-line-number="41"><span class="st">  </span><span class="kw">drop_na</span>(newmin_obs_started)</a></code></pre></div>
</div>
<div id="scaling-covariates" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Scaling covariates</h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="co"># Removing other unnecessary columns from the dataframe and creating a clean one without the rest</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw">names</span>(dat)</a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="co"># select relevant columns BY NAME</span></a>
<a class="sourceLine" id="cb80-4" data-line-number="4">dat &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb80-5" data-line-number="5">  dat,</a>
<a class="sourceLine" id="cb80-6" data-line-number="6">  <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb80-7" data-line-number="7">    <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>, <span class="st">&quot;locality&quot;</span>,</a>
<a class="sourceLine" id="cb80-8" data-line-number="8">    <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;observer_id&quot;</span>,</a>
<a class="sourceLine" id="cb80-9" data-line-number="9">    <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>,</a>
<a class="sourceLine" id="cb80-10" data-line-number="10">    <span class="st">&quot;protocol_type&quot;</span>, <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;pres_abs&quot;</span></a>
<a class="sourceLine" id="cb80-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb80-12" data-line-number="12"></a>
<a class="sourceLine" id="cb80-13" data-line-number="13">  <span class="co"># rename X-Y but </span><span class="al">NOTE</span><span class="co"> THEY ARE IN UTM COORDINATES</span></a>
<a class="sourceLine" id="cb80-14" data-line-number="14">  <span class="dt">longitude =</span> <span class="st">&quot;X&quot;</span>, <span class="dt">latitude =</span> <span class="st">&quot;Y&quot;</span>,</a>
<a class="sourceLine" id="cb80-15" data-line-number="15">  expertise,</a>
<a class="sourceLine" id="cb80-16" data-line-number="16"></a>
<a class="sourceLine" id="cb80-17" data-line-number="17">  <span class="co"># elevation and climate layers</span></a>
<a class="sourceLine" id="cb80-18" data-line-number="18">  elev, bio15a, bio4a,</a>
<a class="sourceLine" id="cb80-19" data-line-number="19"></a>
<a class="sourceLine" id="cb80-20" data-line-number="20">  <span class="co"># all LANDCOVER COLUMNS</span></a>
<a class="sourceLine" id="cb80-21" data-line-number="21">  <span class="kw">matches</span>(<span class="st">&quot;lc&quot;</span>),</a>
<a class="sourceLine" id="cb80-22" data-line-number="22"></a>
<a class="sourceLine" id="cb80-23" data-line-number="23">  <span class="co"># set new columns to old column names</span></a>
<a class="sourceLine" id="cb80-24" data-line-number="24">  <span class="dt">julian_date =</span> <span class="st">&quot;newjulianDate&quot;</span>,</a>
<a class="sourceLine" id="cb80-25" data-line-number="25">  <span class="dt">min_obs_started =</span> <span class="st">&quot;newmin_obs_started&quot;</span></a>
<a class="sourceLine" id="cb80-26" data-line-number="26">)</a>
<a class="sourceLine" id="cb80-27" data-line-number="27"></a>
<a class="sourceLine" id="cb80-28" data-line-number="28"><span class="co"># add year and convert presence-absence to integer</span></a>
<a class="sourceLine" id="cb80-29" data-line-number="29">dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb80-30" data-line-number="30"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb80-31" data-line-number="31">    <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</a>
<a class="sourceLine" id="cb80-32" data-line-number="32">    <span class="dt">pres_abs =</span> <span class="kw">as.integer</span>(pres_abs)</a>
<a class="sourceLine" id="cb80-33" data-line-number="33">  ) <span class="co"># occupancy modeling requires an integer response</span></a>
<a class="sourceLine" id="cb80-34" data-line-number="34"></a>
<a class="sourceLine" id="cb80-35" data-line-number="35"><span class="co"># Scaling detection and occupancy covariates</span></a>
<a class="sourceLine" id="cb80-36" data-line-number="36">dat.scaled &lt;-<span class="st"> </span>dat<span class="fl">.1</span></a>
<a class="sourceLine" id="cb80-37" data-line-number="37"></a>
<a class="sourceLine" id="cb80-38" data-line-number="38"><span class="co"># Note: Never refer to columns by numbers, numbers change, names remain</span></a>
<a class="sourceLine" id="cb80-39" data-line-number="39">cols_to_scale &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb80-40" data-line-number="40">  <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb80-41" data-line-number="41">  <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;elev&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_01&quot;</span>,</a>
<a class="sourceLine" id="cb80-42" data-line-number="42">  <span class="st">&quot;lc_05&quot;</span>, <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>,</a>
<a class="sourceLine" id="cb80-43" data-line-number="43">  <span class="st">&quot;julian_date&quot;</span>, <span class="st">&quot;min_obs_started&quot;</span></a>
<a class="sourceLine" id="cb80-44" data-line-number="44">)</a>
<a class="sourceLine" id="cb80-45" data-line-number="45"></a>
<a class="sourceLine" id="cb80-46" data-line-number="46"><span class="co"># this scales the relevant columns between 0 and 1</span></a>
<a class="sourceLine" id="cb80-47" data-line-number="47">dat.scaled &lt;-<span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb80-48" data-line-number="48">  dat.scaled,</a>
<a class="sourceLine" id="cb80-49" data-line-number="49">  <span class="kw">across</span>(</a>
<a class="sourceLine" id="cb80-50" data-line-number="50">    <span class="dt">.cols =</span> <span class="kw">all_of</span>(cols_to_scale), <span class="co"># referring to the columns</span></a>
<a class="sourceLine" id="cb80-51" data-line-number="51">    <span class="dt">.fns =</span> scales<span class="op">::</span>rescale <span class="co"># the rescale function</span></a>
<a class="sourceLine" id="cb80-52" data-line-number="52">  )</a>
<a class="sourceLine" id="cb80-53" data-line-number="53">)</a>
<a class="sourceLine" id="cb80-54" data-line-number="54"></a>
<a class="sourceLine" id="cb80-55" data-line-number="55"><span class="co"># save data to file</span></a>
<a class="sourceLine" id="cb80-56" data-line-number="56"><span class="kw">fwrite</span>(dat.scaled, <span class="dt">file =</span> <span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="correct-date-format" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Correct date format</h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="co"># Reload the scaled covariate data</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2">dat.scaled &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">dat.scaled &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(dat.scaled)</a>
<a class="sourceLine" id="cb81-4" data-line-number="4"><span class="kw">head</span>(dat.scaled)</a>
<a class="sourceLine" id="cb81-5" data-line-number="5"></a>
<a class="sourceLine" id="cb81-6" data-line-number="6"><span class="co"># Ensure observation_date column is in the right format</span></a>
<a class="sourceLine" id="cb81-7" data-line-number="7">dat.scaled<span class="op">$</span>observation_date &lt;-<span class="st"> </span><span class="kw">format</span>(</a>
<a class="sourceLine" id="cb81-8" data-line-number="8">  <span class="kw">as.Date</span>(</a>
<a class="sourceLine" id="cb81-9" data-line-number="9">    dat.scaled<span class="op">$</span>observation_date,</a>
<a class="sourceLine" id="cb81-10" data-line-number="10">    <span class="st">&quot;%m/%d/%Y&quot;</span></a>
<a class="sourceLine" id="cb81-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb81-12" data-line-number="12">  <span class="st">&quot;%Y-%m-%d&quot;</span></a>
<a class="sourceLine" id="cb81-13" data-line-number="13">)</a></code></pre></div>
</div>
<div id="check-for-correlated-covariates" class="section level3">
<h3><span class="header-section-number">8.1.5</span> Check for correlated covariates</h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="co"># Testing for correlations before running further analyses</span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="co"># Majority are uncorrelated since we decided to keep climatic and land cover predictors and removed elevation.</span></a>
<a class="sourceLine" id="cb82-3" data-line-number="3"><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</a>
<a class="sourceLine" id="cb82-4" data-line-number="4"></a>
<a class="sourceLine" id="cb82-5" data-line-number="5"><span class="co"># SELECT COLUMNS to check BY NAME</span></a>
<a class="sourceLine" id="cb82-6" data-line-number="6">cols_to_check &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb82-7" data-line-number="7">  <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span>, <span class="st">&quot;lc_02&quot;</span>,</a>
<a class="sourceLine" id="cb82-8" data-line-number="8">  <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_01&quot;</span>,</a>
<a class="sourceLine" id="cb82-9" data-line-number="9">  <span class="st">&quot;lc_05&quot;</span>, <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span></a>
<a class="sourceLine" id="cb82-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb82-11" data-line-number="11"></a>
<a class="sourceLine" id="cb82-12" data-line-number="12"><span class="co"># screen covariates for correlation</span></a>
<a class="sourceLine" id="cb82-13" data-line-number="13"><span class="kw">screen.cor</span>(dat.scaled[, cols_to_check], <span class="dt">threshold =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb82-14" data-line-number="14"></a>
<a class="sourceLine" id="cb82-15" data-line-number="15"><span class="co"># total number of presences by species</span></a>
<a class="sourceLine" id="cb82-16" data-line-number="16"><span class="co"># min no. presences = 173 to max = 6423</span></a>
<a class="sourceLine" id="cb82-17" data-line-number="17">presSpecies &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-18" data-line-number="18"><span class="st">  </span><span class="kw">group_by</span>(scientific_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-19" data-line-number="19"><span class="st">  </span><span class="kw">filter</span>(pres_abs <span class="op">==</span><span class="st"> &quot;1&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-20" data-line-number="20"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb82-21" data-line-number="21"></a>
<a class="sourceLine" id="cb82-22" data-line-number="22"><span class="co"># convert locality_id to factors</span></a>
<a class="sourceLine" id="cb82-23" data-line-number="23">dat.scaled<span class="op">$</span>locality_id &lt;-<span class="st"> </span><span class="kw">as.factor</span>(dat.scaled<span class="op">$</span>locality_id)</a></code></pre></div>
</div>
</div>
<div id="running-a-null-model" class="section level2">
<h2><span class="header-section-number">8.2</span> Running a null model</h2>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="co"># All null models are stored in lists below</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2">all_null &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb83-3" data-line-number="3"></a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="co"># define species and a counter</span></a>
<a class="sourceLine" id="cb83-5" data-line-number="5">species &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)</a>
<a class="sourceLine" id="cb83-6" data-line-number="6">counter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb83-7" data-line-number="7"></a>
<a class="sourceLine" id="cb83-8" data-line-number="8"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb83-9" data-line-number="9">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</a>
<a class="sourceLine" id="cb83-10" data-line-number="10">  <span class="dt">min =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb83-11" data-line-number="11">  <span class="dt">max =</span> <span class="kw">length</span>(species),</a>
<a class="sourceLine" id="cb83-12" data-line-number="12">  <span class="dt">style =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb83-13" data-line-number="13">) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb83-14" data-line-number="14"></a>
<a class="sourceLine" id="cb83-15" data-line-number="15"><span class="co"># loop over species</span></a>
<a class="sourceLine" id="cb83-16" data-line-number="16"><span class="cf">for</span> (i <span class="cf">in</span> species) {</a>
<a class="sourceLine" id="cb83-17" data-line-number="17"></a>
<a class="sourceLine" id="cb83-18" data-line-number="18">  <span class="co"># filter data by species</span></a>
<a class="sourceLine" id="cb83-19" data-line-number="19">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-20" data-line-number="20"><span class="st">    </span><span class="kw">filter</span>(scientific_name <span class="op">==</span><span class="st"> </span>i)</a>
<a class="sourceLine" id="cb83-21" data-line-number="21"></a>
<a class="sourceLine" id="cb83-22" data-line-number="22">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb83-23" data-line-number="23">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb83-24" data-line-number="24">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb83-25" data-line-number="25">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb83-26" data-line-number="26">    <span class="dt">n_days =</span> <span class="dv">1302</span>, <span class="co"># 7 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb83-27" data-line-number="27">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb83-28" data-line-number="28">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb83-29" data-line-number="29">  )</a>
<a class="sourceLine" id="cb83-30" data-line-number="30"></a>
<a class="sourceLine" id="cb83-31" data-line-number="31">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb83-32" data-line-number="32">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb83-33" data-line-number="33">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb83-34" data-line-number="34">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb83-35" data-line-number="35">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb83-36" data-line-number="36">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb83-37" data-line-number="37">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb83-38" data-line-number="38">  )</a>
<a class="sourceLine" id="cb83-39" data-line-number="39"></a>
<a class="sourceLine" id="cb83-40" data-line-number="40">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb83-41" data-line-number="41">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb83-42" data-line-number="42">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb83-43" data-line-number="43">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb83-44" data-line-number="44">    <span class="dt">site_covs =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb83-45" data-line-number="45">      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</a>
<a class="sourceLine" id="cb83-46" data-line-number="46">      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span></a>
<a class="sourceLine" id="cb83-47" data-line-number="47">    ),</a>
<a class="sourceLine" id="cb83-48" data-line-number="48">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb83-49" data-line-number="49">  )</a>
<a class="sourceLine" id="cb83-50" data-line-number="50"></a>
<a class="sourceLine" id="cb83-51" data-line-number="51">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb83-52" data-line-number="52">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb83-53" data-line-number="53"></a>
<a class="sourceLine" id="cb83-54" data-line-number="54">  <span class="co"># Set up the model</span></a>
<a class="sourceLine" id="cb83-55" data-line-number="55">  <span class="co"># the list is now automatically named</span></a>
<a class="sourceLine" id="cb83-56" data-line-number="56">  all_null[[i]] &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb83-57" data-line-number="57"></a>
<a class="sourceLine" id="cb83-58" data-line-number="58">  <span class="co"># increase counter</span></a>
<a class="sourceLine" id="cb83-59" data-line-number="59">  counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb83-60" data-line-number="60"></a>
<a class="sourceLine" id="cb83-61" data-line-number="61">  <span class="kw">setTxtProgressBar</span>(pb, counter)</a>
<a class="sourceLine" id="cb83-62" data-line-number="62">}</a>
<a class="sourceLine" id="cb83-63" data-line-number="63"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb83-64" data-line-number="64"></a>
<a class="sourceLine" id="cb83-65" data-line-number="65"><span class="co"># Store all the  model outputs for each species</span></a>
<a class="sourceLine" id="cb83-66" data-line-number="66"><span class="kw">capture.output</span>(all_null, <span class="dt">file =</span> <span class="st">&quot;data/results/null_models.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="identifying-covariates-necessary-to-model-the-detection-process" class="section level2">
<h2><span class="header-section-number">8.3</span> Identifying covariates necessary to model the detection process</h2>
<p>Here, we use the <code>unmarked</code> package in R <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011">2011</a>)</span> to identify detection level covariates that are important for each species. We use AIC criteria to select top models <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011">2011</a>)</span>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="co"># All models are stored in lists below</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2">det_dred &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb84-3" data-line-number="3"></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb84-5" data-line-number="5">top_det &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb84-6" data-line-number="6"></a>
<a class="sourceLine" id="cb84-7" data-line-number="7"><span class="co"># Getting model averaged coefficients and relative importance scores</span></a>
<a class="sourceLine" id="cb84-8" data-line-number="8">det_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb84-9" data-line-number="9">det_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb84-10" data-line-number="10"></a>
<a class="sourceLine" id="cb84-11" data-line-number="11"><span class="co"># Getting model estimates</span></a>
<a class="sourceLine" id="cb84-12" data-line-number="12">det_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb84-13" data-line-number="13"></a>
<a class="sourceLine" id="cb84-14" data-line-number="14"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb84-15" data-line-number="15">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</a>
<a class="sourceLine" id="cb84-16" data-line-number="16">  <span class="dt">min =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb84-17" data-line-number="17">  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb84-18" data-line-number="18">) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb84-19" data-line-number="19"></a>
<a class="sourceLine" id="cb84-20" data-line-number="20"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb84-21" data-line-number="21">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-22" data-line-number="22"><span class="st">    </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb84-23" data-line-number="23"></a>
<a class="sourceLine" id="cb84-24" data-line-number="24">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb84-25" data-line-number="25">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb84-26" data-line-number="26">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb84-27" data-line-number="27">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb84-28" data-line-number="28">    <span class="dt">n_days =</span> <span class="dv">1302</span>, <span class="co"># 7 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb84-29" data-line-number="29">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb84-30" data-line-number="30">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb84-31" data-line-number="31">  )</a>
<a class="sourceLine" id="cb84-32" data-line-number="32"></a>
<a class="sourceLine" id="cb84-33" data-line-number="33">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb84-34" data-line-number="34">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb84-35" data-line-number="35">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb84-36" data-line-number="36">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb84-37" data-line-number="37">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb84-38" data-line-number="38">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb84-39" data-line-number="39">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb84-40" data-line-number="40">  )</a>
<a class="sourceLine" id="cb84-41" data-line-number="41"></a>
<a class="sourceLine" id="cb84-42" data-line-number="42">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb84-43" data-line-number="43">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb84-44" data-line-number="44">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb84-45" data-line-number="45">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb84-46" data-line-number="46">    <span class="dt">site_covs =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb84-47" data-line-number="47">      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</a>
<a class="sourceLine" id="cb84-48" data-line-number="48">      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span></a>
<a class="sourceLine" id="cb84-49" data-line-number="49">    ),</a>
<a class="sourceLine" id="cb84-50" data-line-number="50">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb84-51" data-line-number="51">  )</a>
<a class="sourceLine" id="cb84-52" data-line-number="52"></a>
<a class="sourceLine" id="cb84-53" data-line-number="53">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb84-54" data-line-number="54">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb84-55" data-line-number="55"></a>
<a class="sourceLine" id="cb84-56" data-line-number="56">  <span class="co"># Fit a global model with all detection level covariates</span></a>
<a class="sourceLine" id="cb84-57" data-line-number="57">  global_mod &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb84-58" data-line-number="58"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb84-59" data-line-number="59"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb84-60" data-line-number="60"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb84-61" data-line-number="61"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb84-62" data-line-number="62"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb84-63" data-line-number="63"></a>
<a class="sourceLine" id="cb84-64" data-line-number="64">  <span class="co"># Set up the cluster</span></a>
<a class="sourceLine" id="cb84-65" data-line-number="65">  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></a>
<a class="sourceLine" id="cb84-66" data-line-number="66">  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</a>
<a class="sourceLine" id="cb84-67" data-line-number="67"></a>
<a class="sourceLine" id="cb84-68" data-line-number="68">  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</a>
<a class="sourceLine" id="cb84-69" data-line-number="69">  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</a>
<a class="sourceLine" id="cb84-70" data-line-number="70"></a>
<a class="sourceLine" id="cb84-71" data-line-number="71">  det_dred[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(global_mod, clust)</a>
<a class="sourceLine" id="cb84-72" data-line-number="72">  <span class="kw">names</span>(det_dred)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-73" data-line-number="73"></a>
<a class="sourceLine" id="cb84-74" data-line-number="74">  <span class="co"># Get the top models, which we&#39;ll define as those with deltaAICc &lt; 2</span></a>
<a class="sourceLine" id="cb84-75" data-line-number="75">  top_det[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(det_dred[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</a>
<a class="sourceLine" id="cb84-76" data-line-number="76">  <span class="kw">names</span>(top_det)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-77" data-line-number="77"></a>
<a class="sourceLine" id="cb84-78" data-line-number="78">  <span class="co"># Obtaining model averaged coefficients</span></a>
<a class="sourceLine" id="cb84-79" data-line-number="79">  <span class="cf">if</span> (<span class="kw">length</span>(top_det[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb84-80" data-line-number="80">    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_det[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb84-81" data-line-number="81">    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</a>
<a class="sourceLine" id="cb84-82" data-line-number="82">    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-83" data-line-number="83"></a>
<a class="sourceLine" id="cb84-84" data-line-number="84">    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb84-85" data-line-number="85">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb84-86" data-line-number="86">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb84-87" data-line-number="87">      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb84-88" data-line-number="88">      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb84-89" data-line-number="89">      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb84-90" data-line-number="90">      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</a>
<a class="sourceLine" id="cb84-91" data-line-number="91">    )</a>
<a class="sourceLine" id="cb84-92" data-line-number="92"></a>
<a class="sourceLine" id="cb84-93" data-line-number="93">    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-94" data-line-number="94"></a>
<a class="sourceLine" id="cb84-95" data-line-number="95">    det_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</a>
<a class="sourceLine" id="cb84-96" data-line-number="96">    <span class="kw">names</span>(det_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-97" data-line-number="97">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb84-98" data-line-number="98">    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_det[[i]][[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb84-99" data-line-number="99">    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-100" data-line-number="100"></a>
<a class="sourceLine" id="cb84-101" data-line-number="101">    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb84-102" data-line-number="102">    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb84-103" data-line-number="103">    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb84-104" data-line-number="104">    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb84-105" data-line-number="105"></a>
<a class="sourceLine" id="cb84-106" data-line-number="106">    Coefficient &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb84-107" data-line-number="107">    SE &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb84-108" data-line-number="108"></a>
<a class="sourceLine" id="cb84-109" data-line-number="109">    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb84-110" data-line-number="110">      <span class="dt">Coefficient =</span> Coefficient[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(Coefficient)],</a>
<a class="sourceLine" id="cb84-111" data-line-number="111">      <span class="dt">SE =</span> SE[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(SE)],</a>
<a class="sourceLine" id="cb84-112" data-line-number="112">      <span class="dt">lowerCI =</span> lowDet,</a>
<a class="sourceLine" id="cb84-113" data-line-number="113">      <span class="dt">upperCI =</span> upDet,</a>
<a class="sourceLine" id="cb84-114" data-line-number="114">      <span class="dt">z_value =</span> zDet,</a>
<a class="sourceLine" id="cb84-115" data-line-number="115">      <span class="dt">Pr_z =</span> Pr_zDet</a>
<a class="sourceLine" id="cb84-116" data-line-number="116">    )</a>
<a class="sourceLine" id="cb84-117" data-line-number="117"></a>
<a class="sourceLine" id="cb84-118" data-line-number="118">    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb84-119" data-line-number="119">  }</a>
<a class="sourceLine" id="cb84-120" data-line-number="120">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb84-121" data-line-number="121">  <span class="kw">stopCluster</span>(clust)</a>
<a class="sourceLine" id="cb84-122" data-line-number="122">}</a>
<a class="sourceLine" id="cb84-123" data-line-number="123"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb84-124" data-line-number="124"></a>
<a class="sourceLine" id="cb84-125" data-line-number="125"><span class="co">## Storing output from the above models in excel sheets</span></a>
<a class="sourceLine" id="cb84-126" data-line-number="126"></a>
<a class="sourceLine" id="cb84-127" data-line-number="127"><span class="co"># 1. Store all the model outputs for each species (variable: det_dred() - see above)</span></a>
<a class="sourceLine" id="cb84-128" data-line-number="128"><span class="kw">write.xlsx</span>(det_dred, <span class="dt">file =</span> <span class="st">&quot;data/results/det-dred.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb84-129" data-line-number="129"></a>
<a class="sourceLine" id="cb84-130" data-line-number="130"><span class="co"># 2. Store all the model averaged outputs for each species and the relative importance score</span></a>
<a class="sourceLine" id="cb84-131" data-line-number="131"><span class="kw">write.xlsx</span>(det_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/det-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb84-132" data-line-number="132"><span class="kw">write.xlsx</span>(det_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/det-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb84-133" data-line-number="133"></a>
<a class="sourceLine" id="cb84-134" data-line-number="134"><span class="kw">write.xlsx</span>(det_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/det-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb84-135" data-line-number="135"></a>
<a class="sourceLine" id="cb84-136" data-line-number="136"><span class="co"># Note if you are unable to write to a file, use (for example)</span></a>
<a class="sourceLine" id="cb84-137" data-line-number="137">a &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(det_imp, <span class="op">~</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">compact</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(.) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="land-cover-and-climate" class="section level2">
<h2><span class="header-section-number">8.4</span> Land Cover and Climate</h2>
<p>Occupancy models estimate the probability of occurrence of a given species while controlling for the probability of detection and allow us to model the factors affecting occurrence and detection independently <span class="citation">(Johnston et al. <a href="#ref-johnston2018">2018</a>; MacKenzie et al. <a href="#ref-mackenzie2002">2002</a>)</span>. The flexible eBird observation process contributes to the largest source of variation in the likelihood of detecting a particular species <span class="citation">(Johnston et al. <a href="#ref-johnston2019a">2019</a>)</span>; hence, we included seven covariates that influence the probability of detection for each checklist: ordinal day of year, duration of observation, distance travelled, protocol type, time observations started, number of observers and the checklist calibration index (CCI).</p>
<p>Using a multi-model information-theoretic approach, we tested how strongly our occurrence data fit our candidate set of environmental covariates <span class="citation">(Burnham and Anderson <a href="#ref-burnham2002a">2002</a>)</span>. We fitted single-species occupancy models for each species, to simultaneously estimate a probability of detection (p) and a probability of occupancy (<span class="math inline">\(\psi\)</span>) <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011">2011</a>; MacKenzie et al. <a href="#ref-mackenzie2002">2002</a>)</span>. For each species, we fit 256 models, each with a unique combination of the eight (climate and land cover) occupancy covariates and all seven detection covariates (Appendix S5).</p>
<p>Across the 256 models tested for each species, the model with highest support was determined using AICc scores. However, across the majority of the species, no single model had overwhelming support. Hence, for each species, we examined those models which had <span class="math inline">\(\Delta\)</span>AICc &lt; 2, as these top models were considered to explain a large proportion of the association between the species-specific probability of occupancy and environmental drivers <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011">2011</a>; Elsen et al. <a href="#ref-elsen2017">2017</a>)</span>. Using these restricted model sets for each species; we created a model-averaged coefficient estimate for each predictor and assessed its direction and significance <span class="citation">(Barto <a href="#ref-MuMIn">2020</a>)</span>. We considered a predictor to be significantly associated with occupancy if the range of the 95% confidence interval around the model-averaged coefficient did not contain zero. Next, we obtained a measure of relative importance of climatic and landscape predictors by calculating cumulative variable importance scores. These scores were calculated by obtaining the sum of model weights (AIC weights) across all models (including the top models) for each predictor across all species.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># All models are stored in lists below</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb85-3" data-line-number="3"></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5">top_lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb85-6" data-line-number="6"></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"><span class="co"># Getting model averaged coefficients and relative importance scores</span></a>
<a class="sourceLine" id="cb85-8" data-line-number="8">lc_clim_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb85-9" data-line-number="9">lc_clim_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb85-10" data-line-number="10"></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="co"># Storing Model estimates</span></a>
<a class="sourceLine" id="cb85-12" data-line-number="12">lc_clim_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb85-13" data-line-number="13"></a>
<a class="sourceLine" id="cb85-14" data-line-number="14"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb85-15" data-line-number="15">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb85-16" data-line-number="16"></a>
<a class="sourceLine" id="cb85-17" data-line-number="17"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb85-18" data-line-number="18">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb85-19" data-line-number="19"></a>
<a class="sourceLine" id="cb85-20" data-line-number="20">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb85-21" data-line-number="21">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb85-22" data-line-number="22">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb85-23" data-line-number="23">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb85-24" data-line-number="24">    <span class="dt">n_days =</span> <span class="dv">1302</span>, <span class="co"># 6 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb85-25" data-line-number="25">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb85-26" data-line-number="26">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb85-27" data-line-number="27">  )</a>
<a class="sourceLine" id="cb85-28" data-line-number="28"></a>
<a class="sourceLine" id="cb85-29" data-line-number="29">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb85-30" data-line-number="30">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb85-31" data-line-number="31">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb85-32" data-line-number="32">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb85-33" data-line-number="33">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb85-34" data-line-number="34">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb85-35" data-line-number="35">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb85-36" data-line-number="36">  )</a>
<a class="sourceLine" id="cb85-37" data-line-number="37"></a>
<a class="sourceLine" id="cb85-38" data-line-number="38">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb85-39" data-line-number="39">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb85-40" data-line-number="40">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb85-41" data-line-number="41">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb85-42" data-line-number="42">    <span class="dt">site_covs =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb85-43" data-line-number="43">      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</a>
<a class="sourceLine" id="cb85-44" data-line-number="44">      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span></a>
<a class="sourceLine" id="cb85-45" data-line-number="45">    ),</a>
<a class="sourceLine" id="cb85-46" data-line-number="46">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb85-47" data-line-number="47">  )</a>
<a class="sourceLine" id="cb85-48" data-line-number="48"></a>
<a class="sourceLine" id="cb85-49" data-line-number="49">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb85-50" data-line-number="50">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb85-51" data-line-number="51"></a>
<a class="sourceLine" id="cb85-52" data-line-number="52">  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb85-53" data-line-number="53"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb85-54" data-line-number="54"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb85-55" data-line-number="55"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb85-56" data-line-number="56"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb85-57" data-line-number="57"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="dv">01</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">02</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">05</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb85-58" data-line-number="58"><span class="st">    </span>lc_<span class="dv">04</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">09</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">07</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">03</span> <span class="op">+</span><span class="st"> </span>bio15a <span class="op">+</span><span class="st"> </span>bio4a, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb85-59" data-line-number="59"></a>
<a class="sourceLine" id="cb85-60" data-line-number="60">  <span class="co"># Set up the cluster</span></a>
<a class="sourceLine" id="cb85-61" data-line-number="61">  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></a>
<a class="sourceLine" id="cb85-62" data-line-number="62">  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</a>
<a class="sourceLine" id="cb85-63" data-line-number="63"></a>
<a class="sourceLine" id="cb85-64" data-line-number="64">  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</a>
<a class="sourceLine" id="cb85-65" data-line-number="65">  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</a>
<a class="sourceLine" id="cb85-66" data-line-number="66"></a>
<a class="sourceLine" id="cb85-67" data-line-number="67">  <span class="co"># Detection terms are fixed</span></a>
<a class="sourceLine" id="cb85-68" data-line-number="68">  det_terms &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb85-69" data-line-number="69">    <span class="st">&quot;p(duration_minutes)&quot;</span>, <span class="st">&quot;p(effort_distance_km)&quot;</span>, <span class="st">&quot;p(expertise)&quot;</span>,</a>
<a class="sourceLine" id="cb85-70" data-line-number="70">    <span class="st">&quot;p(julian_date)&quot;</span>, <span class="st">&quot;p(min_obs_started)&quot;</span>,</a>
<a class="sourceLine" id="cb85-71" data-line-number="71">    <span class="st">&quot;p(number_observers)&quot;</span></a>
<a class="sourceLine" id="cb85-72" data-line-number="72">  )</a>
<a class="sourceLine" id="cb85-73" data-line-number="73"></a>
<a class="sourceLine" id="cb85-74" data-line-number="74">  lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(model_lc_clim, clust, <span class="dt">fixed =</span> det_terms)</a>
<a class="sourceLine" id="cb85-75" data-line-number="75">  <span class="kw">names</span>(lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-76" data-line-number="76"></a>
<a class="sourceLine" id="cb85-77" data-line-number="77">  <span class="co"># Identiying top subset of models based on deltaAIC scores being less than 2 (Burnham et al., 2011)</span></a>
<a class="sourceLine" id="cb85-78" data-line-number="78">  top_lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(lc_clim[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</a>
<a class="sourceLine" id="cb85-79" data-line-number="79"></a>
<a class="sourceLine" id="cb85-80" data-line-number="80">  <span class="kw">names</span>(top_lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-81" data-line-number="81"></a>
<a class="sourceLine" id="cb85-82" data-line-number="82">  <span class="co"># Obtaining model averaged coefficients for both candidate model subsets</span></a>
<a class="sourceLine" id="cb85-83" data-line-number="83">  <span class="cf">if</span> (<span class="kw">length</span>(top_lc_clim[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb85-84" data-line-number="84">    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_lc_clim[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb85-85" data-line-number="85">    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</a>
<a class="sourceLine" id="cb85-86" data-line-number="86">    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-87" data-line-number="87"></a>
<a class="sourceLine" id="cb85-88" data-line-number="88">    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb85-89" data-line-number="89">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb85-90" data-line-number="90">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb85-91" data-line-number="91">      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb85-92" data-line-number="92">      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb85-93" data-line-number="93">      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb85-94" data-line-number="94">      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</a>
<a class="sourceLine" id="cb85-95" data-line-number="95">    )</a>
<a class="sourceLine" id="cb85-96" data-line-number="96"></a>
<a class="sourceLine" id="cb85-97" data-line-number="97">    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-98" data-line-number="98"></a>
<a class="sourceLine" id="cb85-99" data-line-number="99">    lc_clim_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</a>
<a class="sourceLine" id="cb85-100" data-line-number="100">    <span class="kw">names</span>(lc_clim_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-101" data-line-number="101">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb85-102" data-line-number="102">    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_lc_clim[[i]][[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb85-103" data-line-number="103">    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-104" data-line-number="104"></a>
<a class="sourceLine" id="cb85-105" data-line-number="105">    lowSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb85-106" data-line-number="106">    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb85-107" data-line-number="107">    upSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb85-108" data-line-number="108">    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb85-109" data-line-number="109">    zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb85-110" data-line-number="110">    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb85-111" data-line-number="111">    Pr_zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb85-112" data-line-number="112">    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</a>
<a class="sourceLine" id="cb85-113" data-line-number="113"></a>
<a class="sourceLine" id="cb85-114" data-line-number="114">    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb85-115" data-line-number="115">      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb85-116" data-line-number="116">      <span class="dt">SE =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb85-117" data-line-number="117">      <span class="dt">lowerCI =</span> <span class="kw">rbind</span>(lowSt, lowDet),</a>
<a class="sourceLine" id="cb85-118" data-line-number="118">      <span class="dt">upperCI =</span> <span class="kw">rbind</span>(upSt, upDet),</a>
<a class="sourceLine" id="cb85-119" data-line-number="119">      <span class="dt">z_value =</span> <span class="kw">rbind</span>(zSt, zDet),</a>
<a class="sourceLine" id="cb85-120" data-line-number="120">      <span class="dt">Pr_z =</span> <span class="kw">rbind</span>(Pr_zSt, Pr_zDet)</a>
<a class="sourceLine" id="cb85-121" data-line-number="121">    )</a>
<a class="sourceLine" id="cb85-122" data-line-number="122"></a>
<a class="sourceLine" id="cb85-123" data-line-number="123">    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</a>
<a class="sourceLine" id="cb85-124" data-line-number="124">  }</a>
<a class="sourceLine" id="cb85-125" data-line-number="125">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb85-126" data-line-number="126">  <span class="kw">stopCluster</span>(clust)</a>
<a class="sourceLine" id="cb85-127" data-line-number="127">}</a>
<a class="sourceLine" id="cb85-128" data-line-number="128"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb85-129" data-line-number="129"></a>
<a class="sourceLine" id="cb85-130" data-line-number="130"><span class="co"># 1. Store all the model outputs for each species (for both landcover and climate)</span></a>
<a class="sourceLine" id="cb85-131" data-line-number="131"><span class="kw">write.xlsx</span>(lc_clim, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-1.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb85-132" data-line-number="132"></a>
<a class="sourceLine" id="cb85-133" data-line-number="133"><span class="co"># 2. Store all the model averaged outputs for each species and relative importance scores</span></a>
<a class="sourceLine" id="cb85-134" data-line-number="134"><span class="kw">write.xlsx</span>(lc_clim_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-avg-1.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb85-135" data-line-number="135"><span class="kw">write.xlsx</span>(lc_clim_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-imp-1.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb85-136" data-line-number="136"></a>
<a class="sourceLine" id="cb85-137" data-line-number="137"><span class="co"># 3. Store all model estimates</span></a>
<a class="sourceLine" id="cb85-138" data-line-number="138"><span class="kw">write.xlsx</span>(lc_clim_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-modelEst-1.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</a>
<a class="sourceLine" id="cb85-139" data-line-number="139"></a>
<a class="sourceLine" id="cb85-140" data-line-number="140"><span class="co"># Note if you are unable to write to a file, use (for example)</span></a>
<a class="sourceLine" id="cb85-141" data-line-number="141">a &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(lc_clim_modelEst, <span class="op">~</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">compact</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(.) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="goodness-of-fit-tests" class="section level2">
<h2><span class="header-section-number">8.5</span> Goodness-of-fit tests</h2>
<p>Adequate model fit was assessed using a chi-square goodness-of-fit test using 5000 parametric bootstrap simulations on a global model that included all occupancy and detection covariates (MacKenzie &amp; Bailey, 2004).</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">goodness_of_fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"></a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="co"># Add a progress bar for the loop</span></a>
<a class="sourceLine" id="cb86-4" data-line-number="4">pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></a>
<a class="sourceLine" id="cb86-5" data-line-number="5"></a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</a>
<a class="sourceLine" id="cb86-7" data-line-number="7">  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</a>
<a class="sourceLine" id="cb86-8" data-line-number="8"></a>
<a class="sourceLine" id="cb86-9" data-line-number="9">  <span class="co"># Preparing data for the unmarked model</span></a>
<a class="sourceLine" id="cb86-10" data-line-number="10">  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</a>
<a class="sourceLine" id="cb86-11" data-line-number="11">    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb86-12" data-line-number="12">    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb86-13" data-line-number="13">    <span class="dt">n_days =</span> <span class="dv">1302</span>, <span class="co"># 6 years is considered a period of closure</span></a>
<a class="sourceLine" id="cb86-14" data-line-number="14">    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</a>
<a class="sourceLine" id="cb86-15" data-line-number="15">    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</a>
<a class="sourceLine" id="cb86-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb86-17" data-line-number="17"></a>
<a class="sourceLine" id="cb86-18" data-line-number="18">  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb86-19" data-line-number="19">    <span class="st">&quot;min_obs_started&quot;</span>,</a>
<a class="sourceLine" id="cb86-20" data-line-number="20">    <span class="st">&quot;duration_minutes&quot;</span>,</a>
<a class="sourceLine" id="cb86-21" data-line-number="21">    <span class="st">&quot;effort_distance_km&quot;</span>,</a>
<a class="sourceLine" id="cb86-22" data-line-number="22">    <span class="st">&quot;number_observers&quot;</span>,</a>
<a class="sourceLine" id="cb86-23" data-line-number="23">    <span class="st">&quot;protocol_type&quot;</span>,</a>
<a class="sourceLine" id="cb86-24" data-line-number="24">    <span class="st">&quot;expertise&quot;</span>,</a>
<a class="sourceLine" id="cb86-25" data-line-number="25">    <span class="st">&quot;julian_date&quot;</span></a>
<a class="sourceLine" id="cb86-26" data-line-number="26">  )</a>
<a class="sourceLine" id="cb86-27" data-line-number="27"></a>
<a class="sourceLine" id="cb86-28" data-line-number="28">  <span class="co"># format for unmarked</span></a>
<a class="sourceLine" id="cb86-29" data-line-number="29">  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</a>
<a class="sourceLine" id="cb86-30" data-line-number="30">    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</a>
<a class="sourceLine" id="cb86-31" data-line-number="31">    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</a>
<a class="sourceLine" id="cb86-32" data-line-number="32">    <span class="dt">site_covs =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb86-33" data-line-number="33">      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01&quot;</span>, <span class="st">&quot;lc_02&quot;</span>, <span class="st">&quot;lc_05&quot;</span>,</a>
<a class="sourceLine" id="cb86-34" data-line-number="34">      <span class="st">&quot;lc_04&quot;</span>, <span class="st">&quot;lc_09&quot;</span>, <span class="st">&quot;lc_07&quot;</span>, <span class="st">&quot;lc_03&quot;</span>, <span class="st">&quot;bio15a&quot;</span>, <span class="st">&quot;bio4a&quot;</span></a>
<a class="sourceLine" id="cb86-35" data-line-number="35">    ),</a>
<a class="sourceLine" id="cb86-36" data-line-number="36">    <span class="dt">obs_covs =</span> obs_covs</a>
<a class="sourceLine" id="cb86-37" data-line-number="37">  )</a>
<a class="sourceLine" id="cb86-38" data-line-number="38"></a>
<a class="sourceLine" id="cb86-39" data-line-number="39">  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></a>
<a class="sourceLine" id="cb86-40" data-line-number="40">  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</a>
<a class="sourceLine" id="cb86-41" data-line-number="41"></a>
<a class="sourceLine" id="cb86-42" data-line-number="42">  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></a>
<a class="sourceLine" id="cb86-43" data-line-number="43"><span class="st">    </span>julian_date <span class="op">+</span></a>
<a class="sourceLine" id="cb86-44" data-line-number="44"><span class="st">    </span>duration_minutes <span class="op">+</span></a>
<a class="sourceLine" id="cb86-45" data-line-number="45"><span class="st">    </span>effort_distance_km <span class="op">+</span></a>
<a class="sourceLine" id="cb86-46" data-line-number="46"><span class="st">    </span>number_observers <span class="op">+</span></a>
<a class="sourceLine" id="cb86-47" data-line-number="47"><span class="st">    </span>protocol_type <span class="op">+</span></a>
<a class="sourceLine" id="cb86-48" data-line-number="48"><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="dv">01</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">02</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">05</span> <span class="op">+</span></a>
<a class="sourceLine" id="cb86-49" data-line-number="49"><span class="st">    </span>lc_<span class="dv">04</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">09</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">07</span> <span class="op">+</span><span class="st"> </span>lc_<span class="dv">03</span> <span class="op">+</span><span class="st"> </span>bio15a <span class="op">+</span><span class="st"> </span>bio4a, <span class="dt">data =</span> occ_um)</a>
<a class="sourceLine" id="cb86-50" data-line-number="50"></a>
<a class="sourceLine" id="cb86-51" data-line-number="51">  occ_gof &lt;-<span class="st"> </span><span class="kw">mb.gof.test</span>(model_lc_clim, <span class="dt">nsim =</span> <span class="dv">5000</span>, <span class="dt">plot.hist =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb86-52" data-line-number="52"></a>
<a class="sourceLine" id="cb86-53" data-line-number="53">  p.value &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb86-54" data-line-number="54">  c.hat &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>c.hat.est</a>
<a class="sourceLine" id="cb86-55" data-line-number="55">  scientific_name &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>scientific_name)</a>
<a class="sourceLine" id="cb86-56" data-line-number="56"></a>
<a class="sourceLine" id="cb86-57" data-line-number="57">  a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(scientific_name, p.value, c.hat)</a>
<a class="sourceLine" id="cb86-58" data-line-number="58"></a>
<a class="sourceLine" id="cb86-59" data-line-number="59">  goodness_of_fit &lt;-<span class="st"> </span><span class="kw">rbind</span>(a, goodness_of_fit)</a>
<a class="sourceLine" id="cb86-60" data-line-number="60"></a>
<a class="sourceLine" id="cb86-61" data-line-number="61">  <span class="kw">setTxtProgressBar</span>(pb, i)</a>
<a class="sourceLine" id="cb86-62" data-line-number="62">}</a>
<a class="sourceLine" id="cb86-63" data-line-number="63"><span class="kw">close</span>(pb)</a>
<a class="sourceLine" id="cb86-64" data-line-number="64"></a>
<a class="sourceLine" id="cb86-65" data-line-number="65"><span class="kw">write.csv</span>(goodness_of_fit, <span class="st">&quot;data/results/05_goodness-of-fit-2.5km.csv&quot;</span>)</a></code></pre></div>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-MuMIn">
<p>Barto, Kamil. 2020. <em>MuMIn: Multi-Model Inference</em>. Manual.</p>
</div>
<div id="ref-burnham2002a">
<p>Burnham, Kenneth P., and David R. Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. Second. New York: Springer-Verlag. <a href="https://doi.org/10.1007/b97636" class="uri">https://doi.org/10.1007/b97636</a>.</p>
</div>
<div id="ref-burnham2011">
<p>Burnham, Kenneth P., David R. Anderson, and Kathryn P. Huyvaert. 2011. AIC Model Selection and Multimodel Inference in Behavioral Ecology: Some Background, Observations, and Comparisons. <em>Behavioral Ecology and Sociobiology</em> 65 (1): 2335. <a href="https://doi.org/10.1007/s00265-010-1029-6" class="uri">https://doi.org/10.1007/s00265-010-1029-6</a>.</p>
</div>
<div id="ref-elsen2017">
<p>Elsen, Paul R., Morgan W. Tingley, Ramnarayan Kalyanaraman, Krishnamurthy Ramesh, and David S. Wilcove. 2017. The Role of Competition, Ecotones, and Temperature in the Elevational Distribution of Himalayan Birds. <em>Ecology</em> 98 (2): 33748. <a href="https://doi.org/10.1002/ecy.1669" class="uri">https://doi.org/10.1002/ecy.1669</a>.</p>
</div>
<div id="ref-fiske2011">
<p>Fiske, Ian, and Richard Chandler. 2011. <strong>Unmarked</strong> : An <em>R</em> Package for Fitting Hierarchical Models of Wildlife Occurrence and Abundance. <em>Journal of Statistical Software</em> 43 (10). <a href="https://doi.org/10.18637/jss.v043.i10" class="uri">https://doi.org/10.18637/jss.v043.i10</a>.</p>
</div>
<div id="ref-johnston2019a">
<p>Johnston, A, Wm Hochachka, Me Strimas-Mackey, V Ruiz Gutierrez, Oj Robinson, Et Miller, T Auer, St Kelling, and D Fink. 2019. Analytical Guidelines to Increase the Value of Citizen Science Data: Using eBird Data to Estimate Species Occurrence. Preprint. Ecology. <a href="https://doi.org/10.1101/574392" class="uri">https://doi.org/10.1101/574392</a>.</p>
</div>
<div id="ref-johnston2018">
<p>Johnston, Alison, Daniel Fink, Wesley M. Hochachka, and Steve Kelling. 2018. Estimates of Observer Expertise Improve Species Distributions from Citizen Science Data. Edited by Nick Isaac. <em>Methods in Ecology and Evolution</em> 9 (1): 8897. <a href="https://doi.org/10.1111/2041-210X.12838" class="uri">https://doi.org/10.1111/2041-210X.12838</a>.</p>
</div>
<div id="ref-mackenzie2002">
<p>MacKenzie, Darryl I., James D. Nichols, Gideon B. Lachman, Sam Droege, J. Andrew Royle, and Catherine A. Langtimm. 2002. Estimating Site Occupancy Rates When Detection Probabilities Are Less Than One. <em>Ecology</em> 83 (8): 224855. <a href="https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2" class="uri">https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-covariates-to-checklist-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-occupancy-predictor-effects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/08_occupancy-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
