<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</title>
  <meta name="description" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pratikunterwegs/eBirdOccupancy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Modelling Species Occupancy | Source code for Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Morgan W. Tingley" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Ruth DeFries" />


<meta name="date" content="2021-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adding-covariates-to-checklist-data.html"/>
<link rel="next" href="visualizing-occupancy-predictor-effects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#main-text-figure-1"><i class="fa fa-check"></i><b>1.4</b> Main Text Figure 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html"><i class="fa fa-check"></i><b>2</b> Preparing eBird Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#prepare-libraries-and-data-sources"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries and data sources</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#filter-data"><i class="fa fa-check"></i><b>2.2</b> Filter data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#process-filtered-data"><i class="fa fa-check"></i><b>2.3</b> Process filtered data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#spatial-filter"><i class="fa fa-check"></i><b>2.4</b> Spatial filter</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#handle-presence-data"><i class="fa fa-check"></i><b>2.5</b> Handle presence data</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-ebird-data.html"><a href="preparing-ebird-data.html#add-decimal-time"><i class="fa fa-check"></i><b>2.6</b> Add decimal time</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html"><i class="fa fa-check"></i><b>3</b> Preparing Environmental Predictors</a>
<ul>
<li class="chapter" data-level="3.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-spatial-extent"><i class="fa fa-check"></i><b>3.2</b> Prepare spatial extent</a></li>
<li class="chapter" data-level="3.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-terrain-rasters"><i class="fa fa-check"></i><b>3.3</b> Prepare terrain rasters</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-bioclim-15"><i class="fa fa-check"></i><b>3.4</b> Prepare Bioclim 4a and Bioclim 15</a></li>
<li class="chapter" data-level="3.5" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-chelsa-rasters"><i class="fa fa-check"></i><b>3.5</b> Prepare CHELSA rasters</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a-and-15"><i class="fa fa-check"></i><b>3.5.1</b> Prepare BIOCLIM 4a and 15</a></li>
<li class="chapter" data-level="3.5.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-4a"><i class="fa fa-check"></i><b>3.5.2</b> Prepare BIOCLIM 4a</a></li>
<li class="chapter" data-level="3.5.3" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#prepare-bioclim-15"><i class="fa fa-check"></i><b>3.5.3</b> Prepare Bioclim 15</a></li>
<li class="chapter" data-level="3.5.4" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#stack-terrain-and-climate"><i class="fa fa-check"></i><b>3.5.4</b> Stack terrain and climate</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-landcover-from-10m-to-1km"><i class="fa fa-check"></i><b>3.6</b> Resample landcover from 10m to 1km</a></li>
<li class="chapter" data-level="3.7" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#resample-other-rasters-to-1km"><i class="fa fa-check"></i><b>3.7</b> Resample other rasters to 1km</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#read-in-resampled-landcover"><i class="fa fa-check"></i><b>3.7.1</b> Read in resampled landcover</a></li>
<li class="chapter" data-level="3.7.2" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#reproject-environmental-data-using-landcover-as-a-template"><i class="fa fa-check"></i><b>3.7.2</b> Reproject environmental data using landcover as a template</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#temperature-and-rainfall-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.8</b> Temperature and rainfall in relation to elevation</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#load-resampled-environmental-rasters"><i class="fa fa-check"></i><b>3.8.1</b> Load resampled environmental rasters</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#land-cover-type-in-relation-to-elevation"><i class="fa fa-check"></i><b>3.9</b> Land cover type in relation to elevation</a></li>
<li class="chapter" data-level="3.10" data-path="preparing-environmental-predictors.html"><a href="preparing-environmental-predictors.html#main-text-figure-2"><i class="fa fa-check"></i><b>3.10</b> Main Text Figure 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html"><i class="fa fa-check"></i><b>4</b> Preparing Observer Expertise Scores</a>
<ul>
<li class="chapter" data-level="4.1" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="4.2" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-data"><i class="fa fa-check"></i><b>4.2</b> Prepare data</a></li>
<li class="chapter" data-level="4.3" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#spatially-explicit-filter-on-checklists"><i class="fa fa-check"></i><b>4.3</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="4.4" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-species-of-interest"><i class="fa fa-check"></i><b>4.4</b> Prepare species of interest</a></li>
<li class="chapter" data-level="4.5" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#prepare-checklists-for-observer-score"><i class="fa fa-check"></i><b>4.5</b> Prepare checklists for observer score</a></li>
<li class="chapter" data-level="4.6" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#get-landcover"><i class="fa fa-check"></i><b>4.6</b> Get landcover</a></li>
<li class="chapter" data-level="4.7" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#filter-checklist-data"><i class="fa fa-check"></i><b>4.7</b> Filter checklist data</a></li>
<li class="chapter" data-level="4.8" data-path="preparing-observer-expertise-scores.html"><a href="preparing-observer-expertise-scores.html#model-observer-expertise"><i class="fa fa-check"></i><b>4.8</b> Model observer expertise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html"><i class="fa fa-check"></i><b>5</b> Examining Spatial Sampling Bias</a>
<ul>
<li class="chapter" data-level="5.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-libraries-2"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#read-checklist-data"><i class="fa fa-check"></i><b>5.2</b> Read checklist data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatially-explicit-filter-on-checklists-1"><i class="fa fa-check"></i><b>5.2.1</b> Spatially explicit filter on checklists</a></li>
<li class="chapter" data-level="5.2.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#get-background-land-for-plotting"><i class="fa fa-check"></i><b>5.2.2</b> Get background land for plotting</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-main-text-figure-3"><i class="fa fa-check"></i><b>5.3</b> Prepare Main Text Figure 3</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#prepare-histogram-of-distance-to-roads"><i class="fa fa-check"></i><b>5.3.1</b> Prepare histogram of distance to roads</a></li>
<li class="chapter" data-level="5.3.2" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#table-distance-to-roads"><i class="fa fa-check"></i><b>5.3.2</b> Table: Distance to roads</a></li>
<li class="chapter" data-level="5.3.3" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#distance-to-nearest-neighbouring-site"><i class="fa fa-check"></i><b>5.3.3</b> Distance to nearest neighbouring site</a></li>
<li class="chapter" data-level="5.3.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#spatial-distribution-of-distances-to-neighbours"><i class="fa fa-check"></i><b>5.3.4</b> Spatial distribution of distances to neighbours</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="examining-spatial-sampling-bias.html"><a href="examining-spatial-sampling-bias.html#main-text-figure-3"><i class="fa fa-check"></i><b>5.4</b> Main Text Figure 3</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html"><i class="fa fa-check"></i><b>6</b> Checking Temporal Sampling Frequency</a>
<ul>
<li class="chapter" data-level="6.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-libraries"><i class="fa fa-check"></i><b>6.1</b> Load libraries</a></li>
<li class="chapter" data-level="6.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#load-checklist-data"><i class="fa fa-check"></i><b>6.2</b> Load checklist data</a></li>
<li class="chapter" data-level="6.3" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-time-differences-per-grid-cell"><i class="fa fa-check"></i><b>6.3</b> Get time differences per grid cell</a></li>
<li class="chapter" data-level="6.4" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#time-since-previous-checklist"><i class="fa fa-check"></i><b>6.4</b> Time Since Previous Checklist</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#get-aux-data"><i class="fa fa-check"></i><b>6.4.1</b> Get aux data</a></li>
<li class="chapter" data-level="6.4.2" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#histogram-of-lags"><i class="fa fa-check"></i><b>6.4.2</b> Histogram of lags</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="checking-temporal-sampling-frequency.html"><a href="checking-temporal-sampling-frequency.html#checklists-per-month"><i class="fa fa-check"></i><b>6.5</b> Checklists per Month</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html"><i class="fa fa-check"></i><b>7</b> Adding Covariates to Checklist Data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#prepare-libraries-and-data"><i class="fa fa-check"></i><b>7.1</b> Prepare libraries and data</a></li>
<li class="chapter" data-level="7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-subsampling"><i class="fa fa-check"></i><b>7.2</b> Spatial subsampling</a></li>
<li class="chapter" data-level="7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#temporal-subsampling"><i class="fa fa-check"></i><b>7.3</b> Temporal subsampling</a></li>
<li class="chapter" data-level="7.4" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-checklist-calibration-index"><i class="fa fa-check"></i><b>7.4</b> Add checklist calibration index</a></li>
<li class="chapter" data-level="7.5" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#add-climatic-and-landscape-covariates"><i class="fa fa-check"></i><b>7.5</b> Add climatic and landscape covariates</a></li>
<li class="chapter" data-level="7.6" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffers-around-selected-checklists"><i class="fa fa-check"></i><b>7.6</b> Spatial buffers around selected checklists</a></li>
<li class="chapter" data-level="7.7" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#spatial-buffer-wide-covariates"><i class="fa fa-check"></i><b>7.7</b> Spatial buffer-wide covariates</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#mean-climatic-covariates"><i class="fa fa-check"></i><b>7.7.1</b> Mean climatic covariates</a></li>
<li class="chapter" data-level="7.7.2" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#proportions-of-land-cover-type"><i class="fa fa-check"></i><b>7.7.2</b> Proportions of land cover type</a></li>
<li class="chapter" data-level="7.7.3" data-path="adding-covariates-to-checklist-data.html"><a href="adding-covariates-to-checklist-data.html#link-environmental-covariates-to-checklists"><i class="fa fa-check"></i><b>7.7.3</b> Link environmental covariates to checklists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html"><i class="fa fa-check"></i><b>8</b> Modelling Species Occupancy</a>
<ul>
<li class="chapter" data-level="8.0.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-necessary-libraries"><i class="fa fa-check"></i><b>8.0.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="8.1" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#load-dataframe-and-scale-covariates"><i class="fa fa-check"></i><b>8.1</b> Load dataframe and scale covariates</a></li>
<li class="chapter" data-level="8.2" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#running-a-null-model"><i class="fa fa-check"></i><b>8.2</b> Running a null model</a></li>
<li class="chapter" data-level="8.3" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#identifying-covariates-necessary-to-model-the-detection-process"><i class="fa fa-check"></i><b>8.3</b> Identifying covariates necessary to model the detection process</a></li>
<li class="chapter" data-level="8.4" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#land-cover-and-climate"><i class="fa fa-check"></i><b>8.4</b> Land Cover and Climate</a></li>
<li class="chapter" data-level="8.5" data-path="modelling-species-occupancy.html"><a href="modelling-species-occupancy.html#goodness-of-fit-tests"><i class="fa fa-check"></i><b>8.5</b> Goodness-of-fit tests</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html"><i class="fa fa-check"></i><b>9</b> Visualizing Occupancy Predictor Effects</a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-libraries-3"><i class="fa fa-check"></i><b>9.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="9.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#load-species-list"><i class="fa fa-check"></i><b>9.2</b> Load species list</a></li>
<li class="chapter" data-level="9.3" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#show-aic-weight-importance"><i class="fa fa-check"></i><b>9.3</b> Show AIC weight importance</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#read-in-aic-weight-data"><i class="fa fa-check"></i><b>9.3.1</b> Read in AIC weight data</a></li>
<li class="chapter" data-level="9.3.2" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-cumulative-aic-weight-data"><i class="fa fa-check"></i><b>9.3.2</b> Prepare cumulative AIC weight data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#prepare-model-coefficient-data"><i class="fa fa-check"></i><b>9.4</b> Prepare model coefficient data</a></li>
<li class="chapter" data-level="9.5" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#get-predictor-effects"><i class="fa fa-check"></i><b>9.5</b> Get predictor effects</a></li>
<li class="chapter" data-level="9.6" data-path="visualizing-occupancy-predictor-effects.html"><a href="visualizing-occupancy-predictor-effects.html#main-text-figure-4"><i class="fa fa-check"></i><b>9.6</b> Main Text Figure 4</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code for <em>Using citizen science to parse climatic and landcover influences on bird occupancy within a tropical biodiversity hotspot</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelling-species-occupancy" class="section level1">
<h1><span class="header-section-number">Section 8</span> Modelling Species Occupancy</h1>
<div id="load-necessary-libraries" class="section level3">
<h3><span class="header-section-number">8.0.1</span> Load necessary libraries</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="modelling-species-occupancy.html#cb71-1"></a><span class="co"># Load libraries</span></span>
<span id="cb71-2"><a href="modelling-species-occupancy.html#cb71-2"></a><span class="kw">library</span>(auk)</span>
<span id="cb71-3"><a href="modelling-species-occupancy.html#cb71-3"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb71-4"><a href="modelling-species-occupancy.html#cb71-4"></a><span class="kw">library</span>(sf)</span>
<span id="cb71-5"><a href="modelling-species-occupancy.html#cb71-5"></a><span class="kw">library</span>(unmarked)</span>
<span id="cb71-6"><a href="modelling-species-occupancy.html#cb71-6"></a><span class="kw">library</span>(raster)</span>
<span id="cb71-7"><a href="modelling-species-occupancy.html#cb71-7"></a><span class="kw">library</span>(ebirdst)</span>
<span id="cb71-8"><a href="modelling-species-occupancy.html#cb71-8"></a><span class="kw">library</span>(MuMIn)</span>
<span id="cb71-9"><a href="modelling-species-occupancy.html#cb71-9"></a><span class="kw">library</span>(AICcmodavg)</span>
<span id="cb71-10"><a href="modelling-species-occupancy.html#cb71-10"></a><span class="kw">library</span>(fields)</span>
<span id="cb71-11"><a href="modelling-species-occupancy.html#cb71-11"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb71-12"><a href="modelling-species-occupancy.html#cb71-12"></a><span class="kw">library</span>(doParallel)</span>
<span id="cb71-13"><a href="modelling-species-occupancy.html#cb71-13"></a><span class="kw">library</span>(snow)</span>
<span id="cb71-14"><a href="modelling-species-occupancy.html#cb71-14"></a><span class="kw">library</span>(openxlsx)</span>
<span id="cb71-15"><a href="modelling-species-occupancy.html#cb71-15"></a><span class="kw">library</span>(data.table)</span>
<span id="cb71-16"><a href="modelling-species-occupancy.html#cb71-16"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb71-17"><a href="modelling-species-occupancy.html#cb71-17"></a><span class="kw">library</span>(ecodist)</span>
<span id="cb71-18"><a href="modelling-species-occupancy.html#cb71-18"></a></span>
<span id="cb71-19"><a href="modelling-species-occupancy.html#cb71-19"></a><span class="co"># Source necessary functions</span></span>
<span id="cb71-20"><a href="modelling-species-occupancy.html#cb71-20"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</span>
<span id="cb71-21"><a href="modelling-species-occupancy.html#cb71-21"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_model_estimate_collection.r&quot;</span>)</span></code></pre></div>
</div>
<div id="load-dataframe-and-scale-covariates" class="section level2">
<h2><span class="header-section-number">8.1</span> Load dataframe and scale covariates</h2>
<p>Here, we load the required dataframe that contains 10 random visits to a site and environmental covariates that were prepared at a spatial scale of 2.5 sq.km. We also scaled all covariates (mean around 0 and standard deviation of 1). Next, we ensured that only Traveling and Stationary checklists were considered. Even though stationary counts have no distance traveled, we defaulted all stationary accounts to an effective distance of 100m, which we consider the average maximum detection radius for most bird species in our area. Following this, we excluded predictors with a Pearson coefficient <span class="math inline">\(&gt;\)</span> 0.5.</p>
<p>Please note that species-specific plots of probabilities of occupancy as a function of environmental data can be accessed in Section 10 of the Supplementary Material.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="modelling-species-occupancy.html#cb72-1"></a><span class="co"># Load in the prepared dataframe that contains 10 random visits to each site</span></span>
<span id="cb72-2"><a href="modelling-species-occupancy.html#cb72-2"></a>dat &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/04_data-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb72-3"><a href="modelling-species-occupancy.html#cb72-3"></a><span class="kw">setDF</span>(dat)</span>
<span id="cb72-4"><a href="modelling-species-occupancy.html#cb72-4"></a><span class="kw">head</span>(dat)</span>
<span id="cb72-5"><a href="modelling-species-occupancy.html#cb72-5"></a></span>
<span id="cb72-6"><a href="modelling-species-occupancy.html#cb72-6"></a><span class="co"># Some more pre-processing to get the right data structures</span></span>
<span id="cb72-7"><a href="modelling-species-occupancy.html#cb72-7"></a></span>
<span id="cb72-8"><a href="modelling-species-occupancy.html#cb72-8"></a><span class="co"># Ensuring that only Traveling and Stationary checklists were considered</span></span>
<span id="cb72-9"><a href="modelling-species-occupancy.html#cb72-9"></a><span class="kw">names</span>(dat)</span>
<span id="cb72-10"><a href="modelling-species-occupancy.html#cb72-10"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(protocol_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Traveling&quot;</span>, <span class="st">&quot;Stationary&quot;</span>))</span>
<span id="cb72-11"><a href="modelling-species-occupancy.html#cb72-11"></a></span>
<span id="cb72-12"><a href="modelling-species-occupancy.html#cb72-12"></a><span class="co"># We take all stationary counts and give them a distance of 100 m (so 0.1 km),</span></span>
<span id="cb72-13"><a href="modelling-species-occupancy.html#cb72-13"></a><span class="co"># as that&#39;s approximately the max normal hearing distance for people doing point</span></span>
<span id="cb72-14"><a href="modelling-species-occupancy.html#cb72-14"></a><span class="co"># counts.</span></span>
<span id="cb72-15"><a href="modelling-species-occupancy.html#cb72-15"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-16"><a href="modelling-species-occupancy.html#cb72-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">effort_distance_km =</span> <span class="kw">replace</span>(</span>
<span id="cb72-17"><a href="modelling-species-occupancy.html#cb72-17"></a>    effort_distance_km,</span>
<span id="cb72-18"><a href="modelling-species-occupancy.html#cb72-18"></a>    <span class="kw">which</span>(effort_distance_km <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span></span>
<span id="cb72-19"><a href="modelling-species-occupancy.html#cb72-19"></a><span class="st">      </span>protocol_type <span class="op">==</span><span class="st"> &quot;Stationary&quot;</span>),</span>
<span id="cb72-20"><a href="modelling-species-occupancy.html#cb72-20"></a>    <span class="fl">0.1</span></span>
<span id="cb72-21"><a href="modelling-species-occupancy.html#cb72-21"></a>  ))</span>
<span id="cb72-22"><a href="modelling-species-occupancy.html#cb72-22"></a></span>
<span id="cb72-23"><a href="modelling-species-occupancy.html#cb72-23"></a><span class="co"># Converting time observations started to numeric and adding it as a new column</span></span>
<span id="cb72-24"><a href="modelling-species-occupancy.html#cb72-24"></a><span class="co"># This new column will be minute_observations_started</span></span>
<span id="cb72-25"><a href="modelling-species-occupancy.html#cb72-25"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-26"><a href="modelling-species-occupancy.html#cb72-26"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb72-27"><a href="modelling-species-occupancy.html#cb72-27"></a>    <span class="dt">min_obs_started =</span> <span class="kw">strtoi</span>(</span>
<span id="cb72-28"><a href="modelling-species-occupancy.html#cb72-28"></a>      <span class="kw">as.difftime</span>(</span>
<span id="cb72-29"><a href="modelling-species-occupancy.html#cb72-29"></a>        time_observations_started,</span>
<span id="cb72-30"><a href="modelling-species-occupancy.html#cb72-30"></a>        <span class="dt">format =</span> <span class="st">&quot;%H:%M:%S&quot;</span>, <span class="dt">units =</span> <span class="st">&quot;mins&quot;</span></span>
<span id="cb72-31"><a href="modelling-species-occupancy.html#cb72-31"></a>      )</span>
<span id="cb72-32"><a href="modelling-species-occupancy.html#cb72-32"></a>    )</span>
<span id="cb72-33"><a href="modelling-species-occupancy.html#cb72-33"></a>  )</span>
<span id="cb72-34"><a href="modelling-species-occupancy.html#cb72-34"></a></span>
<span id="cb72-35"><a href="modelling-species-occupancy.html#cb72-35"></a><span class="co"># Adding the julian date to the dataframe</span></span>
<span id="cb72-36"><a href="modelling-species-occupancy.html#cb72-36"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-37"><a href="modelling-species-occupancy.html#cb72-37"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">julian_date =</span> lubridate<span class="op">::</span><span class="kw">yday</span>(dat<span class="op">$</span>observation_date))</span>
<span id="cb72-38"><a href="modelling-species-occupancy.html#cb72-38"></a></span>
<span id="cb72-39"><a href="modelling-species-occupancy.html#cb72-39"></a><span class="co"># recode julian date to model it as a linear predictor</span></span>
<span id="cb72-40"><a href="modelling-species-occupancy.html#cb72-40"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-41"><a href="modelling-species-occupancy.html#cb72-41"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb72-42"><a href="modelling-species-occupancy.html#cb72-42"></a>    <span class="dt">newjulianDate =</span></span>
<span id="cb72-43"><a href="modelling-species-occupancy.html#cb72-43"></a>      <span class="kw">case_when</span>(</span>
<span id="cb72-44"><a href="modelling-species-occupancy.html#cb72-44"></a>        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">334</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">365</span> <span class="op">~</span></span>
<span id="cb72-45"><a href="modelling-species-occupancy.html#cb72-45"></a><span class="st">        </span>(julian_date <span class="op">-</span><span class="st"> </span><span class="dv">333</span>),</span>
<span id="cb72-46"><a href="modelling-species-occupancy.html#cb72-46"></a>        (julian_date <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>julian_date) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">152</span> <span class="op">~</span></span>
<span id="cb72-47"><a href="modelling-species-occupancy.html#cb72-47"></a><span class="st">        </span>(julian_date <span class="op">+</span><span class="st"> </span><span class="dv">31</span>)</span>
<span id="cb72-48"><a href="modelling-species-occupancy.html#cb72-48"></a>      )</span>
<span id="cb72-49"><a href="modelling-species-occupancy.html#cb72-49"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb72-50"><a href="modelling-species-occupancy.html#cb72-50"></a><span class="st">  </span><span class="kw">drop_na</span>(newjulianDate)</span>
<span id="cb72-51"><a href="modelling-species-occupancy.html#cb72-51"></a></span>
<span id="cb72-52"><a href="modelling-species-occupancy.html#cb72-52"></a><span class="co"># recode time observations started to model it as a linear predictor</span></span>
<span id="cb72-53"><a href="modelling-species-occupancy.html#cb72-53"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-54"><a href="modelling-species-occupancy.html#cb72-54"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb72-55"><a href="modelling-species-occupancy.html#cb72-55"></a>    <span class="dt">newmin_obs_started =</span> <span class="kw">case_when</span>(</span>
<span id="cb72-56"><a href="modelling-species-occupancy.html#cb72-56"></a>      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">300</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">~</span></span>
<span id="cb72-57"><a href="modelling-species-occupancy.html#cb72-57"></a><span class="st">      </span><span class="kw">abs</span>(min_obs_started <span class="op">-</span><span class="st"> </span><span class="dv">720</span>),</span>
<span id="cb72-58"><a href="modelling-species-occupancy.html#cb72-58"></a>      min_obs_started <span class="op">&gt;=</span><span class="st"> </span><span class="dv">720</span> <span class="op">&amp;</span><span class="st"> </span>min_obs_started <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1140</span> <span class="op">~</span></span>
<span id="cb72-59"><a href="modelling-species-occupancy.html#cb72-59"></a><span class="st">      </span><span class="kw">abs</span>(<span class="dv">720</span> <span class="op">-</span><span class="st"> </span>min_obs_started)</span>
<span id="cb72-60"><a href="modelling-species-occupancy.html#cb72-60"></a>    )</span>
<span id="cb72-61"><a href="modelling-species-occupancy.html#cb72-61"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb72-62"><a href="modelling-species-occupancy.html#cb72-62"></a><span class="st">  </span><span class="kw">drop_na</span>(newmin_obs_started)</span>
<span id="cb72-63"><a href="modelling-species-occupancy.html#cb72-63"></a></span>
<span id="cb72-64"><a href="modelling-species-occupancy.html#cb72-64"></a><span class="co"># Removing other unnecessary columns from the dataframe and creating a clean one without the rest</span></span>
<span id="cb72-65"><a href="modelling-species-occupancy.html#cb72-65"></a><span class="kw">names</span>(dat)</span>
<span id="cb72-66"><a href="modelling-species-occupancy.html#cb72-66"></a>dat &lt;-<span class="st"> </span>dat[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">36</span>, <span class="dv">37</span>)]</span>
<span id="cb72-67"><a href="modelling-species-occupancy.html#cb72-67"></a></span>
<span id="cb72-68"><a href="modelling-species-occupancy.html#cb72-68"></a><span class="co"># Rename column names:</span></span>
<span id="cb72-69"><a href="modelling-species-occupancy.html#cb72-69"></a><span class="kw">names</span>(dat) &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb72-70"><a href="modelling-species-occupancy.html#cb72-70"></a>  <span class="st">&quot;duration_minutes&quot;</span>, <span class="st">&quot;effort_distance_km&quot;</span>, <span class="st">&quot;locality&quot;</span>,</span>
<span id="cb72-71"><a href="modelling-species-occupancy.html#cb72-71"></a>  <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;observer_id&quot;</span>,</span>
<span id="cb72-72"><a href="modelling-species-occupancy.html#cb72-72"></a>  <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>,</span>
<span id="cb72-73"><a href="modelling-species-occupancy.html#cb72-73"></a>  <span class="st">&quot;protocol_type&quot;</span>, <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;pres_abs&quot;</span>, <span class="st">&quot;tot_effort&quot;</span>,</span>
<span id="cb72-74"><a href="modelling-species-occupancy.html#cb72-74"></a>  <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;expertise&quot;</span>, <span class="st">&quot;elev&quot;</span>, <span class="st">&quot;bio15a.y&quot;</span>, <span class="st">&quot;bio4a.y&quot;</span>,</span>
<span id="cb72-75"><a href="modelling-species-occupancy.html#cb72-75"></a>  <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>, <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_09.y&quot;</span>,</span>
<span id="cb72-76"><a href="modelling-species-occupancy.html#cb72-76"></a>  <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_03.y&quot;</span>, <span class="st">&quot;julian_date&quot;</span>, <span class="st">&quot;min_obs_started&quot;</span></span>
<span id="cb72-77"><a href="modelling-species-occupancy.html#cb72-77"></a>)</span>
<span id="cb72-78"><a href="modelling-species-occupancy.html#cb72-78"></a></span>
<span id="cb72-79"><a href="modelling-species-occupancy.html#cb72-79"></a>dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></span>
<span id="cb72-80"><a href="modelling-species-occupancy.html#cb72-80"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb72-81"><a href="modelling-species-occupancy.html#cb72-81"></a>    <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</span>
<span id="cb72-82"><a href="modelling-species-occupancy.html#cb72-82"></a>    <span class="dt">pres_abs =</span> <span class="kw">as.integer</span>(pres_abs)</span>
<span id="cb72-83"><a href="modelling-species-occupancy.html#cb72-83"></a>  ) <span class="co"># occupancy modeling requires an integer response</span></span>
<span id="cb72-84"><a href="modelling-species-occupancy.html#cb72-84"></a></span>
<span id="cb72-85"><a href="modelling-species-occupancy.html#cb72-85"></a><span class="co"># Scaling detection and occupancy covariates</span></span>
<span id="cb72-86"><a href="modelling-species-occupancy.html#cb72-86"></a>dat.scaled &lt;-<span class="st"> </span>dat<span class="fl">.1</span></span>
<span id="cb72-87"><a href="modelling-species-occupancy.html#cb72-87"></a>dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">28</span>)] &lt;-<span class="st"> </span><span class="kw">scale</span>(dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">28</span>)]) <span class="co"># Scaling and standardizing detection and site-level covariates</span></span>
<span id="cb72-88"><a href="modelling-species-occupancy.html#cb72-88"></a><span class="kw">fwrite</span>(dat.scaled, <span class="dt">file =</span> <span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>)</span>
<span id="cb72-89"><a href="modelling-species-occupancy.html#cb72-89"></a></span>
<span id="cb72-90"><a href="modelling-species-occupancy.html#cb72-90"></a><span class="co"># Reload the scaled covariate data</span></span>
<span id="cb72-91"><a href="modelling-species-occupancy.html#cb72-91"></a>dat.scaled &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/05_scaled-covars-2.5km.csv&quot;</span>, <span class="dt">header =</span> T)</span>
<span id="cb72-92"><a href="modelling-species-occupancy.html#cb72-92"></a><span class="kw">setDF</span>(dat.scaled)</span>
<span id="cb72-93"><a href="modelling-species-occupancy.html#cb72-93"></a><span class="kw">head</span>(dat.scaled)</span>
<span id="cb72-94"><a href="modelling-species-occupancy.html#cb72-94"></a></span>
<span id="cb72-95"><a href="modelling-species-occupancy.html#cb72-95"></a><span class="co"># Ensure observation_date column is in the right format</span></span>
<span id="cb72-96"><a href="modelling-species-occupancy.html#cb72-96"></a>dat.scaled<span class="op">$</span>observation_date &lt;-<span class="st"> </span><span class="kw">format</span>(</span>
<span id="cb72-97"><a href="modelling-species-occupancy.html#cb72-97"></a>  <span class="kw">as.Date</span>(</span>
<span id="cb72-98"><a href="modelling-species-occupancy.html#cb72-98"></a>    dat.scaled<span class="op">$</span>observation_date,</span>
<span id="cb72-99"><a href="modelling-species-occupancy.html#cb72-99"></a>    <span class="st">&quot;%m/%d/%Y&quot;</span></span>
<span id="cb72-100"><a href="modelling-species-occupancy.html#cb72-100"></a>  ),</span>
<span id="cb72-101"><a href="modelling-species-occupancy.html#cb72-101"></a>  <span class="st">&quot;%Y-%m-%d&quot;</span></span>
<span id="cb72-102"><a href="modelling-species-occupancy.html#cb72-102"></a>)</span>
<span id="cb72-103"><a href="modelling-species-occupancy.html#cb72-103"></a></span>
<span id="cb72-104"><a href="modelling-species-occupancy.html#cb72-104"></a><span class="co"># Testing for correlations before running further analyses</span></span>
<span id="cb72-105"><a href="modelling-species-occupancy.html#cb72-105"></a><span class="co"># Majority are uncorrelated since we decided to keep climatic and land cover predictors and removed elevation.</span></span>
<span id="cb72-106"><a href="modelling-species-occupancy.html#cb72-106"></a><span class="kw">source</span>(<span class="st">&quot;R/fun_screen_cor.R&quot;</span>)</span>
<span id="cb72-107"><a href="modelling-species-occupancy.html#cb72-107"></a><span class="kw">names</span>(dat.scaled)</span>
<span id="cb72-108"><a href="modelling-species-occupancy.html#cb72-108"></a><span class="kw">screen.cor</span>(dat.scaled[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="dv">16</span><span class="op">:</span><span class="dv">28</span>)], <span class="dt">threshold =</span> <span class="fl">0.3</span>)</span></code></pre></div>
</div>
<div id="running-a-null-model" class="section level2">
<h2><span class="header-section-number">8.2</span> Running a null model</h2>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="modelling-species-occupancy.html#cb73-1"></a><span class="co"># All null models are stored in lists below</span></span>
<span id="cb73-2"><a href="modelling-species-occupancy.html#cb73-2"></a>all_null &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb73-3"><a href="modelling-species-occupancy.html#cb73-3"></a></span>
<span id="cb73-4"><a href="modelling-species-occupancy.html#cb73-4"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb73-5"><a href="modelling-species-occupancy.html#cb73-5"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</span>
<span id="cb73-6"><a href="modelling-species-occupancy.html#cb73-6"></a>  <span class="dt">min =</span> <span class="dv">0</span>,</span>
<span id="cb73-7"><a href="modelling-species-occupancy.html#cb73-7"></a>  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)),</span>
<span id="cb73-8"><a href="modelling-species-occupancy.html#cb73-8"></a>  <span class="dt">style =</span> <span class="dv">3</span></span>
<span id="cb73-9"><a href="modelling-species-occupancy.html#cb73-9"></a>) <span class="co"># text based bar</span></span>
<span id="cb73-10"><a href="modelling-species-occupancy.html#cb73-10"></a></span>
<span id="cb73-11"><a href="modelling-species-occupancy.html#cb73-11"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb73-12"><a href="modelling-species-occupancy.html#cb73-12"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></span>
<span id="cb73-13"><a href="modelling-species-occupancy.html#cb73-13"></a><span class="st">    </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb73-14"><a href="modelling-species-occupancy.html#cb73-14"></a></span>
<span id="cb73-15"><a href="modelling-species-occupancy.html#cb73-15"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb73-16"><a href="modelling-species-occupancy.html#cb73-16"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb73-17"><a href="modelling-species-occupancy.html#cb73-17"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb73-18"><a href="modelling-species-occupancy.html#cb73-18"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb73-19"><a href="modelling-species-occupancy.html#cb73-19"></a>    <span class="dt">n_days =</span> <span class="dv">3000</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb73-20"><a href="modelling-species-occupancy.html#cb73-20"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb73-21"><a href="modelling-species-occupancy.html#cb73-21"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb73-22"><a href="modelling-species-occupancy.html#cb73-22"></a>  )</span>
<span id="cb73-23"><a href="modelling-species-occupancy.html#cb73-23"></a></span>
<span id="cb73-24"><a href="modelling-species-occupancy.html#cb73-24"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb73-25"><a href="modelling-species-occupancy.html#cb73-25"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb73-26"><a href="modelling-species-occupancy.html#cb73-26"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb73-27"><a href="modelling-species-occupancy.html#cb73-27"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb73-28"><a href="modelling-species-occupancy.html#cb73-28"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb73-29"><a href="modelling-species-occupancy.html#cb73-29"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb73-30"><a href="modelling-species-occupancy.html#cb73-30"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb73-31"><a href="modelling-species-occupancy.html#cb73-31"></a>  )</span>
<span id="cb73-32"><a href="modelling-species-occupancy.html#cb73-32"></a></span>
<span id="cb73-33"><a href="modelling-species-occupancy.html#cb73-33"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb73-34"><a href="modelling-species-occupancy.html#cb73-34"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb73-35"><a href="modelling-species-occupancy.html#cb73-35"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb73-36"><a href="modelling-species-occupancy.html#cb73-36"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb73-37"><a href="modelling-species-occupancy.html#cb73-37"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb73-38"><a href="modelling-species-occupancy.html#cb73-38"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>,</span>
<span id="cb73-39"><a href="modelling-species-occupancy.html#cb73-39"></a>      <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_09.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_03.y&quot;</span>, <span class="st">&quot;bio15a.y&quot;</span>, <span class="st">&quot;bio4a.y&quot;</span></span>
<span id="cb73-40"><a href="modelling-species-occupancy.html#cb73-40"></a>    ),</span>
<span id="cb73-41"><a href="modelling-species-occupancy.html#cb73-41"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb73-42"><a href="modelling-species-occupancy.html#cb73-42"></a>  )</span>
<span id="cb73-43"><a href="modelling-species-occupancy.html#cb73-43"></a></span>
<span id="cb73-44"><a href="modelling-species-occupancy.html#cb73-44"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb73-45"><a href="modelling-species-occupancy.html#cb73-45"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb73-46"><a href="modelling-species-occupancy.html#cb73-46"></a></span>
<span id="cb73-47"><a href="modelling-species-occupancy.html#cb73-47"></a>  <span class="co"># Set up the model</span></span>
<span id="cb73-48"><a href="modelling-species-occupancy.html#cb73-48"></a>  all_null[[i]] &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</span>
<span id="cb73-49"><a href="modelling-species-occupancy.html#cb73-49"></a>  <span class="kw">names</span>(all_null)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb73-50"><a href="modelling-species-occupancy.html#cb73-50"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb73-51"><a href="modelling-species-occupancy.html#cb73-51"></a>}</span>
<span id="cb73-52"><a href="modelling-species-occupancy.html#cb73-52"></a><span class="kw">close</span>(pb)</span>
<span id="cb73-53"><a href="modelling-species-occupancy.html#cb73-53"></a></span>
<span id="cb73-54"><a href="modelling-species-occupancy.html#cb73-54"></a><span class="co"># Store all the  model outputs for each species</span></span>
<span id="cb73-55"><a href="modelling-species-occupancy.html#cb73-55"></a><span class="kw">capture.output</span>(all_null, <span class="dt">file =</span> <span class="st">&quot;data/results/null_models.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="identifying-covariates-necessary-to-model-the-detection-process" class="section level2">
<h2><span class="header-section-number">8.3</span> Identifying covariates necessary to model the detection process</h2>
<p>Here, we use the <code>unmarked</code> package in R <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011" role="doc-biblioref">2011</a>)</span> to identify detection level covariates that are important for each species. We use AIC criteria to select top models <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011" role="doc-biblioref">2011</a>)</span>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="modelling-species-occupancy.html#cb74-1"></a><span class="co"># All models are stored in lists below</span></span>
<span id="cb74-2"><a href="modelling-species-occupancy.html#cb74-2"></a>det_dred &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb74-3"><a href="modelling-species-occupancy.html#cb74-3"></a></span>
<span id="cb74-4"><a href="modelling-species-occupancy.html#cb74-4"></a><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></span>
<span id="cb74-5"><a href="modelling-species-occupancy.html#cb74-5"></a>top_det &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb74-6"><a href="modelling-species-occupancy.html#cb74-6"></a></span>
<span id="cb74-7"><a href="modelling-species-occupancy.html#cb74-7"></a><span class="co"># Getting model averaged coefficients and relative importance scores</span></span>
<span id="cb74-8"><a href="modelling-species-occupancy.html#cb74-8"></a>det_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb74-9"><a href="modelling-species-occupancy.html#cb74-9"></a>det_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb74-10"><a href="modelling-species-occupancy.html#cb74-10"></a></span>
<span id="cb74-11"><a href="modelling-species-occupancy.html#cb74-11"></a><span class="co"># Getting model estimates</span></span>
<span id="cb74-12"><a href="modelling-species-occupancy.html#cb74-12"></a>det_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb74-13"><a href="modelling-species-occupancy.html#cb74-13"></a></span>
<span id="cb74-14"><a href="modelling-species-occupancy.html#cb74-14"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb74-15"><a href="modelling-species-occupancy.html#cb74-15"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(</span>
<span id="cb74-16"><a href="modelling-species-occupancy.html#cb74-16"></a>  <span class="dt">min =</span> <span class="dv">0</span>,</span>
<span id="cb74-17"><a href="modelling-species-occupancy.html#cb74-17"></a>  <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span></span>
<span id="cb74-18"><a href="modelling-species-occupancy.html#cb74-18"></a>) <span class="co"># text based bar</span></span>
<span id="cb74-19"><a href="modelling-species-occupancy.html#cb74-19"></a></span>
<span id="cb74-20"><a href="modelling-species-occupancy.html#cb74-20"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb74-21"><a href="modelling-species-occupancy.html#cb74-21"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span></span>
<span id="cb74-22"><a href="modelling-species-occupancy.html#cb74-22"></a><span class="st">    </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb74-23"><a href="modelling-species-occupancy.html#cb74-23"></a></span>
<span id="cb74-24"><a href="modelling-species-occupancy.html#cb74-24"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb74-25"><a href="modelling-species-occupancy.html#cb74-25"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb74-26"><a href="modelling-species-occupancy.html#cb74-26"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb74-27"><a href="modelling-species-occupancy.html#cb74-27"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb74-28"><a href="modelling-species-occupancy.html#cb74-28"></a>    <span class="dt">n_days =</span> <span class="dv">3000</span>, <span class="co"># 7 years is considered a period of closure</span></span>
<span id="cb74-29"><a href="modelling-species-occupancy.html#cb74-29"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb74-30"><a href="modelling-species-occupancy.html#cb74-30"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb74-31"><a href="modelling-species-occupancy.html#cb74-31"></a>  )</span>
<span id="cb74-32"><a href="modelling-species-occupancy.html#cb74-32"></a></span>
<span id="cb74-33"><a href="modelling-species-occupancy.html#cb74-33"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb74-34"><a href="modelling-species-occupancy.html#cb74-34"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb74-35"><a href="modelling-species-occupancy.html#cb74-35"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb74-36"><a href="modelling-species-occupancy.html#cb74-36"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb74-37"><a href="modelling-species-occupancy.html#cb74-37"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb74-38"><a href="modelling-species-occupancy.html#cb74-38"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb74-39"><a href="modelling-species-occupancy.html#cb74-39"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb74-40"><a href="modelling-species-occupancy.html#cb74-40"></a>  )</span>
<span id="cb74-41"><a href="modelling-species-occupancy.html#cb74-41"></a></span>
<span id="cb74-42"><a href="modelling-species-occupancy.html#cb74-42"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb74-43"><a href="modelling-species-occupancy.html#cb74-43"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb74-44"><a href="modelling-species-occupancy.html#cb74-44"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb74-45"><a href="modelling-species-occupancy.html#cb74-45"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb74-46"><a href="modelling-species-occupancy.html#cb74-46"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb74-47"><a href="modelling-species-occupancy.html#cb74-47"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>,</span>
<span id="cb74-48"><a href="modelling-species-occupancy.html#cb74-48"></a>      <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_09.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_03.y&quot;</span>, <span class="st">&quot;bio15a.y&quot;</span>, <span class="st">&quot;bio4a.y&quot;</span></span>
<span id="cb74-49"><a href="modelling-species-occupancy.html#cb74-49"></a>    ),</span>
<span id="cb74-50"><a href="modelling-species-occupancy.html#cb74-50"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb74-51"><a href="modelling-species-occupancy.html#cb74-51"></a>  )</span>
<span id="cb74-52"><a href="modelling-species-occupancy.html#cb74-52"></a></span>
<span id="cb74-53"><a href="modelling-species-occupancy.html#cb74-53"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb74-54"><a href="modelling-species-occupancy.html#cb74-54"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb74-55"><a href="modelling-species-occupancy.html#cb74-55"></a></span>
<span id="cb74-56"><a href="modelling-species-occupancy.html#cb74-56"></a>  <span class="co"># Fit a global model with all detection level covariates</span></span>
<span id="cb74-57"><a href="modelling-species-occupancy.html#cb74-57"></a>  global_mod &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb74-58"><a href="modelling-species-occupancy.html#cb74-58"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb74-59"><a href="modelling-species-occupancy.html#cb74-59"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb74-60"><a href="modelling-species-occupancy.html#cb74-60"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb74-61"><a href="modelling-species-occupancy.html#cb74-61"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb74-62"><a href="modelling-species-occupancy.html#cb74-62"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> occ_um)</span>
<span id="cb74-63"><a href="modelling-species-occupancy.html#cb74-63"></a></span>
<span id="cb74-64"><a href="modelling-species-occupancy.html#cb74-64"></a>  <span class="co"># Set up the cluster</span></span>
<span id="cb74-65"><a href="modelling-species-occupancy.html#cb74-65"></a>  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></span>
<span id="cb74-66"><a href="modelling-species-occupancy.html#cb74-66"></a>  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</span>
<span id="cb74-67"><a href="modelling-species-occupancy.html#cb74-67"></a></span>
<span id="cb74-68"><a href="modelling-species-occupancy.html#cb74-68"></a>  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</span>
<span id="cb74-69"><a href="modelling-species-occupancy.html#cb74-69"></a>  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</span>
<span id="cb74-70"><a href="modelling-species-occupancy.html#cb74-70"></a></span>
<span id="cb74-71"><a href="modelling-species-occupancy.html#cb74-71"></a>  det_dred[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(global_mod, clust)</span>
<span id="cb74-72"><a href="modelling-species-occupancy.html#cb74-72"></a>  <span class="kw">names</span>(det_dred)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-73"><a href="modelling-species-occupancy.html#cb74-73"></a></span>
<span id="cb74-74"><a href="modelling-species-occupancy.html#cb74-74"></a>  <span class="co"># Get the top models, which we&#39;ll define as those with deltaAICc &lt; 2</span></span>
<span id="cb74-75"><a href="modelling-species-occupancy.html#cb74-75"></a>  top_det[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(det_dred[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</span>
<span id="cb74-76"><a href="modelling-species-occupancy.html#cb74-76"></a>  <span class="kw">names</span>(top_det)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-77"><a href="modelling-species-occupancy.html#cb74-77"></a></span>
<span id="cb74-78"><a href="modelling-species-occupancy.html#cb74-78"></a>  <span class="co"># Obtaining model averaged coefficients</span></span>
<span id="cb74-79"><a href="modelling-species-occupancy.html#cb74-79"></a>  <span class="cf">if</span> (<span class="kw">length</span>(top_det[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb74-80"><a href="modelling-species-occupancy.html#cb74-80"></a>    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_det[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb74-81"><a href="modelling-species-occupancy.html#cb74-81"></a>    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</span>
<span id="cb74-82"><a href="modelling-species-occupancy.html#cb74-82"></a>    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-83"><a href="modelling-species-occupancy.html#cb74-83"></a></span>
<span id="cb74-84"><a href="modelling-species-occupancy.html#cb74-84"></a>    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb74-85"><a href="modelling-species-occupancy.html#cb74-85"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</span>
<span id="cb74-86"><a href="modelling-species-occupancy.html#cb74-86"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</span>
<span id="cb74-87"><a href="modelling-species-occupancy.html#cb74-87"></a>      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</span>
<span id="cb74-88"><a href="modelling-species-occupancy.html#cb74-88"></a>      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</span>
<span id="cb74-89"><a href="modelling-species-occupancy.html#cb74-89"></a>      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</span>
<span id="cb74-90"><a href="modelling-species-occupancy.html#cb74-90"></a>      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</span>
<span id="cb74-91"><a href="modelling-species-occupancy.html#cb74-91"></a>    )</span>
<span id="cb74-92"><a href="modelling-species-occupancy.html#cb74-92"></a></span>
<span id="cb74-93"><a href="modelling-species-occupancy.html#cb74-93"></a>    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-94"><a href="modelling-species-occupancy.html#cb74-94"></a></span>
<span id="cb74-95"><a href="modelling-species-occupancy.html#cb74-95"></a>    det_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</span>
<span id="cb74-96"><a href="modelling-species-occupancy.html#cb74-96"></a>    <span class="kw">names</span>(det_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-97"><a href="modelling-species-occupancy.html#cb74-97"></a>  } <span class="cf">else</span> {</span>
<span id="cb74-98"><a href="modelling-species-occupancy.html#cb74-98"></a>    det_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_det[[i]][[<span class="dv">1</span>]]))</span>
<span id="cb74-99"><a href="modelling-species-occupancy.html#cb74-99"></a>    <span class="kw">names</span>(det_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-100"><a href="modelling-species-occupancy.html#cb74-100"></a></span>
<span id="cb74-101"><a href="modelling-species-occupancy.html#cb74-101"></a>    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb74-102"><a href="modelling-species-occupancy.html#cb74-102"></a>    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_det[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb74-103"><a href="modelling-species-occupancy.html#cb74-103"></a>    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</span>
<span id="cb74-104"><a href="modelling-species-occupancy.html#cb74-104"></a>    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">summary</span>(top_det[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</span>
<span id="cb74-105"><a href="modelling-species-occupancy.html#cb74-105"></a></span>
<span id="cb74-106"><a href="modelling-species-occupancy.html#cb74-106"></a>    Coefficient &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>]</span>
<span id="cb74-107"><a href="modelling-species-occupancy.html#cb74-107"></a>    SE &lt;-<span class="st"> </span><span class="kw">coefTable</span>(top_det[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>]</span>
<span id="cb74-108"><a href="modelling-species-occupancy.html#cb74-108"></a></span>
<span id="cb74-109"><a href="modelling-species-occupancy.html#cb74-109"></a>    det_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb74-110"><a href="modelling-species-occupancy.html#cb74-110"></a>      <span class="dt">Coefficient =</span> Coefficient[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(Coefficient)],</span>
<span id="cb74-111"><a href="modelling-species-occupancy.html#cb74-111"></a>      <span class="dt">SE =</span> SE[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(SE)],</span>
<span id="cb74-112"><a href="modelling-species-occupancy.html#cb74-112"></a>      <span class="dt">lowerCI =</span> lowDet,</span>
<span id="cb74-113"><a href="modelling-species-occupancy.html#cb74-113"></a>      <span class="dt">upperCI =</span> upDet,</span>
<span id="cb74-114"><a href="modelling-species-occupancy.html#cb74-114"></a>      <span class="dt">z_value =</span> zDet,</span>
<span id="cb74-115"><a href="modelling-species-occupancy.html#cb74-115"></a>      <span class="dt">Pr_z =</span> Pr_zDet</span>
<span id="cb74-116"><a href="modelling-species-occupancy.html#cb74-116"></a>    )</span>
<span id="cb74-117"><a href="modelling-species-occupancy.html#cb74-117"></a></span>
<span id="cb74-118"><a href="modelling-species-occupancy.html#cb74-118"></a>    <span class="kw">names</span>(det_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb74-119"><a href="modelling-species-occupancy.html#cb74-119"></a>  }</span>
<span id="cb74-120"><a href="modelling-species-occupancy.html#cb74-120"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb74-121"><a href="modelling-species-occupancy.html#cb74-121"></a>  <span class="kw">stopCluster</span>(clust)</span>
<span id="cb74-122"><a href="modelling-species-occupancy.html#cb74-122"></a>}</span>
<span id="cb74-123"><a href="modelling-species-occupancy.html#cb74-123"></a><span class="kw">close</span>(pb)</span>
<span id="cb74-124"><a href="modelling-species-occupancy.html#cb74-124"></a></span>
<span id="cb74-125"><a href="modelling-species-occupancy.html#cb74-125"></a><span class="co">## Storing output from the above models in excel sheets</span></span>
<span id="cb74-126"><a href="modelling-species-occupancy.html#cb74-126"></a></span>
<span id="cb74-127"><a href="modelling-species-occupancy.html#cb74-127"></a><span class="co"># 1. Store all the model outputs for each species (variable: det_dred() - see above)</span></span>
<span id="cb74-128"><a href="modelling-species-occupancy.html#cb74-128"></a><span class="kw">write.xlsx</span>(det_dred, <span class="dt">file =</span> <span class="st">&quot;data/results/det-dred.xlsx&quot;</span>)</span>
<span id="cb74-129"><a href="modelling-species-occupancy.html#cb74-129"></a></span>
<span id="cb74-130"><a href="modelling-species-occupancy.html#cb74-130"></a><span class="co"># 2. Store all the model averaged outputs for each species and the relative importance score</span></span>
<span id="cb74-131"><a href="modelling-species-occupancy.html#cb74-131"></a><span class="kw">write.xlsx</span>(det_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/det-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb74-132"><a href="modelling-species-occupancy.html#cb74-132"></a><span class="kw">write.xlsx</span>(det_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/det-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb74-133"><a href="modelling-species-occupancy.html#cb74-133"></a></span>
<span id="cb74-134"><a href="modelling-species-occupancy.html#cb74-134"></a><span class="kw">write.xlsx</span>(det_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/det-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb74-135"><a href="modelling-species-occupancy.html#cb74-135"></a></span>
<span id="cb74-136"><a href="modelling-species-occupancy.html#cb74-136"></a><span class="co"># Note if you are unable to write to a file, use (for example)</span></span>
<span id="cb74-137"><a href="modelling-species-occupancy.html#cb74-137"></a>purrr<span class="op">::</span><span class="kw">map</span>(det_imp, <span class="op">~</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">compact</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">keep</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(.) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="land-cover-and-climate" class="section level2">
<h2><span class="header-section-number">8.4</span> Land Cover and Climate</h2>
<p>Occupancy models estimate the probability of occurrence of a given species while controlling for the probability of detection and allow us to model the factors affecting occurrence and detection independently <span class="citation">(Johnston et al. <a href="#ref-johnston2018" role="doc-biblioref">2018</a>; MacKenzie et al. <a href="#ref-mackenzie2002" role="doc-biblioref">2002</a>)</span>. The flexible eBird observation process contributes to the largest source of variation in the likelihood of detecting a particular species <span class="citation">(Johnston et al. <a href="#ref-johnston2019a" role="doc-biblioref">2019</a>)</span>; hence, we included seven covariates that influence the probability of detection for each checklist: ordinal day of year, duration of observation, distance travelled, protocol type, time observations started, number of observers and the checklist calibration index (CCI).</p>
<p>Using a multi-model information-theoretic approach, we tested how strongly our occurrence data fit our candidate set of environmental covariates <span class="citation">(Burnham and Anderson <a href="#ref-burnham2002a" role="doc-biblioref">2002</a>)</span>. We fitted single-species occupancy models for each species, to simultaneously estimate a probability of detection (p) and a probability of occupancy (<span class="math inline">\(\psi\)</span>) <span class="citation">(Fiske and Chandler <a href="#ref-fiske2011" role="doc-biblioref">2011</a>; MacKenzie et al. <a href="#ref-mackenzie2002" role="doc-biblioref">2002</a>)</span>. For each species, we fit 256 models, each with a unique combination of the eight (climate and land cover) occupancy covariates and all seven detection covariates (Appendix S5).</p>
<p>Across the 256 models tested for each species, the model with highest support was determined using AICc scores. However, across the majority of the species, no single model had overwhelming support. Hence, for each species, we examined those models which had <span class="math inline">\(\Delta\)</span>AICc &lt; 2, as these top models were considered to explain a large proportion of the association between the species-specific probability of occupancy and environmental drivers <span class="citation">(Burnham, Anderson, and Huyvaert <a href="#ref-burnham2011" role="doc-biblioref">2011</a>; Elsen et al. <a href="#ref-elsen2017" role="doc-biblioref">2017</a>)</span>. Using these restricted model sets for each species; we created a model-averaged coefficient estimate for each predictor and assessed its direction and significance <span class="citation">(Barto <a href="#ref-MuMIn" role="doc-biblioref">2020</a>)</span>. We considered a predictor to be significantly associated with occupancy if the range of the 95% confidence interval around the model-averaged coefficient did not contain zero. Next, we obtained a measure of relative importance of climatic and landscape predictors by calculating cumulative variable importance scores. These scores were calculated by obtaining the sum of model weights (AIC weights) across all models (including the top models) for each predictor across all species.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="modelling-species-occupancy.html#cb75-1"></a><span class="co"># All models are stored in lists below</span></span>
<span id="cb75-2"><a href="modelling-species-occupancy.html#cb75-2"></a>lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb75-3"><a href="modelling-species-occupancy.html#cb75-3"></a></span>
<span id="cb75-4"><a href="modelling-species-occupancy.html#cb75-4"></a><span class="co"># Subsetting those models whose deltaAIC&lt;2 (Burnham et al., 2011)</span></span>
<span id="cb75-5"><a href="modelling-species-occupancy.html#cb75-5"></a>top_lc_clim &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb75-6"><a href="modelling-species-occupancy.html#cb75-6"></a></span>
<span id="cb75-7"><a href="modelling-species-occupancy.html#cb75-7"></a><span class="co"># Getting model averaged coefficients and relative importance scores</span></span>
<span id="cb75-8"><a href="modelling-species-occupancy.html#cb75-8"></a>lc_clim_avg &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb75-9"><a href="modelling-species-occupancy.html#cb75-9"></a>lc_clim_imp &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb75-10"><a href="modelling-species-occupancy.html#cb75-10"></a></span>
<span id="cb75-11"><a href="modelling-species-occupancy.html#cb75-11"></a><span class="co"># Storing Model estimates</span></span>
<span id="cb75-12"><a href="modelling-species-occupancy.html#cb75-12"></a>lc_clim_modelEst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb75-13"><a href="modelling-species-occupancy.html#cb75-13"></a></span>
<span id="cb75-14"><a href="modelling-species-occupancy.html#cb75-14"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb75-15"><a href="modelling-species-occupancy.html#cb75-15"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></span>
<span id="cb75-16"><a href="modelling-species-occupancy.html#cb75-16"></a></span>
<span id="cb75-17"><a href="modelling-species-occupancy.html#cb75-17"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb75-18"><a href="modelling-species-occupancy.html#cb75-18"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb75-19"><a href="modelling-species-occupancy.html#cb75-19"></a></span>
<span id="cb75-20"><a href="modelling-species-occupancy.html#cb75-20"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb75-21"><a href="modelling-species-occupancy.html#cb75-21"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb75-22"><a href="modelling-species-occupancy.html#cb75-22"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb75-23"><a href="modelling-species-occupancy.html#cb75-23"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb75-24"><a href="modelling-species-occupancy.html#cb75-24"></a>    <span class="dt">n_days =</span> <span class="dv">3000</span>, <span class="co"># 6 years is considered a period of closure</span></span>
<span id="cb75-25"><a href="modelling-species-occupancy.html#cb75-25"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb75-26"><a href="modelling-species-occupancy.html#cb75-26"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb75-27"><a href="modelling-species-occupancy.html#cb75-27"></a>  )</span>
<span id="cb75-28"><a href="modelling-species-occupancy.html#cb75-28"></a></span>
<span id="cb75-29"><a href="modelling-species-occupancy.html#cb75-29"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb75-30"><a href="modelling-species-occupancy.html#cb75-30"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb75-31"><a href="modelling-species-occupancy.html#cb75-31"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb75-32"><a href="modelling-species-occupancy.html#cb75-32"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb75-33"><a href="modelling-species-occupancy.html#cb75-33"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb75-34"><a href="modelling-species-occupancy.html#cb75-34"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb75-35"><a href="modelling-species-occupancy.html#cb75-35"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb75-36"><a href="modelling-species-occupancy.html#cb75-36"></a>  )</span>
<span id="cb75-37"><a href="modelling-species-occupancy.html#cb75-37"></a></span>
<span id="cb75-38"><a href="modelling-species-occupancy.html#cb75-38"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb75-39"><a href="modelling-species-occupancy.html#cb75-39"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb75-40"><a href="modelling-species-occupancy.html#cb75-40"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb75-41"><a href="modelling-species-occupancy.html#cb75-41"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb75-42"><a href="modelling-species-occupancy.html#cb75-42"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb75-43"><a href="modelling-species-occupancy.html#cb75-43"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>,</span>
<span id="cb75-44"><a href="modelling-species-occupancy.html#cb75-44"></a>      <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_09.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_03.y&quot;</span>, <span class="st">&quot;bio15a.y&quot;</span>, <span class="st">&quot;bio4a.y&quot;</span></span>
<span id="cb75-45"><a href="modelling-species-occupancy.html#cb75-45"></a>    ),</span>
<span id="cb75-46"><a href="modelling-species-occupancy.html#cb75-46"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb75-47"><a href="modelling-species-occupancy.html#cb75-47"></a>  )</span>
<span id="cb75-48"><a href="modelling-species-occupancy.html#cb75-48"></a></span>
<span id="cb75-49"><a href="modelling-species-occupancy.html#cb75-49"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb75-50"><a href="modelling-species-occupancy.html#cb75-50"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb75-51"><a href="modelling-species-occupancy.html#cb75-51"></a></span>
<span id="cb75-52"><a href="modelling-species-occupancy.html#cb75-52"></a>  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb75-53"><a href="modelling-species-occupancy.html#cb75-53"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb75-54"><a href="modelling-species-occupancy.html#cb75-54"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb75-55"><a href="modelling-species-occupancy.html#cb75-55"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb75-56"><a href="modelling-species-occupancy.html#cb75-56"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb75-57"><a href="modelling-species-occupancy.html#cb75-57"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="fl">01.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">02.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">05.</span>y <span class="op">+</span></span>
<span id="cb75-58"><a href="modelling-species-occupancy.html#cb75-58"></a><span class="st">    </span>lc_<span class="fl">04.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">09.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">07.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">03.</span>y <span class="op">+</span><span class="st"> </span>bio15a.y <span class="op">+</span><span class="st"> </span>bio4a.y, <span class="dt">data =</span> occ_um)</span>
<span id="cb75-59"><a href="modelling-species-occupancy.html#cb75-59"></a></span>
<span id="cb75-60"><a href="modelling-species-occupancy.html#cb75-60"></a>  <span class="co"># Set up the cluster</span></span>
<span id="cb75-61"><a href="modelling-species-occupancy.html#cb75-61"></a>  clusterType &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">find.package</span>(<span class="st">&quot;snow&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))) <span class="st">&quot;SOCK&quot;</span> <span class="cf">else</span> <span class="st">&quot;PSOCK&quot;</span></span>
<span id="cb75-62"><a href="modelling-species-occupancy.html#cb75-62"></a>  clust &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">makeCluster</span>(<span class="kw">getOption</span>(<span class="st">&quot;cl.cores&quot;</span>, <span class="dv">6</span>), <span class="dt">type =</span> clusterType))</span>
<span id="cb75-63"><a href="modelling-species-occupancy.html#cb75-63"></a></span>
<span id="cb75-64"><a href="modelling-species-occupancy.html#cb75-64"></a>  <span class="kw">clusterEvalQ</span>(clust, <span class="kw">library</span>(unmarked))</span>
<span id="cb75-65"><a href="modelling-species-occupancy.html#cb75-65"></a>  <span class="kw">clusterExport</span>(clust, <span class="st">&quot;occ_um&quot;</span>)</span>
<span id="cb75-66"><a href="modelling-species-occupancy.html#cb75-66"></a></span>
<span id="cb75-67"><a href="modelling-species-occupancy.html#cb75-67"></a>  <span class="co"># Detection terms are fixed</span></span>
<span id="cb75-68"><a href="modelling-species-occupancy.html#cb75-68"></a>  det_terms &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb75-69"><a href="modelling-species-occupancy.html#cb75-69"></a>    <span class="st">&quot;p(duration_minutes)&quot;</span>, <span class="st">&quot;p(effort_distance_km)&quot;</span>, <span class="st">&quot;p(expertise)&quot;</span>,</span>
<span id="cb75-70"><a href="modelling-species-occupancy.html#cb75-70"></a>    <span class="st">&quot;p(julian_date)&quot;</span>, <span class="st">&quot;p(min_obs_started)&quot;</span>,</span>
<span id="cb75-71"><a href="modelling-species-occupancy.html#cb75-71"></a>    <span class="st">&quot;p(number_observers)&quot;</span></span>
<span id="cb75-72"><a href="modelling-species-occupancy.html#cb75-72"></a>  )</span>
<span id="cb75-73"><a href="modelling-species-occupancy.html#cb75-73"></a></span>
<span id="cb75-74"><a href="modelling-species-occupancy.html#cb75-74"></a>  lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">pdredge</span>(model_lc_clim, clust, <span class="dt">fixed =</span> det_terms)</span>
<span id="cb75-75"><a href="modelling-species-occupancy.html#cb75-75"></a>  <span class="kw">names</span>(lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-76"><a href="modelling-species-occupancy.html#cb75-76"></a></span>
<span id="cb75-77"><a href="modelling-species-occupancy.html#cb75-77"></a>  <span class="co"># Identiying top subset of models based on deltaAIC scores being less than 2 (Burnham et al., 2011)</span></span>
<span id="cb75-78"><a href="modelling-species-occupancy.html#cb75-78"></a>  top_lc_clim[[i]] &lt;-<span class="st"> </span><span class="kw">get.models</span>(lc_clim[[i]], <span class="dt">subset =</span> delta <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">cluster =</span> clust)</span>
<span id="cb75-79"><a href="modelling-species-occupancy.html#cb75-79"></a></span>
<span id="cb75-80"><a href="modelling-species-occupancy.html#cb75-80"></a>  <span class="kw">names</span>(top_lc_clim)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-81"><a href="modelling-species-occupancy.html#cb75-81"></a></span>
<span id="cb75-82"><a href="modelling-species-occupancy.html#cb75-82"></a>  <span class="co"># Obtaining model averaged coefficients for both candidate model subsets</span></span>
<span id="cb75-83"><a href="modelling-species-occupancy.html#cb75-83"></a>  <span class="cf">if</span> (<span class="kw">length</span>(top_lc_clim[[i]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb75-84"><a href="modelling-species-occupancy.html#cb75-84"></a>    a &lt;-<span class="st"> </span><span class="kw">model.avg</span>(top_lc_clim[[i]], <span class="dt">fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb75-85"><a href="modelling-species-occupancy.html#cb75-85"></a>    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(a<span class="op">$</span>coefficients)</span>
<span id="cb75-86"><a href="modelling-species-occupancy.html#cb75-86"></a>    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-87"><a href="modelling-species-occupancy.html#cb75-87"></a></span>
<span id="cb75-88"><a href="modelling-species-occupancy.html#cb75-88"></a>    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb75-89"><a href="modelling-species-occupancy.html#cb75-89"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">1</span>],</span>
<span id="cb75-90"><a href="modelling-species-occupancy.html#cb75-90"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(a, <span class="dt">full =</span> T)[, <span class="dv">2</span>],</span>
<span id="cb75-91"><a href="modelling-species-occupancy.html#cb75-91"></a>      <span class="dt">lowerCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">1</span>],</span>
<span id="cb75-92"><a href="modelling-species-occupancy.html#cb75-92"></a>      <span class="dt">upperCI =</span> <span class="kw">confint</span>(a)[, <span class="dv">2</span>],</span>
<span id="cb75-93"><a href="modelling-species-occupancy.html#cb75-93"></a>      <span class="dt">z_value =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">3</span>],</span>
<span id="cb75-94"><a href="modelling-species-occupancy.html#cb75-94"></a>      <span class="dt">Pr_z =</span> (<span class="kw">summary</span>(a)<span class="op">$</span>coefmat.full)[, <span class="dv">4</span>]</span>
<span id="cb75-95"><a href="modelling-species-occupancy.html#cb75-95"></a>    )</span>
<span id="cb75-96"><a href="modelling-species-occupancy.html#cb75-96"></a></span>
<span id="cb75-97"><a href="modelling-species-occupancy.html#cb75-97"></a>    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-98"><a href="modelling-species-occupancy.html#cb75-98"></a></span>
<span id="cb75-99"><a href="modelling-species-occupancy.html#cb75-99"></a>    lc_clim_imp[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(MuMIn<span class="op">::</span><span class="kw">importance</span>(a))</span>
<span id="cb75-100"><a href="modelling-species-occupancy.html#cb75-100"></a>    <span class="kw">names</span>(lc_clim_imp)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-101"><a href="modelling-species-occupancy.html#cb75-101"></a>  } <span class="cf">else</span> {</span>
<span id="cb75-102"><a href="modelling-species-occupancy.html#cb75-102"></a>    lc_clim_avg[[i]] &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(unmarked<span class="op">::</span><span class="kw">coef</span>(top_lc_clim[[i]][[<span class="dv">1</span>]]))</span>
<span id="cb75-103"><a href="modelling-species-occupancy.html#cb75-103"></a>    <span class="kw">names</span>(lc_clim_avg)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-104"><a href="modelling-species-occupancy.html#cb75-104"></a></span>
<span id="cb75-105"><a href="modelling-species-occupancy.html#cb75-105"></a>    lowSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb75-106"><a href="modelling-species-occupancy.html#cb75-106"></a>    lowDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lowerCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">1</span>])</span>
<span id="cb75-107"><a href="modelling-species-occupancy.html#cb75-107"></a>    upSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;state&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb75-108"><a href="modelling-species-occupancy.html#cb75-108"></a>    upDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">upperCI =</span> <span class="kw">confint</span>(top_lc_clim[[i]][[<span class="dv">1</span>]], <span class="dt">type =</span> <span class="st">&quot;det&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb75-109"><a href="modelling-species-occupancy.html#cb75-109"></a>    zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">3</span>])</span>
<span id="cb75-110"><a href="modelling-species-occupancy.html#cb75-110"></a>    zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z_value =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">3</span>])</span>
<span id="cb75-111"><a href="modelling-species-occupancy.html#cb75-111"></a>    Pr_zSt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>state[, <span class="dv">4</span>])</span>
<span id="cb75-112"><a href="modelling-species-occupancy.html#cb75-112"></a>    Pr_zDet &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Pr_z =</span> <span class="kw">summary</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])<span class="op">$</span>det[, <span class="dv">4</span>])</span>
<span id="cb75-113"><a href="modelling-species-occupancy.html#cb75-113"></a></span>
<span id="cb75-114"><a href="modelling-species-occupancy.html#cb75-114"></a>    lc_clim_modelEst[[i]] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb75-115"><a href="modelling-species-occupancy.html#cb75-115"></a>      <span class="dt">Coefficient =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">1</span>],</span>
<span id="cb75-116"><a href="modelling-species-occupancy.html#cb75-116"></a>      <span class="dt">SE =</span> <span class="kw">coefTable</span>(top_lc_clim[[i]][[<span class="dv">1</span>]])[, <span class="dv">2</span>],</span>
<span id="cb75-117"><a href="modelling-species-occupancy.html#cb75-117"></a>      <span class="dt">lowerCI =</span> <span class="kw">rbind</span>(lowSt, lowDet),</span>
<span id="cb75-118"><a href="modelling-species-occupancy.html#cb75-118"></a>      <span class="dt">upperCI =</span> <span class="kw">rbind</span>(upSt, upDet),</span>
<span id="cb75-119"><a href="modelling-species-occupancy.html#cb75-119"></a>      <span class="dt">z_value =</span> <span class="kw">rbind</span>(zSt, zDet),</span>
<span id="cb75-120"><a href="modelling-species-occupancy.html#cb75-120"></a>      <span class="dt">Pr_z =</span> <span class="kw">rbind</span>(Pr_zSt, Pr_zDet)</span>
<span id="cb75-121"><a href="modelling-species-occupancy.html#cb75-121"></a>    )</span>
<span id="cb75-122"><a href="modelling-species-occupancy.html#cb75-122"></a></span>
<span id="cb75-123"><a href="modelling-species-occupancy.html#cb75-123"></a>    <span class="kw">names</span>(lc_clim_modelEst)[i] &lt;-<span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i]</span>
<span id="cb75-124"><a href="modelling-species-occupancy.html#cb75-124"></a>  }</span>
<span id="cb75-125"><a href="modelling-species-occupancy.html#cb75-125"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb75-126"><a href="modelling-species-occupancy.html#cb75-126"></a>  <span class="kw">stopCluster</span>(clust)</span>
<span id="cb75-127"><a href="modelling-species-occupancy.html#cb75-127"></a>}</span>
<span id="cb75-128"><a href="modelling-species-occupancy.html#cb75-128"></a><span class="kw">close</span>(pb)</span>
<span id="cb75-129"><a href="modelling-species-occupancy.html#cb75-129"></a></span>
<span id="cb75-130"><a href="modelling-species-occupancy.html#cb75-130"></a><span class="co"># 1. Store all the model outputs for each species (for both landcover and climate)</span></span>
<span id="cb75-131"><a href="modelling-species-occupancy.html#cb75-131"></a><span class="kw">write.xlsx</span>(lc_clim, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim.xlsx&quot;</span>)</span>
<span id="cb75-132"><a href="modelling-species-occupancy.html#cb75-132"></a></span>
<span id="cb75-133"><a href="modelling-species-occupancy.html#cb75-133"></a><span class="co"># 2. Store all the model averaged outputs for each species and relative importance scores</span></span>
<span id="cb75-134"><a href="modelling-species-occupancy.html#cb75-134"></a><span class="kw">write.xlsx</span>(lc_clim_avg, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-avg.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb75-135"><a href="modelling-species-occupancy.html#cb75-135"></a><span class="kw">write.xlsx</span>(lc_clim_imp, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-imp.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span>
<span id="cb75-136"><a href="modelling-species-occupancy.html#cb75-136"></a></span>
<span id="cb75-137"><a href="modelling-species-occupancy.html#cb75-137"></a><span class="co"># 3. Store all model estimates</span></span>
<span id="cb75-138"><a href="modelling-species-occupancy.html#cb75-138"></a><span class="kw">write.xlsx</span>(lc_clim_modelEst, <span class="dt">file =</span> <span class="st">&quot;data/results/lc-clim-modelEst.xlsx&quot;</span>, <span class="dt">rowNames =</span> T, <span class="dt">colNames =</span> T)</span></code></pre></div>
</div>
<div id="goodness-of-fit-tests" class="section level2">
<h2><span class="header-section-number">8.5</span> Goodness-of-fit tests</h2>
<p>Adequate model fit was assessed using a chi-square goodness-of-fit test using 5000 parametric bootstrap simulations on a global model that included all occupancy and detection covariates (MacKenzie &amp; Bailey, 2004).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="modelling-species-occupancy.html#cb76-1"></a>goodness_of_fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb76-2"><a href="modelling-species-occupancy.html#cb76-2"></a></span>
<span id="cb76-3"><a href="modelling-species-occupancy.html#cb76-3"></a><span class="co"># Add a progress bar for the loop</span></span>
<span id="cb76-4"><a href="modelling-species-occupancy.html#cb76-4"></a>pb &lt;-<span class="st"> </span><span class="kw">txtProgressBar</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)), <span class="dt">style =</span> <span class="dv">3</span>) <span class="co"># text based bar</span></span>
<span id="cb76-5"><a href="modelling-species-occupancy.html#cb76-5"></a></span>
<span id="cb76-6"><a href="modelling-species-occupancy.html#cb76-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name))) {</span>
<span id="cb76-7"><a href="modelling-species-occupancy.html#cb76-7"></a>  data &lt;-<span class="st"> </span>dat.scaled <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(dat.scaled<span class="op">$</span>scientific_name <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(dat.scaled<span class="op">$</span>scientific_name)[i])</span>
<span id="cb76-8"><a href="modelling-species-occupancy.html#cb76-8"></a></span>
<span id="cb76-9"><a href="modelling-species-occupancy.html#cb76-9"></a>  <span class="co"># Preparing data for the unmarked model</span></span>
<span id="cb76-10"><a href="modelling-species-occupancy.html#cb76-10"></a>  occ &lt;-<span class="st"> </span><span class="kw">filter_repeat_visits</span>(data,</span>
<span id="cb76-11"><a href="modelling-species-occupancy.html#cb76-11"></a>    <span class="dt">min_obs =</span> <span class="dv">1</span>, <span class="dt">max_obs =</span> <span class="dv">10</span>,</span>
<span id="cb76-12"><a href="modelling-species-occupancy.html#cb76-12"></a>    <span class="dt">annual_closure =</span> <span class="ot">FALSE</span>,</span>
<span id="cb76-13"><a href="modelling-species-occupancy.html#cb76-13"></a>    <span class="dt">n_days =</span> <span class="dv">3000</span>, <span class="co"># 6 years is considered a period of closure</span></span>
<span id="cb76-14"><a href="modelling-species-occupancy.html#cb76-14"></a>    <span class="dt">date_var =</span> <span class="st">&quot;observation_date&quot;</span>,</span>
<span id="cb76-15"><a href="modelling-species-occupancy.html#cb76-15"></a>    <span class="dt">site_vars =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>)</span>
<span id="cb76-16"><a href="modelling-species-occupancy.html#cb76-16"></a>  )</span>
<span id="cb76-17"><a href="modelling-species-occupancy.html#cb76-17"></a></span>
<span id="cb76-18"><a href="modelling-species-occupancy.html#cb76-18"></a>  obs_covs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb76-19"><a href="modelling-species-occupancy.html#cb76-19"></a>    <span class="st">&quot;min_obs_started&quot;</span>,</span>
<span id="cb76-20"><a href="modelling-species-occupancy.html#cb76-20"></a>    <span class="st">&quot;duration_minutes&quot;</span>,</span>
<span id="cb76-21"><a href="modelling-species-occupancy.html#cb76-21"></a>    <span class="st">&quot;effort_distance_km&quot;</span>,</span>
<span id="cb76-22"><a href="modelling-species-occupancy.html#cb76-22"></a>    <span class="st">&quot;number_observers&quot;</span>,</span>
<span id="cb76-23"><a href="modelling-species-occupancy.html#cb76-23"></a>    <span class="st">&quot;protocol_type&quot;</span>,</span>
<span id="cb76-24"><a href="modelling-species-occupancy.html#cb76-24"></a>    <span class="st">&quot;expertise&quot;</span>,</span>
<span id="cb76-25"><a href="modelling-species-occupancy.html#cb76-25"></a>    <span class="st">&quot;julian_date&quot;</span></span>
<span id="cb76-26"><a href="modelling-species-occupancy.html#cb76-26"></a>  )</span>
<span id="cb76-27"><a href="modelling-species-occupancy.html#cb76-27"></a></span>
<span id="cb76-28"><a href="modelling-species-occupancy.html#cb76-28"></a>  <span class="co"># format for unmarked</span></span>
<span id="cb76-29"><a href="modelling-species-occupancy.html#cb76-29"></a>  occ_wide &lt;-<span class="st"> </span><span class="kw">format_unmarked_occu</span>(occ,</span>
<span id="cb76-30"><a href="modelling-species-occupancy.html#cb76-30"></a>    <span class="dt">site_id =</span> <span class="st">&quot;site&quot;</span>,</span>
<span id="cb76-31"><a href="modelling-species-occupancy.html#cb76-31"></a>    <span class="dt">response =</span> <span class="st">&quot;pres_abs&quot;</span>,</span>
<span id="cb76-32"><a href="modelling-species-occupancy.html#cb76-32"></a>    <span class="dt">site_covs =</span> <span class="kw">c</span>(</span>
<span id="cb76-33"><a href="modelling-species-occupancy.html#cb76-33"></a>      <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;lc_01.y&quot;</span>, <span class="st">&quot;lc_02.y&quot;</span>, <span class="st">&quot;lc_05.y&quot;</span>,</span>
<span id="cb76-34"><a href="modelling-species-occupancy.html#cb76-34"></a>      <span class="st">&quot;lc_04.y&quot;</span>, <span class="st">&quot;lc_09.y&quot;</span>, <span class="st">&quot;lc_07.y&quot;</span>, <span class="st">&quot;lc_03.y&quot;</span>, <span class="st">&quot;bio15a.y&quot;</span>, <span class="st">&quot;bio4a.y&quot;</span></span>
<span id="cb76-35"><a href="modelling-species-occupancy.html#cb76-35"></a>    ),</span>
<span id="cb76-36"><a href="modelling-species-occupancy.html#cb76-36"></a>    <span class="dt">obs_covs =</span> obs_covs</span>
<span id="cb76-37"><a href="modelling-species-occupancy.html#cb76-37"></a>  )</span>
<span id="cb76-38"><a href="modelling-species-occupancy.html#cb76-38"></a></span>
<span id="cb76-39"><a href="modelling-species-occupancy.html#cb76-39"></a>  <span class="co"># Convert this dataframe of observations into an unmarked object to start fitting occupancy models</span></span>
<span id="cb76-40"><a href="modelling-species-occupancy.html#cb76-40"></a>  occ_um &lt;-<span class="st"> </span><span class="kw">formatWide</span>(occ_wide, <span class="dt">type =</span> <span class="st">&quot;unmarkedFrameOccu&quot;</span>)</span>
<span id="cb76-41"><a href="modelling-species-occupancy.html#cb76-41"></a></span>
<span id="cb76-42"><a href="modelling-species-occupancy.html#cb76-42"></a>  model_lc_clim &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>min_obs_started <span class="op">+</span></span>
<span id="cb76-43"><a href="modelling-species-occupancy.html#cb76-43"></a><span class="st">    </span>julian_date <span class="op">+</span></span>
<span id="cb76-44"><a href="modelling-species-occupancy.html#cb76-44"></a><span class="st">    </span>duration_minutes <span class="op">+</span></span>
<span id="cb76-45"><a href="modelling-species-occupancy.html#cb76-45"></a><span class="st">    </span>effort_distance_km <span class="op">+</span></span>
<span id="cb76-46"><a href="modelling-species-occupancy.html#cb76-46"></a><span class="st">    </span>number_observers <span class="op">+</span></span>
<span id="cb76-47"><a href="modelling-species-occupancy.html#cb76-47"></a><span class="st">    </span>protocol_type <span class="op">+</span></span>
<span id="cb76-48"><a href="modelling-species-occupancy.html#cb76-48"></a><span class="st">    </span>expertise <span class="op">~</span><span class="st"> </span>lc_<span class="fl">01.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">02.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">05.</span>y <span class="op">+</span></span>
<span id="cb76-49"><a href="modelling-species-occupancy.html#cb76-49"></a><span class="st">    </span>lc_<span class="fl">04.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">09.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">07.</span>y <span class="op">+</span><span class="st"> </span>lc_<span class="fl">03.</span>y <span class="op">+</span><span class="st"> </span>bio15a.y <span class="op">+</span><span class="st"> </span>bio4a.y, <span class="dt">data =</span> occ_um)</span>
<span id="cb76-50"><a href="modelling-species-occupancy.html#cb76-50"></a></span>
<span id="cb76-51"><a href="modelling-species-occupancy.html#cb76-51"></a>  occ_gof &lt;-<span class="st"> </span><span class="kw">mb.gof.test</span>(model_lc_clim, <span class="dt">nsim =</span> <span class="dv">5000</span>, <span class="dt">plot.hist =</span> <span class="ot">FALSE</span>)</span>
<span id="cb76-52"><a href="modelling-species-occupancy.html#cb76-52"></a></span>
<span id="cb76-53"><a href="modelling-species-occupancy.html#cb76-53"></a>  p.value &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>p.value</span>
<span id="cb76-54"><a href="modelling-species-occupancy.html#cb76-54"></a>  c.hat &lt;-<span class="st"> </span>occ_gof<span class="op">$</span>c.hat.est</span>
<span id="cb76-55"><a href="modelling-species-occupancy.html#cb76-55"></a>  scientific_name &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>scientific_name)</span>
<span id="cb76-56"><a href="modelling-species-occupancy.html#cb76-56"></a></span>
<span id="cb76-57"><a href="modelling-species-occupancy.html#cb76-57"></a>  a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(scientific_name, p.value, c.hat)</span>
<span id="cb76-58"><a href="modelling-species-occupancy.html#cb76-58"></a></span>
<span id="cb76-59"><a href="modelling-species-occupancy.html#cb76-59"></a>  goodness_of_fit &lt;-<span class="st"> </span><span class="kw">rbind</span>(a, goodness_of_fit)</span>
<span id="cb76-60"><a href="modelling-species-occupancy.html#cb76-60"></a></span>
<span id="cb76-61"><a href="modelling-species-occupancy.html#cb76-61"></a>  <span class="kw">setTxtProgressBar</span>(pb, i)</span>
<span id="cb76-62"><a href="modelling-species-occupancy.html#cb76-62"></a>}</span>
<span id="cb76-63"><a href="modelling-species-occupancy.html#cb76-63"></a><span class="kw">close</span>(pb)</span>
<span id="cb76-64"><a href="modelling-species-occupancy.html#cb76-64"></a></span>
<span id="cb76-65"><a href="modelling-species-occupancy.html#cb76-65"></a><span class="kw">write.csv</span>(goodness_of_fit, <span class="st">&quot;data/results/05_goodness-of-fit-2.5km.csv&quot;</span>)</span></code></pre></div>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references hanging-indent">
<div id="ref-MuMIn">
<p>Barto, Kamil. 2020. <em>MuMIn: Multi-Model Inference</em>. Manual.</p>
</div>
<div id="ref-burnham2002a">
<p>Burnham, Kenneth P., and David R. Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. Second. New York: Springer-Verlag. <a href="https://doi.org/10.1007/b97636">https://doi.org/10.1007/b97636</a>.</p>
</div>
<div id="ref-burnham2011">
<p>Burnham, Kenneth P., David R. Anderson, and Kathryn P. Huyvaert. 2011. AIC Model Selection and Multimodel Inference in Behavioral Ecology: Some Background, Observations, and Comparisons. <em>Behavioral Ecology and Sociobiology</em> 65 (1): 2335. <a href="https://doi.org/10.1007/s00265-010-1029-6">https://doi.org/10.1007/s00265-010-1029-6</a>.</p>
</div>
<div id="ref-elsen2017">
<p>Elsen, Paul R., Morgan W. Tingley, Ramnarayan Kalyanaraman, Krishnamurthy Ramesh, and David S. Wilcove. 2017. The Role of Competition, Ecotones, and Temperature in the Elevational Distribution of Himalayan Birds. <em>Ecology</em> 98 (2): 33748. <a href="https://doi.org/10.1002/ecy.1669">https://doi.org/10.1002/ecy.1669</a>.</p>
</div>
<div id="ref-fiske2011">
<p>Fiske, Ian, and Richard Chandler. 2011. <strong>Unmarked</strong> : An <em>R</em> Package for Fitting Hierarchical Models of Wildlife Occurrence and Abundance. <em>Journal of Statistical Software</em> 43 (10). <a href="https://doi.org/10.18637/jss.v043.i10">https://doi.org/10.18637/jss.v043.i10</a>.</p>
</div>
<div id="ref-johnston2019a">
<p>Johnston, A, Wm Hochachka, Me Strimas-Mackey, V Ruiz Gutierrez, Oj Robinson, Et Miller, T Auer, St Kelling, and D Fink. 2019. Analytical Guidelines to Increase the Value of Citizen Science Data: Using eBird Data to Estimate Species Occurrence. Preprint. Ecology. <a href="https://doi.org/10.1101/574392">https://doi.org/10.1101/574392</a>.</p>
</div>
<div id="ref-johnston2018">
<p>Johnston, Alison, Daniel Fink, Wesley M. Hochachka, and Steve Kelling. 2018. Estimates of Observer Expertise Improve Species Distributions from Citizen Science Data. Edited by Nick Isaac. <em>Methods in Ecology and Evolution</em> 9 (1): 8897. <a href="https://doi.org/10.1111/2041-210X.12838">https://doi.org/10.1111/2041-210X.12838</a>.</p>
</div>
<div id="ref-mackenzie2002">
<p>MacKenzie, Darryl I., James D. Nichols, Gideon B. Lachman, Sam Droege, J. Andrew Royle, and Catherine A. Langtimm. 2002. Estimating Site Occupancy Rates When Detection Probabilities Are Less Than One. <em>Ecology</em> 83 (8): 224855. <a href="https://doi.org/10.1890/0012-9658(2002)083%5B2248:ESORWD%5D2.0.CO;2">https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adding-covariates-to-checklist-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-occupancy-predictor-effects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/eBirdOccupancy/edit/master/08_occupancy-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ebird_occupancy_main_text.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
